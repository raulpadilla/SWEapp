if(typeof(SiebelApp.S_App.CommToolbar)==="undefined"){SiebelJS.Namespace("SiebelApp.S_App.CommToolbar");SiebelApp.S_App.CommToolbar=(function(){var m;var u=false;var l={};var I={};var C={};var G={};var n=0;var H=null;var K=false;var B="7000";var D="CTI Message";var j=[];var O=0;var E;var y=false;var d;var t;var c=false;var F=false;var f=0;var q=0;var L="";var s="";var a={};var w=true;var o=null;var z="";var J=false;var e=true;var A=false;var r=0;function g(){var P;Q=function Q(){return P};Q.prototype=this;P=new Q();P.constructor=Q;return P}g.prototype.SetPModel=function(P){m=P};g.prototype.GetPModel=function(){return m};g.prototype.GetName=function(){return"CommToolbar"};g.prototype.GetPropArray=function(){return["GetName","GetTopControlNum","GetTopCtrlsSeqMap","GetSubCtrlsSeqMap","GetPopSidewayCtrl","GetPlaceholder","Is508Compliance","GetBackgroundColor","IsMakeCallPopupNeeded","IsAutomationEnabled"]};g.prototype.GetMethodArray=function(){return["InvokeCommandByItemName","InvokeCommandToolTip","ShowPreviousMessage","ShowNextMessage","ShowStatusText","ShowStatusTextForSI","ShowMessageWithAlert","PlaySound","UpdateHTMLControl","TriggerEvent","ApplySticky","FlashTitle","BlinkParentBtn","SetLocalizationStrings","GotoCTIToolbar","ShowMsgOverCTIToolbar","SetAccessibility","CollectFocusInfo","ClearFocusInfo","CallContactFromUI","UpdateCallContactFromUI","OpenCallContactFromUIPopup"]};g.prototype.Init=function(){var P=this.GetParamFromHiddenTag();if(this.ProcessObjectInfo(P)){return true}else{return false}};g.prototype.HasShown=function(){return u};g.prototype.HandleGotoCTIToolbar=function(){this.GotoCTIToolbar();return true};g.prototype.GetTopControlNum=function(){return n};g.prototype.GetTopCtrlsSeqMap=function(){return l};g.prototype.GetSubCtrlsSeqMap=function(){return G};g.prototype.GetPopSidewayCtrl=function(){return I.SidewayPopup};g.prototype.GetPlaceholder=function(){return".com_siebel_applets_toolbar_CSSToolBarApplet_class"};g.prototype.Is508Compliance=function(){return w};g.prototype.GetBackgroundColor=function(){return this.GetParameter("BGColor")};g.prototype.GetImageURL=function(){return this.GetParameter("ImageURL")};g.prototype.GetURLBase=function(){return this.GetParameter("URLBase")};g.prototype.IsMakeCallPopupNeeded=function(){return e};g.prototype.IsAutomationEnabled=function(){return A};g.prototype.Show=function(){if($(this.GetPlaceholder()).length<=0){x(1,"No place holder for CTI toolbar!");u=true;return}try{N();x(0,"CTI toolbar: INIT.begin");if(this.Init()){this.GetPModel().Show();SiebelApp.S_App.CommToolbarUtil.InitApplet()}else{x(1,"Init process failed!")}}catch(P){x(1,"Init process failed!")}finally{u=true;x(0,"CTI toolbar: INIT.end")}};g.prototype.GetParamFromHiddenTag=function(){var P=new JSSPropertySet();$(this.GetPlaceholder()).children("input").each(function(){var Q=$(this);P.SetProperty(Q.attr("name"),Q.attr("value"));Q.attr("aria-hidden","true")});return P};g.prototype.ProcessObjectInfo=function(P){H=P;var Q=this.GetParameter("AutomationEnabled");if(Q!==undefined&&Q.toLowerCase()==="true"){A=true}E=this.GetParameter("SRN");if(E===undefined){E=""}if(this.GetParameter("IsUseCookie").toLowerCase()==="true"){y=true}x(3,"IsUseCookie = "+y);if(!y){d=this.GetParameter("SNAME");if(d!==undefined){t=this.GetParameter("SID");if(t!==undefined){t=encodeURIComponent(t)}else{t=""}}else{x(2,"SNAME parameter is missing.")}}if(this.ParseControlInfo()){var S=SiebelAppFacade.CommToolbarPresentationModel;this.SetPModel(new S(this));var R=new JSSPropertySet();R.SetProperty("SWE_OUI_RENDERER","CommToolbarPhyRenderer");this.GetPModel().Setup(R);return true}else{return false}};g.prototype.GetParameter=function(P){return H.GetProperty(P)};function i(P){var Q=/^\+{0,1}\d*$/;return(Q.test(P))}g.prototype.ParseControlInfo=function(){var aa=-1;var V=0;var T=0;var W;var P;var U;var Z=SiebelApp.S_App.CommToolbarItem;var ab=this.GetParameter("SidewayPopup")+";Type=Button;Command=SidewayPopup;Enabled=true";var Y=new Z(ab);Y.m_state="enabled";I.SidewayPopup=Y;n=this.GetParameter("NumberOfControls");if(n===undefined){x(2,"NumberOfControls parameter is missing.");return false}else{if(!i(n)){x(2,"Value of NumberOfControls is: "+n);return false}}var X=n;for(var S=1;S<=X;S++){U=this.GetParameter("Control"+S);if(U===undefined){x(2,"Parameter with name Control"+S+" is missing.")}else{W=new Z(U);if(aa!==W.m_iSeq){aa=W.m_iSeq;V++;T=0}W.m_iSeq=V;if(W.m_index>0){W.m_index=++T}if(W.m_index===0){l[W.m_iSeq]=W;I[W.m_name]=W}if(W.m_index>0||W.m_bSticky===true){if(W.m_index>0){n--}C[W.m_name]=W;P=G[W.m_iSeq];if(P===undefined){P=[];G[W.m_iSeq]=P}if(W.m_index!==0){P[W.m_index]=W}}}}for(var R=0;R<n;R++){W=l[R+1];if(W===undefined){continue}if(W.m_bSticky===true){P=G[R+1];if(P!==undefined){for(var Q=1;Q<P.length;Q++){P[Q].m_bSticky=true}}}}return true};function h(P){var Q=I[P];if(Q===undefined){Q=C[P]}return Q}g.prototype.InvokeCommandByItemName=function(U,R){var T=h(U);if(T===undefined){x(2,"Control with name: "+U+"is not found.");return}else{if(T.m_state==="enabled"&&k()===true){var Q=b(R);var P=T.m_command;if(SiebelApp.S_App.CommToolbarUtil.IsPSRLogEnabled()===true){var S=h(U).m_tooltip;if(S==="Write PSR Log"){Q.PSRLog=SiebelApp.S_App.CommToolbarUtil.GetPSRLog()}}x(3,"InvokeToolbarCommand for control: "+U);SiebelApp.S_App.CommToolbarUtil.SendCommand({url:P,inputKV:Q,error:function(){x(2,"Failed invoking command for control: "+U+"!")},needUIFProcessRP:true})}}};g.prototype.InvokeCommandToolTip=function(T,S){var R=h(T);if(R===undefined){x(2,"Control with name: "+T+"is not found.");return}else{if(c===false){R.SetTooltip(R.m_tooltipFromTools)}else{var P=R.m_dynamictooltipCmd;if(P.length>0){var Q=b(S);Q.ControlName=R.m_name;x(3,"invokeCommandToolTip for control: "+T);SiebelApp.S_App.CommToolbarUtil.SendCommand({url:P,inputKV:Q,error:function(){R.SetTooltip(R.m_tooltipFromTools);x(2,"Failed getting dynamic tooltip for control: "+T+", Use static tooltip.")}})}else{R.SetTooltip(R.m_tooltipFromTools)}}}};g.prototype.CallContactFromUI=function(P,S){if(k()===true&&z.length>0){var R=b(S);R.UIPhone=P;var Q=this.GetParameter("InitCommand1").replace("ShellUIInit",z);x(3,"Make call to "+R.UIPhone+" using command "+z);SiebelApp.S_App.CommToolbarUtil.SendCommand({url:Q,inputKV:R,error:function(){x(2,"Failed invoking command: "+z+"!")},needUIFProcessRP:true})}};function b(Y){var W={FromCTIToolBar:"true"};var R=false;var X={};$.extend(X,I,C);for(var U in X){if(X.hasOwnProperty(U)){var P=X[U];if(P.m_type==="edit"){R=false;if(Y.FocusEdit===U){R=true}if(Y.EditText!==undefined&&Y.EditText[U]!==undefined){W[U]=Y.EditText[U];W[U+"_HasFocus"]=((w||R)?"true":"false")}}else{if(P.m_type==="combo box"&&Y.ComboValue!==undefined){var Z=Y.ComboValue[U];if(Z!==undefined&&Z.length>0){W[U]=Z}}}}}var V=Y.SelText;if(V!==undefined&&V.length>0){W.SelectedText=V}var T;if(o===null){T=M()}else{T=o}var Q=T.BusComp;var S=T.Field;if(Q!==undefined&&Q.length>0){W.FocusBusComp=Q;if(S!==undefined&&S.length>0){W.FocusField=S}}W.refID=SiebelApp.S_App.CommToolbarUtil.GetRefId();
return W}function v(Q,P){if(Q!==undefined){return true}else{x(2,"Control not found : "+P);return false}}g.prototype.ExecuteCommand=function(T){var Q=null;var aa=null;var U=false;if(T.name===undefined){x(2,"Invalid command!");return}if(T.m_type!=="UPDATEMENU"&&T.m_type!=="UPDATEMENU"){Q=h(T.control)}if(Q!==undefined&&Q!==null&&Q.m_bSticky===true){aa=C[T.control];if(aa===undefined||aa===null){aa=null;var R="Error: Fail to find the sticky item from Sideway";this.LogMsg(1,R)}}switch(T.name.toUpperCase()){case"ENABLECONTROL":if(T.control==="CallFromUI"){if(T.value===undefined){x(2,"Invalid command : "+T);return}else{if(T.value.toLowerCase()==="true"){J=true}else{J=false}}this.UpdateCallContactFromUI(J)}else{if(v(Q,T.control)){if(T.value===undefined){x(2,"Invalid command : "+T);return}else{Q.SetEnabled(T.value);if(aa!==null&&aa.m_id!==Q.m_id){aa.SetEnabled(T.value)}}U=true}}break;case"UPDATEMENU":if(T.control===undefined||T.value===undefined){x(2,"Invalid command : "+T);return}else{SiebelApp.S_App.CommToolbarUtil.UpdateCmdMgrMenu(T.control,T.value.toLowerCase())}break;case"MSGDISPLAYINTERVAL":if(T.value===undefined){x(2," Invalid command : "+T);return}else{B=T.value}break;case"IMPLICITSAVE":if(T.value===undefined){x(2,"Invalid command : "+T);return}else{if(T.value.toUpperCase()==="TRUE"){K=true}}break;case"CTIMESSAGEPREFIX":if(T.value===undefined){x(2,"Invalid command : "+T);return}else{D=T.value}break;case"CHANGEVALUE":if(v(Q,T.control)){if(T.value===undefined){x(2,"Invalid command : "+T);return}else{Q.ChangeValue(T.value);if(aa!==null&&aa.m_id!==Q.m_id){aa.ChangeValue(T.value)}}}U=true;break;case"BLINKCONTROL":if(v(Q,T.control)){if(T.value===undefined){x(2,"Invalid command : "+T);return}else{Q.Blink(T.value);if(aa!==null&&aa.m_id!==Q.m_id){aa.Blink(T.value)}if(F===true&&Q.m_name.indexOf("Accept Work")>=0&&T.value.toUpperCase()==="TRUE"){this.TriggerEvent(Q.m_name,"click")}}}U=true;break;case"CHANGETOOLTIP":if(v(Q,T.control)){if(T.value===undefined){x(2,"Invalid command : "+T);return}else{Q.SetTooltip(T.value);if(aa!==null&&aa.m_id!==Q.m_id){aa.SetTooltip(T.value)}}}break;case"STARTTIMER":var X=T.startTime;var V=T.serverTime;if(v(Q,T.control)){if(X!==undefined&&V!==undefined){Q.StartTimer(X,V)}else{x(2,"Invalid command : "+T);return}}break;case"STOPTIMER":if(v(Q,T.control)){Q.StopTimer()}break;case"SHOWALERT":if(T.message===undefined){x(2,"Invalid command : "+T);return}else{this.ShowMessageWithAlert(T.message)}break;case"SHOWDOCUMENT":case"DOPOPUP":case"DOSWEENCODECMD":var ab;if((T.checkPopup===undefined||T.checkPopup.toUpperCase()!=="TRUE")||((ab=p())===false)){if(T.name.toUpperCase()==="SHOWDOCUMENT"&&k()===true){SiebelApp.S_App.CommToolbarUtil.ShowDocument(T.url,T.target,T.encodedCmd,T.viewName)}else{if(T.name.toUpperCase()==="DOPOPUP"){SiebelApp.S_App.CommToolbarUtil.DoPopup(T.url,T.width,T.height)}else{if(T.name.toUpperCase()==="DOSWEENCODECMD"&&k()===true){SiebelApp.S_App.CommToolbarUtil.DoSweCmd(T.url)}}}}else{if(T.name.toUpperCase()!=="DOSWEENCODECMD"&&T.urlParameters!==undefined){T.SWEService=T.urlParameters.GetProperty("SWEService");x(3,"SWEService: "+T.SWEService);T.SWEMethod=T.urlParameters.GetProperty("SWEMethod");x(3,"SWEMethod: "+T.SWEMethod);T.SWECmd=T.urlParameters.GetProperty("SWECmd");x(3,"SWECmd: "+T.SWECmd);if((T.SWEService!==undefined&&T.SWEService!==null&&T.SWEService.length>0)&&(T.SWEMethod!==undefined&&T.SWEMethod!==null&&T.SWEMethod.length>0)&&(T.SWECmd!==undefined&&T.SWECmd!==null&&T.SWECmd.toUpperCase()==="INVOKEMETHOD")){var W=SiebelApp.S_App.GetService(T.SWEService);if(W){T.urlParameters.SetProperty("ExecuteCommand","No");W.InvokeMethod(T.SWEMethod,T.urlParameters);x(3,"Invoke Method"+T.SWEMethod+" for BS: "+T.SWEService)}}}this.ExecuteCommand({name:"SHOWSTATUSTEXT",value:T.popupErrMsg})}break;case"DOPUREPOPUP":if(T.url!==undefined){var ac=location.protocol;SWEShowFeaturedPopup(ac+"//"+T.url,T.target,T.height,T.width,T.feature)}else{x(2,"Invalid command : "+T);return}break;case"REMOVEPOPUP":if(T.target===undefined){x(2,"Invalid command : "+T);return}else{if(T.target.length>0){var Y=T.target;if(window[Y]!==undefined&&window[Y]!==null){window[Y].close()}}}break;case"DONE":break;case"REVERSEORDER":break;case"TOGGLECONTROL":if(v(Q,T.control)){if(T.value===undefined){x(2,"Invalid command : "+T);return}else{Q.SetToggle(T.value)}}U=true;break;case"SHOWERRORSTATUSTEXT":case"SHOWSTATUSTEXT":if(T.value===undefined){x(2,"Invalid command : "+T);return}else{if(T.name.toUpperCase()==="SHOWERRORSTATUSTEXT"){this.PlaySound(this.GetURLBase()+this.GetImageURL()+"/files/beep.mp3")}var ad=T.value;this.AddMessageToQ(ad);if(!this.Is508Compliance()){this.ShowStatusText(ad,B)}else{if(D.length>0){ad=D+":\r\n"+ad}this.ShowStatusTextForSI(ad)}}break;case"PLAYSOUND":var P=T.value;if(P===undefined){x(2,"Invalid command : "+T);return}else{if(P.length>0){this.PlaySound(P)}}break;case"INVOKEMETHOD":if(T.value===undefined){x(2,"Invalid command : "+T);return}else{if(T.value.length>0){var S="start.swe?SWECmd=InvokeMethod&SWEService=HTML+Communication+Client&SWEMethod=";S+=T.value;SiebelApp.S_App.CommToolbarUtil.SendCommand({url:S,inputKV:{},error:function(){x(2,"Invoke method failed for: "+T.value+" of HTML Communication Client.")},needUIFProcessRP:true})}}break;case"WAITFORCMD":c=true;SiebelApp.S_App.CommToolbarUtil.StartPush({bPush:true,sCmd:T.value});break;case"GETMESSAGECMD":if(T.polling.length>0&&T.polling>=0){SiebelApp.S_App.CommToolbarUtil.StartPush({bPush:false,sCmd:T.value,iInterval:T.polling})}else{SiebelApp.S_App.CommToolbarUtil.StartPush({bPush:false,sCmd:T.value,iInterval:2})}break;case"SHOWPREVIOUSMESSAGE":this.ShowPreviousMessage();break;case"SHOWNEXTMESSAGE":this.ShowNextMessage();break;case"AUTOANSWER":if(T.value!==undefined&&T.value.toUpperCase()==="TRUE"){F=true}break;case"BROWSERONFOCUS":this.FlashTitle(s);break;case"SERIOUSREFIDERROR":this.SeriousRefIDError();break;case"MAXREFIDERROR":if(T.value!==undefined&&T.message!==undefined){this.SetMaxRefIDError(T.value,T.message)}break;case"BRINGTOFRONTTITLE":if(T.value===undefined){x(2,"Invalid command : "+T);return}else{s=T.value}break;case"ENABLEPSRLOG":SiebelApp.S_App.CommToolbarUtil.SetEnablePSRLog();break;case"SETCLIENTPSRLOGLENGTH":if(!isNaN(T.value)){SiebelApp.S_App.CommToolbarUtil.SetClientPSRLogLength(T.value)}break;case"RESOURCESTRING":break;case"INITFAILED":if(T.value!==undefined&&T.value.length>0){var Z=this.GetParameter("Is508Compliance");if(Z!==undefined&&Z.toLowerCase()==="false"){w=false}this.SetAccessibility(w);this.ShowMsgOverCTIToolbar()}else{if(this.Is508Compliance()){this.ShowMsgOverCTIToolbar()}}break;case"ACCESSIBILITY":if(T.value===undefined){x(2,"Invalid command : "+T);return}else{if(T.value.toUpperCase()==="TRUE"){w=true}else{w=false}}this.SetAccessibility(w);break;case"CALLFROMUICOMMAND":if(T.value===undefined){x(2,"Invalid command : "+T);return}else{z=T.value}break;default:break}if(U){this.BlinkParentBtn()}};function M(){var P={BusComp:"",Field:""};var T=App();var S;var R;var Q;var V;var U;
if(T===undefined||T===null){x(2,"App() failed!");return P}S=T.GetMainView();if(S===undefined||S===null){x(2,"Get no main view!");return P}R=S.GetActiveApplet();if(R===undefined||R===null){x(2,"No active applet found!");return P}Q=R.GetBusComp();if(Q===undefined||Q===null){x(2,"No BC found for current active applet !")}else{P.BusComp=Q.GetName()}V=R.GetActiveControl();if(V===undefined||V===null){x(3,"No active control found for current active applet!")}else{U=V.GetFieldName();P.Field=U}return P}g.prototype.AddMessageToQ=function(P){if(j.length<10){j.push(P)}else{j.shift();j.push(P)}O=j.length};g.prototype.ShowNextMessage=function(){var P;if(j.length===0){return}if(O<j.length-1){P=j[++O]}else{O=j.length-1;P=j[j.length-1]}P=O+". "+P;if(this.Is508Compliance()){if(D.length>0){P=D+":\r\n"+P}this.ShowStatusTextForSI(P)}else{this.ShowStatusText(P,B)}};g.prototype.ShowPreviousMessage=function(){var P;if(j.length===0){return}if(O>0){P=j[--O]}else{P=j[0]}P=O+". "+P;if(this.Is508Compliance()){if(D.length>0){P=D+":\r\n"+P}this.ShowStatusTextForSI(P)}else{this.ShowStatusText(P,B)}};g.prototype.ShowStatusText=function(Q,P){};g.prototype.ShowStatusTextForSI=function(Q,P){};g.prototype.ShowMessageWithAlert=function(P){};g.prototype.TriggerEvent=function(Q,P){};g.prototype.UpdateHTMLControl=function(R,Q,P){};g.prototype.PlaySound=function(P){};g.prototype.FlashTitle=function(P){};g.prototype.BlinkParentBtn=function(){};g.prototype.SetLocalizationStrings=function(P){};g.prototype.GotoCTIToolbar=function(){};g.prototype.ShowMsgOverCTIToolbar=function(){};g.prototype.SetAccessibility=function(P){};g.prototype.UpdateCallContactFromUI=function(P){};g.prototype.ApplySticky=function(Q){var P=h(Q);if(P!==undefined&&P!==null&&P.m_bSticky===true){var R=l[P.m_iSeq];if(R!==undefined&&R!==null){I[R.m_name]=undefined;R.ReplaceInfo(P);R.SetEnabled("true");I[R.m_name]=R}}};g.prototype.CollectFocusInfo=function(){o=M()};g.prototype.ClearFocusInfo=function(){o=null};g.prototype.IsUseCookies=function(){return y};g.prototype.GetSessionName=function(){return d};g.prototype.GetSessionId=function(){return t};g.prototype.GetSessionRN=function(){return E};function k(){if(K===false){return true}var P=true;var S=App();if(S===undefined||S===null){x(2,"App() failed!");return P}var Q=App().GetMainView();if(Q===undefined||Q===null){x(2,"No main view found!");return P}var R=Q.GetActiveApplet();if(R===undefined||R===null){x(2,"No active applet found!");return P}P=R.InvokeMethod("ImplicitCommit",CCFMiscUtil_CreatePropSet());return P}function p(){if(SiebelApp.S_App.GetPopupPM().Get("state")===consts.get("POPUP_STATE_VISIBLE")){return true}else{return false}}g.prototype.SeriousRefIDError=function(){f++;x(1,"Serious Error <"+f+">: Ref ID is less than expected!");if(q>0&&f>=q){SiebelApp.S_App.CommToolbarUtil.StopPush();x(1,L);this.ExecuteCommand({name:"SHOWSTATUSTEXT",value:L})}};g.prototype.PushError=function(){r++;x(1,"Serious Error <"+r+">: Push Response Error!");if(q>0&&r>=q){SiebelApp.S_App.CommToolbarUtil.StopPush();x(1,L);this.ExecuteCommand({name:"SHOWSTATUSTEXT",value:L})}};g.prototype.SetMaxRefIDError=function(Q,P){if(!isNaN(Q)){q=Q}L=P};function x(Q,P){SiebelApp.S_App.CommToolbarUtil.Log(Q,"commToolbarpui.js: "+P)}g.prototype.CallContactFromUIEnabled=function(){return J};g.prototype.OpenCallContactFromUIPopup=function(P,Q){};function N(){var P=3;var Q=true;SiebelApp.S_App.CommToolbarUtil.SetLogLevel(P);e=Q}return new g()}())};