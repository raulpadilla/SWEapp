if(typeof(SiebelAppFacade.JSTreeRenderer)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.JSTreeRenderer");if(typeof(SiebelApp)!="undefined"&&typeof(SiebelApp.S_App)!="undefined"){if(typeof(SiebelApp.Constants)!="undefined"){SiebelApp.S_App.RegisterConstructorAgainstKey(SiebelApp.Constants.get("SWE_UIDEF_SCRTREE_PRENDR"),"SiebelAppFacade.JSTreeRenderer")}}SiebelAppFacade.JSTreeRenderer=(function(){var d=SiebelJS.Dependency("SiebelApp.Constants");var c=d.get("SWE_SCREEN_NAV_CONTROL_STR");var a=d.get("SWE_AGGR_VIEW_NAV_CONTROL_STR");var f=d.get("SWE_DET_VIEW_NAV_CONTROL_STR");var b=d.get("SWE_DET_SUB_VIEW_NAV_CONTROL_STR");function e(k){var i=k;this.GetPM=function(){return i};var l={};this.GetDataSet=function(){return l};this.EmptyDataSet=function(){l={}};if(this.GetPM().Get("IsScreen")){this.GetPM().AttachPMBinding("Refresh",this.BindData,{scope:this})}this.GetKey=function(){var n=d.get("SWE_PROP_NC_ID_SCREEN_CONTROL");var m=this.GetPM().Get("IsScreen")?"screenName":"viewName";this.GetKey=function(){return m};return m};var j=this;$(window).resize(function(){if(j.TreeLoaded){j.Refresh(true)}})}e.prototype.ShowUI=function(){var j=this.GetPM();var i=j.Get("GetType");var k=$("#"+i);SiebelJS.Log("[JSTreeRenderer] -> jqcontainer = "+k.length);if(i===d.get("SWE_PROP_NC_ID_VIEW_CONTROL")){if(($("div#"+d.get("SWE_PROP_NC_ID_SUB_VIEW_CONTROL"))).length!==0){i=d.get("SWE_PROP_NC_ID_SUB_VIEW_CONTROL")}}j.SetProperty("LevelPlaceholder",i);h.call(this,k)};function h(l){var k=this;if(l.length===1){l.dynatree({autoCollapse:true,imagePath:" ",classNames:{nodeIcon:null},clickFolderMode:3,minExpandLevel:1,persist:false,expandOnAdd:true,onPostInit:function(n,m){this.reactivate()},onClick:function(p,o){var r;var m=k.GetPM();if(p&&p.getEventTargetType(o)==="title"&&p.data.key){var s;if(p.data.isFolder===true){if(k.GetDataSet()!==null){r=k.GetDataSet()[p.data.key];s=r[m.Get("IsScreen")?"defaultViewName":k.GetKey()];r.viewName=s;if(m.Get("GetType")===d.get("SWE_PROP_NC_ID_SCREEN_CONTROL")){r.level=c}else{r.level=f}}}else{var n=m.Get("GetSelectedTabKey");var q=null;if(n!==null&&n!==undefined){r=m.Get("GetTabInfo")[n]}s=r.links[p.data.key].viewName;r.viewName=s;if(m.Get("GetType")===d.get("SWE_PROP_NC_ID_SCREEN_CONTROL")){r.level=a}else{r.level=b}}if(!m.OnControlEvent("OnClick",r)){return false}}return true}});var j=k.GetPM();var i=(j.Get("GetType")===d.get("SWE_PROP_NC_ID_SCREEN_CONTROL"))?"siebui-view-navs":"siebui-subview-navs";this.TreeLoaded=true}}e.prototype.BindEvents=function(){};e.prototype.BindData=function(){var j=this.GetPM();var q=j.Get("GetDataReload");var i=j.Get("GetTabInfo");var o=j.Get("GetSelectedTabLinkInfo");var p;var m;if(q){this.EmptyDataSet()}var l=this.GetDataSet();var k={};if(i!==null&&(q)){for(m in i){if(i.hasOwnProperty(m)){if(m.search("tabScreen")===-1){continue}p=i[m];l[p[this.GetKey()]]=p}}}var n=j.Get("GetSelectedTabKey");var s=null;if(n!==null&&n!==undefined&&i[n]!==undefined){s=i[n][this.GetKey()]}var r=false;if(o!==null&&l[s]!==undefined&&l[s].links===undefined){for(m in o){if(o.hasOwnProperty(m)){if(m.search("tabView")===-1){continue}p=o[m];k[p.viewName]=p}}l[s].links=k;r=true}if(q){r=true}this.Refresh(r)};e.prototype.Refresh=function(z){if(!z){return}var J=this.GetPM();if($("#"+J.Get("GetType")).dynatree("getRoot").length===0){return}$("#"+J.Get("GetType")).dynatree("getRoot").removeChildren();var B=J.Get("GetTabInfo")||{};var x=J.Get("GetSelectedTabLinkInfo")||{};var M=$("#"+J.Get("GetType")).dynatree("getRoot");var i;var m;var P;var s=true;if(J.Get("IsScreen")){i=M.addChild({title:"Screens",key:"AllScreens",addClass:"dynatree-root-tag",isFolder:true,expand:true,url:null})}else{i=M}var r=J.Get("GetSelectedTabKey");var u=null;if(r!==null&&r!==undefined){u=(B[r]||B.tabScreen0)[this.GetKey()]}u=String(u);var w=J.Get("GetSelectedLinkKey");var n=null;if(w!==null&&w!==undefined){n=x[w]?x[w].viewName:""}n=String(n);var l=($("#"+J.Get("GetType")).width())>($("#"+J.Get("GetType")).height())?1:0;var A=l?$("#"+J.Get("GetType")).width():$("#"+J.Get("GetType")).height();var v=45;var C=false;var y="j_"+J.Get("GetType");var N=(J.Get("IsScreen"))?"siebui-nav-screenlist":"siebui-nav-viewlist";var L='<select id="'+y+'" class="'+N+'"><option></option>';var H=false;var O=(J.Get("GetTabInfo")[J.Get("GetSelectedTabKey")]||J.Get("GetTabInfo")["tabScreen0"]);var I=null;I=i.addChild({title:O.captionName,isFolder:true,url:O.captionName,icon:O.tabIcon,activate:(O.captionName===u),addClass:(O.captionName===u)?"screen-tab-selected":"screen-tab-deselected",expand:O.captionName===u,key:O});var o=$($(I)[0].li).outerWidth(true);v+=o;i.removeChildren();$("#"+y).remove();var K=0;var p=0;for(var j in this.GetDataSet()){if(!C){m=i.addChild({title:this.GetDataSet()[j].captionName,isFolder:true,url:this.GetDataSet()[j].captionName,icon:this.GetDataSet()[j].tabIcon,activate:(j===u),addClass:(j===u)?"screen-tab-selected":"screen-tab-deselected",expand:j===u,key:j});if(j===u){H=true;v-=o}for(P in this.GetDataSet()[j].links){if(this.GetDataSet()[j].links.hasOwnProperty(P)){if(s&&J.Get("LevelPlaceholder")===d.get("SWE_PROP_NC_ID_SUB_VIEW_CONTROL")){h.call(this,$("#"+J.Get("LevelPlaceholder")));if($("#"+J.Get("LevelPlaceholder")).dynatree("getRoot").length===0){return}$("#"+J.Get("LevelPlaceholder")).dynatree("getRoot").removeChildren();m=$("#"+J.Get("LevelPlaceholder")).dynatree("getRoot");s=false}var k=m.addChild({title:this.GetDataSet()[j].links[P].captionName,isFolder:false,url:this.GetDataSet()[j].links[P].captionName,activate:P===n,addClass:(J.Get("LevelPlaceholder")===d.get("SWE_PROP_NC_ID_SUB_VIEW_CONTROL")?((P===n)?"screen-tab-selected":"screen-tab-deselected"):((P===n)?"view-tab-selected":"view-tab-deselected")),key:P})}}var E=l?$($(m)[0].li).outerWidth(true):$($(m)[0].li).outerHeight(true);if((v+E)<=A){v+=E}else{if(l){C=true;m.remove();L+="<option value = "+(this.GetDataSet()[j].captionName)+">"+(this.GetDataSet()[j].captionName)+"</option>";p++}}}else{L+="<option value = "+(this.GetDataSet()[j].captionName)+">"+(this.GetDataSet()[j].captionName)+"</option>";p++}K++}if(C){L+="</select>";$("#"+J.Get("GetType")).append(L);var G=this.GetDataSet()[u].captionName;$("#"+y).find("option").each(function(){if(String(G)===$(this).text()){$(this).remove()}})}if(!H){var t=(J.Get("IsScreen"))?String(O.screenName):String(O.viewName);m=i.addChild({title:O.captionName,isFolder:true,url:O.captionName,icon:O.tabIcon,activate:(t===u),addClass:(t===u)?"screen-tab-selected":"screen-tab-deselected",expand:t===u,key:t});for(P in O.links){if(O.links.hasOwnProperty(P)){var F=m.addChild({title:O.links[P].captionName,isFolder:false,url:O.links[P].captionName,activate:P===n,key:P})}}}var q=this;$("#"+y).change(function(){var R=$("#"+y).find("option:selected").text();var S="";for(var Q in data_set){if(data_set.hasOwnProperty(Q)){if(R===String(data_set[Q].captionName)){S=data_set[Q].viewName;data_set[Q]["level"]=f;if(!S){data_set[Q]["viewName"]=data_set[Q].defaultViewName}J.OnControlEvent("OnClick",data_set[Q])}}}});var D={};
D.comboContainer=y;D.chtotal=K;D.count=p;D.overflow=C;g.call(this,i,D)};function g(y,A){var p=this.GetPM();var r=p.Get("GetTabContainerQTPInfo");var k=p.Get("GetTabItemsQTPInfo");var u=p.Get("IsScreen")?(p.Get("GetTabInfo")[p.Get("GetSelectedTabKey")]&&p.Get("GetTabInfo")[p.Get("GetSelectedTabKey")].screenName):(p.Get("GetTabInfo")[p.Get("GetSelectedTabKey")]&&p.Get("GetTabInfo")[p.Get("GetSelectedTabKey")].viewName);var x=p.Get("GetTabViewLinkContainerQTPInfo");var m=p.Get("GetTabViewLinkItemsQTPInfo");var q=d.get("SWE_PROP_QTP_OT");var w=d.get("SWE_PROP_QTP_RN");var v=d.get("SWE_PROP_QTP_UN");if(r&&(typeof(r.GetProperty)==="function")){y.ul.setAttribute("ot",r.GetProperty(q));y.ul.setAttribute("rn",r.GetProperty(w));y.ul.setAttribute("un",r.GetProperty(v))}for(var t=0;t<y.getChildren().length;t++){var l=y.getChildren()[t];if(k[t]&&(typeof(k[t].GetProperty)==="function")){l.li.setAttribute("ot",k[t].GetProperty(q));l.li.setAttribute("rn",k[t].GetProperty(w));l.li.setAttribute("un",k[t].GetProperty(v))}if((l.getChildren()!==null)&&(u===l.data.key)){if(x&&(typeof(x.GetProperty)==="function")){l.ul.setAttribute("ot",x.GetProperty(SiebelApp.Constants.get(q)));l.ul.setAttribute("rn",x.GetProperty(SiebelApp.Constants.get(w)));l.ul.setAttribute("un",x.GetProperty(SiebelApp.Constants.get(v)))}for(var s=0;s<l.getChildren().length;s++){var o=l.getChildren()[s];if(m[s]&&(typeof(m[s].GetProperty)==="function")){o.li.setAttribute("ot",m[s].GetProperty(q));o.li.setAttribute("rn",m[s].GetProperty(w));o.li.setAttribute("un",m[s].GetProperty(v))}}}}if(!A.overflow){return}var y=$("#"+A.comboContainer);var z=p.Get("GetJumpTabQTPInfo");var q=d.get("SWE_PROP_QTP_OT");var w=d.get("SWE_PROP_QTP_RN");var v=d.get("SWE_PROP_QTP_UN");var n=A.chtotal-A.count;if(z&&(typeof(z.GetProperty)==="function")){y.attr("ot",z.GetProperty(q));y.attr("rn",z.GetProperty(w));y.attr("un",z.GetProperty(v))}l=y.children("option");var s=1;for(t=n;t<A.chtotal&&l.length>0;t++){if(k[t]&&(typeof(k[t].GetProperty)==="function")){l.eq(s).attr("ot",k[t].GetProperty(q));l.eq(s).attr("rn",k[t].GetProperty(w));l.eq(s).attr("un",k[t].GetProperty(v));s++}}}return e}())};