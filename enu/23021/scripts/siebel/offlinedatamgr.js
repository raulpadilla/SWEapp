if(typeof(SiebelApp.OfflineDataMgr)==="undefined"){Namespace("SiebelApp.OfflineDataMgr");SiebelApp.OfflineDataMgr=(function(){var n=SiebelApp.OfflineCacheConfig;var f=new m();var i=SiebelJS.Dependency("SiebelApp.Constants");var d=SiebelApp.Offlineconstants;var k=SiebelJS.Dependency("SiebelApp.Utils");var l;var c;var j;var b;var e;var a;var g={};var h=[];function m(){var o;p=function p(){return o};p.prototype=this;o=new p();o.constructor=p;return o}m.prototype.InsertJsonRecord=function(p){var o=this.JsonRecordSet(p);window.localStorage.setItem(o.SweCommands.SWERowId,o.RecordSet);return o.Request};m.prototype.DeleteJsonRecord=function(p){var o=this.JsonRecordSet(p);window.localStorage.removeItem(o.SweCommands.SWERowId)};m.prototype.JsonRecordSet=function(u){var p={};var D={};var x=[];var t=[];var L=[];var A=[];var s;var M={};var z;var J=[];var y;var w=u.indexOf("?");var I;var H;var G;w=w+1;var E=u.substring(w,u.length);z=u.substring(0,w);var K=E.split("&");for(I=0;I<K.length;I++){if(K[I].search("OF_")===-1){t.push(K[I]);if(K[I]==="SWEMethod=DeleteRecord"){y="DeleteRecord"}}else{L.push(K[I])}}for(I=0;I<L.length;I++){w=L[I].indexOf("_")+1;A.push(L[I].substring(w,L[I].length))}for(I=0;I<A.length;I++){x.push(A[I].split("="))}for(I=0;I<x.length;I++){var r=x[I];for(H=0;H<1;H++){G=H+1;var o=unescape(r[H]);p[o]=unescape(r[G])}}s=t.join("&");s=z+s;for(I=0;I<t.length;I++){J.push(t[I].split("="))}for(I=0;I<J.length;I++){var v=J[I];for(H=0;H<1;H++){G=H+1;var B=unescape(v[H]);D[B]=unescape(v[G])}}var F=unescape(D.SWEView);var q=unescape(D.SWEActiveApplet);p.Id=D.SWERowId;p.MethodName=D.SWEMethod;if(!p.MethodName&&y){p.MethodName=y}if(K[0]!==undefined){D.SWEField=K[0].split("=")[1]}var C=JSON.stringify(p);M.Request=s;M.SweCommands=D;M.RecordSet=C;M.FieldValue=x;return M};m.prototype.GetFieldPos=function(t,r,q){var p=q.length;for(var o=0;o<p;o++){var s=q[o];s=SiebelApp.S_App.LookupStringCache(s);if(s===t){r[0]=(o).toString();return r}}return -1};m.prototype.UpdateDataStore=function(A,p,t,u){var H=SiebelApp.OfflineUtils.RemoveNonAlphaChars(A.SweCommands.bci);var D=0;var y=A.FieldValue.length;for(var G=0;G<y;G++){for(var F=0;F<2;F++){if(A.FieldValue[G][F+1]){g[k.UrlDecode(unescape(A.FieldValue[G][F]))]=k.UrlDecode(unescape(A.FieldValue[G][F+1]))}F=F+1}}if((SiebelApp.OfflineDataMgr.IsNewRecord())){SiebelApp.OfflineDataMgr.CreateNewRecord(A,H,p,t,u)}else{var E=[];var s=[];var o="";var C;for(o in g){C=SiebelApp.OfflineUtils.RemoveNonAlphaChars(o);if(o!=="OF_ParentIdTagOld"&&SiebelApp.BrowserCacheMgr.DoesFieldExist(H,C)){s[D]=C;E[D]=g[o];D++}}if(g.OF_ParentIdTag&&g.OF_ParentIdTag!==d.get("STRINGUNDEFINED")&&g.OF_ParentIdTag!==d.get("STRINGNULL")){var v=g.OF_ParentIdTag.split(",");var w=g.OF_ParentIdTagOld.split(",");var x=v.length;var q;var B;var r;if(x>0){q=[d.get("COL_PARENT_TAG")]}for(var z=0;z<x;z++){B=[v[z]];r=[w[z]];SiebelApp.BrowserCacheMgr.UpdateRecord(H,s,E,i.get("SWE_ROW_ID_FIELD"),A.SweCommands.SWERowId,q,r,B);SiebelApp.OfflineDataMgr.UpdateRelatedBC(H,A,s,E,q,v,w,x)}}else{SiebelApp.BrowserCacheMgr.UpdateRecord(H,s,E,i.get("SWE_ROW_ID_FIELD"),A.SweCommands.SWERowId);SiebelApp.OfflineDataMgr.UpdateRelatedBC(H,A,s,E)}SiebelApp.OfflineAppMgr.ReturnCachedResponse(p,t,u);h=[];g={}}SiebelApp.OfflineDataMgr.SetRecordParam(false);return true};m.prototype.UpdateRelatedBC=function(q,u,x,p,o,s,w,v){var r=k.UrlDecode(u.SweCommands.bci);var t="SELECT * FROM BCPartners WHERE BC like '%,"+r+"' OR BC like '%,"+r+",%' OR BC like '"+r+",%'";SiebelApp.BrowserCacheMgr.Execute(t,function(E){if(E){var y=E.BC.split(",");var D=y.length;var L=[];var C=0;for(var F=0;F<D;F++){y[F]=SiebelApp.OfflineUtils.RemoveNonAlphaChars(y[F]);if(y[F]!==q){L[C]=y[F];C++}}var B=L.length;var J=x.length;var N;var z;var G;for(var H=0;H<B;H++){G=L[H];if(SiebelApp.BrowserCacheMgr.DoesTableExist(G)){N=[];z=[];for(var K=0;K<J;K++){if(SiebelApp.BrowserCacheMgr.DoesFieldExist(G,x[K])){N.push(x[K]);z.push(p[K])}}if(o){var A;var M;for(var I=0;I<v;I++){A=[s[I]];M=[w[I]];SiebelApp.BrowserCacheMgr.UpdateRecord(G,N,z,i.get("SWE_ROW_ID_FIELD"),u.SweCommands.SWERowId,o,M,A)}}else{SiebelApp.BrowserCacheMgr.UpdateRecord(G,N,z,i.get("SWE_ROW_ID_FIELD"),u.SweCommands.SWERowId)}}}}})};m.prototype.DeleteDataStoreRec=function(x){var p=SiebelApp.OfflineUtils.RemoveNonAlphaChars(x.SweCommands.bci);var r;var v;var q=x.SweCommands.SWERowId;var A=function(B){SiebelApp.BrowserCacheMgr.DeleteRecord(p,i.get("SWE_ROW_ID_FIELD"),q);r=k.UrlDecode(B.SweCommands.bci);v="SELECT * FROM BCPartners WHERE BC like '%,"+r+"' OR BC like '%,"+r+",%' OR BC like '"+r+",%'";SiebelApp.BrowserCacheMgr.Execute(v,function(D){if(D){var E=D.BC.split(",");var F=E.length;for(var C=0;C<F;C++){E[C]=SiebelApp.OfflineUtils.RemoveNonAlphaChars(E[C]);if(E[C]!==p&&SiebelApp.BrowserCacheMgr.DoesTableExist(E[C])){SiebelApp.BrowserCacheMgr.DeleteRecord(E[C],i.get("SWE_ROW_ID_FIELD"),q)}}}})};if(x.SweCommands.SWERowIds){var s=((x.SweCommands.SWERowIds.split("="))[1]);var t=function(B){if(B&&B.Response&&SiebelApp.RequestProcessor.IsAssoc(B.Response)){SiebelApp.BrowserCacheMgr.UpdateRecord(p,[d.get("COL_PARENT_TAG")],[s],i.get("SWE_ROW_ID_FIELD"),q,[d.get("COL_PARENT_TAG")],[s],[""]);r=k.UrlDecode(x.SweCommands.bci);v="SELECT * FROM BCPartners WHERE BC like '%,"+r+"' OR BC like '%,"+r+",%' OR BC like '"+r+",%'";SiebelApp.BrowserCacheMgr.Execute(v,function(D){if(D){var E=D.BC.split(",");var F=E.length;for(var C=0;C<F;C++){E[C]=SiebelApp.OfflineUtils.RemoveNonAlphaChars(E[C]);if(E[C]!==p&&SiebelApp.BrowserCacheMgr.DoesTableExist(E[C])){SiebelApp.BrowserCacheMgr.UpdateRecord(E[C],[d.get("COL_PARENT_TAG")],[s],i.get("SWE_ROW_ID_FIELD"),q,[d.get("COL_PARENT_TAG")],[s],[""])}}}})}else{A(x)}};var y=k.UrlDecode(x.SweCommands.SWEView);var o=k.UrlDecode(x.SweCommands.SWEApplet);var u=y.concat("/",o);var w=d.get("NEW_VIEW_INFO");var z=d.get("NEWRECORD");z=SiebelApp.RequestProcessor.GetCmdTag(z);SiebelApp.BrowserCacheMgr.GetPCachedResponseExt("",t,z,u,w)}else{A(x)}return true};m.prototype.CreateNewRecord=function(D,J,r,w,x){var v=SiebelApp.BrowserCacheMgr.GetViewTagInfo();var B=k.UrlDecode(D.SweCommands[i.get("SWE_VIEW_ARG")]);var A=SiebelApp.BrowserCacheMgr.GetTag(B,v);var z=D.SweCommands[d.get("NEW_APP_TAG_INFO")];var L;var y;var M=z.split("/");var C=M.length-1;var u=false;L=SiebelApp.BrowserCacheMgr.GetTag(k.UrlDecode(M[0]),v);var I;for(var H=1,t=(A+"."+L);H<C;H++){L=SiebelApp.BrowserCacheMgr.GetTag(k.UrlDecode(M[H]),v);I=A+"."+L;t=t.concat(",",I)}g.OF_New="Y";g.OF_ViewTag=t;if(D.SweCommands.SWERowIds){u=true;var K=((D.SweCommands.SWERowIds.split("="))[1]);if(g.hasOwnProperty(d.get("COL_PARENT_TAG"))){g.OF_ParentIdTag=SiebelApp.OfflineDataMgr.PrepareOFParentTag(g.OF_ParentIdTag,K)}else{g.OF_ParentIdTag=K}}var p="";var F=0;var G=[];var s=[];var E;for(p in g){E=SiebelApp.OfflineUtils.RemoveNonAlphaChars(p);if(p!=="OF_ParentIdTagOld"&&SiebelApp.BrowserCacheMgr.DoesFieldExist(J,E)){s[F]=E;G[F]=g[p];F++}}SiebelApp.BrowserCacheMgr.DBInitialize(n.get("PRO_DATASTORE_DB"));SiebelApp.BrowserCacheMgr.InsertRecord(J,s,G);
SiebelApp.OfflineDataMgr.SetNewRecordCommit(false);g={};h=[];SiebelApp.OfflineAppMgr.ReturnCachedResponse(r,w,x);var o=k.UrlDecode(D.SweCommands.bci);var q="SELECT * FROM BCPartners WHERE BC like '%,"+o+"' OR BC like '%,"+o+",%' OR BC like '"+o+",%'";SiebelApp.BrowserCacheMgr.Execute(q,function(T){if(T){var O=T.BC.split(",");var S=O.length;var Z=[];var R=0;for(var U=0;U<S;U++){O[U]=SiebelApp.OfflineUtils.RemoveNonAlphaChars(O[U]);if(O[U]!==J){Z[R]=O[U];R++}}var Q=Z.length;var W=s.length;var aa;var P;var Y;var N;for(var V=0;V<Q;V++){aa=[];P=[];Y=Z[V];for(var X=0;X<W;X++){if(SiebelApp.BrowserCacheMgr.DoesFieldExist(Y,s[X])){aa.push(s[X]);P.push(G[X])}}N=u?4:3;if(aa.length>N){SiebelApp.BrowserCacheMgr.InsertRecord(Y,aa,P)}}u=false}});return true};m.prototype.GetTempId=function(){var p=((new Date()).getTime());p=(p).toString(36);if(p.length>6){p=p.substring(p.length-6)}var q=(Math.round((Math.random()*46655))).toString(36);var o=(Math.round((Math.random()*46655))).toString(36);var r=(p.concat(":",q,o)).toUpperCase();return r};m.prototype.SetRecordParam=function(o,q){if(o){g={};h=[];var p=k.DecodeFromQueryString(q);if(unescape(p.GetProperty("SWEMethod"))==="NewRecord"||unescape(p.GetProperty("SWEMethod"))==="CreateRecord"){j=SiebelApp.OfflineDataMgr.GetTempId();c=unescape(p.GetProperty("SWEView"));l=unescape(p.GetProperty("SWEApplet"));b=i.get("SWE_PST_APPLET_MODE_NEW");a=SiebelApp.OfflineUtils.RemoveNonAlphaChars(unescape(p.GetProperty("bci")));SiebelApp.OfflineAppMgr.SetWriteDone(false)}else{if(unescape(p.GetProperty("SWEMethod"))==="EditRecord"){j=unescape(p.GetProperty("SWERowId"));c=unescape(p.GetProperty("SWEView"));l=unescape(p.GetProperty("SWEApplet"));b=i.get("SWE_PST_APPLET_MODE_EDIT")}}}else{j="";c="";b="";a=""}};m.prototype.GetRecordParam=function(){var o={};o.RowId=j;o.ViewName=c;o.AppletName=l;o.State=b;o.BC=a;return o};m.prototype.IsNewRecord=function(){return e};m.prototype.SetNewRecordCommit=function(o){e=o;if(!o){SiebelApp.OfflineAppMgr.SetWriteDone(true)}};m.prototype.GetRecordObj=function(){return g};m.prototype.GetPickInst=function(){return h};m.prototype.PrepareOFParentTag=function(x,r,o){var v;var p;var t;var w;if(r){t=r.split(",");p=t.length}if(o){w=o.split(",")}if(x){var y=x.split(",");var q=y.length;for(var s=0;s<p;s++){if(o){for(var u=0;u<q;u++){if(y[u]===(w[s])){y[u]=(t[s])}}}else{y[q]=t[0]}}v=y.join()}else{v=t[0]}return v};m.prototype.UpdateRecordInst=function(q,w,v){if(!w||(w===d.get("STRINGUNDEFINED"))){w=d.get("STRINGNULL")}var x=g.OF_ParentIdTag;var s=g.OF_ParentIdTagOld;var t=h;var o;var p;var u;if(t){var y=t.length;for(var r=0;r<y;){if(t[r].BC===v){o=t[r].BC;p=t[r].Id;break}r++}}if(x){if(o){g.OF_ParentIdTag=SiebelApp.OfflineDataMgr.PrepareOFParentTag(x,q,p);h[r].Id=q}else{g.OF_ParentIdTag=x.concat(",",q);g.OF_ParentIdTagOld=s.concat(",",w);u={BC:v,Id:q};h.push(u)}}else{g.OF_ParentIdTag=q;g.OF_ParentIdTagOld=w;u={BC:v,Id:q};h.push(u)}};return f}())};