/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2013 Oracle and/or its affiliates. All rights reserved.
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
if(typeof(SiebelApp.OfflineAppMgr)==="undefined"){SiebelJS.Namespace("SiebelApp.OfflineAppMgr");SiebelApp.OfflineAppMgr=(function(){var a=new c();var q=SiebelApp.Offlineconstants;var o=SiebelJS.Dependency("SiebelApp.Constants");var w=SiebelJS.Dependency("SiebelApp.Utils");var u=q.get("IS_DYNAMIC");var s=q.get("CUD_RESPONSE");var x=q.get("SHOW_POPUP");var t=q.get("SWEMETHOD");var g=q.get("BUILDSCREEN_BS_DRILLDOWN");var k=q.get("BUILDSCREEN_BS_DRILLDOWNBYFIELD");var d=q.get("BUILDSCREEN_BS_ALTERNATE");var f=q.get("BUILDSCREEN_BS_NORMAL");var n=q.get("BUILDSCREEN_BS_DRILLDOWNCUSTOM");var e=true;var i={Method:null,Action:null,Type:null};var m={context:"",type:"",objname:""};var A=[];var y="";var j="";var b=[];var l={};function c(){var J;var G=[];var C={BC:[],prevBC:[],RowId:""};var E=window.localStorage;var H;var I={};var F=[];var B=false;if(!(JSON.parse(E.getItem("CacheType")))){E.setItem("CacheType",JSON.stringify("Reactive"))}this.SetCacheType=function(K){E.setItem("CacheType",JSON.stringify(K))};this.GetCacheType=function(){return(JSON.parse(E.getItem("CacheType")))};this.CallPendingOp=function(){I.asyncFn.apply(I.scope,I.args)};this.HasPendingOp=function(){return B};this.SetPendingOp=function(N,L,K,M){if(N){I.asyncFn=L;I.args=K;I.scope=M}else{I={}}B=N};this.SetStatus=function(K){j=K};this.GetStatus=function(K){return j};this.GetControlRegExpMap=function(){return l};this.SetControlRegExpMap=function(K){l=K};D=function D(){return J};this.SetCmdMap=function(){G.push({cmd:"GotoView",cmdTag:"oinf"});G.push({cmd:"GotoViewCold",cmdTag:"oinf"});G.push({cmd:"GetViewLayout",cmdTag:"gvl"});G.push({cmd:"GetAppletLayout",cmdTag:"nl"});G.push({cmd:"NewRecord",cmdTag:"nr"});G.push({cmd:"EditRecord",cmdTag:"er"});G.push({cmd:"WriteRecord",cmdTag:"wr"});G.push({cmd:"DeleteRecord",cmdTag:"dl"});G.push({cmd:"AddRecord",cmdTag:"ar"});G.push({cmd:"GetCachedFrame",cmdTag:"gcf"});G.push({cmd:"GotoPostedAction",cmdTag:"gpa"});G.push({cmd:"EditField",cmdTag:"ef"});G.push({cmd:"NewLayout",cmdTag:"nl"});G.push({cmd:"CreateRecord",cmdTag:"cr"});G.push({cmd:"ShowPopup",cmdTag:"puoinf"});E.setItem("cmdMap",JSON.stringify(G))};this.GetCmdMap=function(){if(E.getItem("cmdMap")){return(JSON.parse(E.getItem("cmdMap")))}else{this.SetCmdMap();return(JSON.parse(E.getItem("cmdMap")))}};this.GetOfflineAppContext=function(){return C};$.extend({callback:function(L,K){var M=SiebelApp.OfflineAppMgr;var N;if(K){if(!M.CheckResolvedState()){$.when.apply($,A).done(function(O){if(!(M.CheckResolvedState())){$.callback(L,K)}else{N=y;y={err:false};K.call(L,N)}})}else{N=y;y={err:false};K.call(L,N)}}else{$.setReturnValue({err:true})}},setReturnValue:function(K){y=K},eachAsyncOp:function(N,M){if(!(M instanceof Array)){if(!M){return}M=[M]}else{if(!M.length){return}}var L=0;var K=M.length;var O=SiebelApp.OfflineAppMgr;var P=function(Q){$.setReturnValue(Q);if(L<K-1){L++;O.HandleSingleObj(N,M[L]);$.callback(O,P)}};O.HandleSingleObj(N,M[L]);$.callback(O,P)}});D.prototype=this;J=new D();J.constructor=D;return J}c.prototype.ClearDeferredArray=function(){A=[]};c.prototype.GetCurrentRetVal=function(){return y};c.prototype.PopulateDeferredArray=function(B){A.push(B)};c.prototype.RemoveObj=function(B){for(var C=0;C<A.length;C++){if(A[C]===B){break}}A.splice(C,1)};c.prototype.CheckResolvedState=function(){var B=A.length;for(var C=B-1;C>-1;C--){if((A[C].state()!=="resolved")){return false}}return true};c.prototype.HandleSingleObj=function(M,C){var F=M;var H=C.preExecute;var I=C.postExecute;var E=C.execute;var B=C.executeScope;var K=C.iterations;var L;if(!K){K=1}var G=0;var J=this;if(H){L=H.call(F,G)}else{L=[]}var D=function(N){if(I){I.call(F,N)}if(G<K-1){G++;if(H){L=H.call(F,G)}else{L=[]}E.apply(B,L);$.callback(J,D)}};E.apply(B,L);$.callback(J,D)};c.prototype.HandleNullResponse=function(F){var D=0;var B=w.DecodeFromQueryString(F);var C=B.GetProperty(q.get("SWECMD"));if(C==="GetLastTxn"){D="IDS_DOUI_ERR_SYNC";var E=SiebelApp.S_App.OfflineLocaleObject.GetLocalString(D);alert(E)}else{SiebelApp.OfflineAppMgr.HandleValidation(D)}};c.prototype.OfflineRequestHandler=function(C,D,B){this.ClearDeferredArray();if(SiebelApp.RequestProcessor.IsSupported(C,false,D)){SiebelApp.RequestProcessor.ProcessReq(C,D,B)}};c.prototype.HandleCallback=function(D,B,C){this.AddDefHandlers(D,B,C)};c.prototype.HandleValidation=function(B){SiebelApp.S_App.uiStatus.Free()};c.prototype.IsCachableRequest=function(E){var D=[".js",".htm"];if(E!=="undefined"&&E!==""){for(var C=0;C<D.length;C++){var B=D[C];if(E.indexOf(B)!==-1){return false}}return true}else{return false}};c.prototype.CacheResponse=function(E,C){if(!SiebelApp.OfflineAppSettings.GetMode()&&!SiebelApp.S_App.GetActiveView()&&SiebelApp.OfflineAppMgr.IsCachableRequest(E)&&C[0]&&C[0]!=="undefined"&&C[0]!==""&&(SiebelApp.RequestProcessor.IsSupported(E))){if(C[0].indexOf("SBL-UIF-00335")!==-1){var B=window.location.pathname;B=B.concat("?SWENeedContext=false&SWECmd=Logoff&SWEBID=-1&SRN=&SWETS=");Top().location.replace(B);return false}var G=this.GetCacheType();var F={};if((E.search("scriptfiles.txt")!==-1)){F.SweCmd=q.get("TEXT");F.ObjName="scriptfiles";F.Response=C[0];F.Type=q.get("DEFAULT_VIEW_INFO")}else{var D=w.DecodeFromQueryString(E);F.SweCmd=SiebelApp.RequestProcessor.GetCmdTag(D.GetPropertyAsStr("SWECmd"));F.ObjName=D.GetPropertyAsStr("SWEFrame");F.Response=C[0];F.Type=q.get("DEFAULT_VIEW_INFO")}if(F.ObjName){SiebelApp.BrowserCacheMgr.CacheOnlineOp(F)}return true}};c.prototype.SetContext=function(B,C,D){m={};m.context=B;m.type=C;m.objname=D};c.prototype.GetContext=function(){return m};c.prototype.ClearContext=function(){m={}};c.prototype.InvokeMethod=function(B,C,E,D){if(B.GetProperty(o.get("SWE_APPLET_STR"))){this.InvokeAppletMethod(B,C,E,D);$.callback(this,function(F){if(F.err){$.setReturnValue({err:true});return}})}else{if(B.GetProperty(o.get("SWE_SERVICE"))&&B.GetProperty(o.get("SWE_SERVICE"))!==""){this.InvokeServiceMethod(B,C,E,D);$.callback(this,function(F){if(F.err){$.setReturnValue(F);return}})}else{E.apply(this,[q.get("CUD_RESPONSE")])}}};c.prototype.ClearPostedActions=function(){i={}};c.prototype.GetPostedAction=function(){return i};c.prototype.PostActions=function(D,B,C){i={};i.Method=B;i.Action=D;i.Type=C};c.prototype.BuildViewAsync=function(B,C,D){i={};i.Method=q.get("GOTOVIEW");i.Action=q.get("ACTION_RPC_BUILD_VIEW_ASYNC");i.Type=q.get("VIEW_INFO");i.ViewName=B;i.DrilldownDef=D;i.BuildScreenType=C};c.prototype.ClearQueueMethod=function(){b=[]};c.prototype.QueueMethod=function(E,B,F,C){var D={};D.objName=E;D.methodName=B;D.psInputArgs=F;if(C){D.methodType=C}else{D.methodType=q.get("TYPE_FRAME")}b.push(D)};function h(G){if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().StartTime("OfflineAppMgr.prototype.DoPostedActions")}var E=CCFMiscUtil_CreatePropSet();switch(i.Action){case q.get("ACTION_RPC_REFRESH_VIEW"):var F=SiebelApp.S_App.GetActiveView().GetName();var B=SiebelApp.S_App.GetActiveView().GetActiveApplet();var D=SiebelApp.AjaxRequestMgr.GetActiveRequest();var H=w.DecodeFromQueryString(D.data);
var C=H.GetProperty(t).toString();if(C==="UndoRecord"||C==="WriteRecord"){B.SetActiveControl(null)}if((i.Method!==q.get("GOTOVIEW"))&&(i.Method!==q.get("GOTOVIEWCOLD"))){F=F.concat("/",B.GetName())}SiebelApp.OfflineAppMgr.ShowView(G.request,i.Method,G.callback,F,i.Type,q.get("REFRESHLAYOUT"));break;case q.get("ACTION_RPC_COMPLETED"):SiebelApp.OfflineAppMgr.GetReturnPropSet(o.get("SWE_RPC_PROP_STATUS_COMPLETED"),E,G.request,G.callback);break;case q.get("ACTION_RPC_CONTINUE"):SiebelApp.OfflineAppMgr.GetReturnPropSet(o.get("SWE_RPC_PROP_STATUS_CONTINUE"),E,G.request,G.callback);break;case q.get("ACTION_RPC_CLOSE_POPUP"):SiebelApp.OfflineAppMgr.GetReturnPropSet(o.get("SWE_RPC_PROP_CLOSE_POPUP"),E,G.request,G.callback);break;case q.get("ACTION_RPC_BUILD_VIEW_ASYNC"):F=i.ViewName;SiebelApp.OfflineAppMgr.ShowView(G.request,i.Method,G.callback,F,i.Type,"",i.BuildScreenType,i.DrilldownDef);break}$.callback(this,function(I){$.setReturnValue(I);if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().EndTime("OfflineAppMgr.prototype.DoPostedActions")}});return}c.prototype.ShowViewOrApplet=function(D,G){if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().StartTime("OfflineAppMgr.prototype.ShowViewOrApplet")}var C=this.GetContext();var F=C.objname;if(!F){var B=SiebelApp.S_App.GetActiveView().GetName();var E=SiebelApp.S_App.GetActiveView().GetActiveApplet().GetName();F=B.concat("/",E)}if(C.context===o.get("SWE_RPC_PROP_APPLET")){SiebelApp.OfflineAppMgr.ShowView(G.request,D,G.callback,F,C.type,q.get("NEWPOPUP"))}else{if(C.context===o.get("SWE_RPC_PROP_VIEW")){SiebelApp.OfflineAppMgr.ShowView(G.request,D,G.callback,F,C.type)}}SiebelApp.OfflineAppMgr.ClearContext();$.callback(this,function(H){$.setReturnValue(H);if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().EndTime("OfflineAppMgr.prototype.ShowViewOrApplet")}})};c.prototype.ShowView=function(C,B,J,F,H,E,K,G){if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().StartTime("OfflineAppMgr.prototype.ShowView")}if(!E){var D=SiebelApp.S_App.GetActiveView();if(D){var I=w.DecodeFromQueryString(C).GetPropertyAsStr("SWESP");if(w.IsTrue(I)){E=q.get("NEWPOPUP")}else{E=q.get("NEWLAYOUT")}}else{E=q.get("NEWLAYOUT")}}SiebelApp.S_App.BuildView(C,B,J,F,H);$.callback(this,function(M){var L=CCFMiscUtil_CreatePropSet();L.DecodeFromString(M.retVal);SiebelApp.OfflineAppMgr.GetReturnPropSet(E,L,C,J,K,G);$.callback(this,function(N){$.setReturnValue(N);if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().EndTime("OfflineAppMgr.prototype.ShowView")}})})};c.prototype.GetReturnPropSet=function(V,C,T,H,X,P){if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().StartTime("OfflineAppMgr.prototype.GetReturnPropSet")}var E=o.get("SWE_RPC_PROP_NEW_POPUP");var N=SiebelApp.S_App;var I=null;var G=[];var L="";var M="";this.SetStatus(V);var K;var S;C.SetPropertyStr(q.get("STATUS"),V);var Y=o.get("SWE_PROP_SESSION_RANDOM_NUMBER");var J=window.localStorage.getItem(Y);if(J){C.SetPropertyStr(Y,J)}if(V!==q.get("REFRESHLAYOUT")&&V!==q.get("NEWLAYOUT")&&V!==q.get("NEWPOPUP")){C.SetPropertyStr(q.get("STATUS"),V);var D=N.GetActiveView();if(D){D.GetNotifyPropSet(C,T)}$.callback(this,function(Z){if(!Z.err){L=C.EncodeAsString();G[0]=L;H.apply(N,G);$.callback(this,function(aa){$.setReturnValue(aa);if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().EndTime("OfflineAppMgr.prototype.GetReturnPropSet")}})}else{$.setReturnValue(Z)}})}else{if(typeof T==="string"){M=w.DecodeFromQueryString(T)}K=w.IsEmpty(P)?"":P.viewname;var O=N.GetActiveView();var U=w.IsEmpty(O)?"":O.GetName();var B;var R=false;var W=M.GetProperty(o.get("SWE_ARG_KEEP_CONTEXT"));if(W){W=W.toString()}else{W=0}if(X===g||X===k){if(!P){$.setReturnValue({err:true});return}if(K==="Drill Down To Same View"){K=U}if(w.IsEmpty(K)){$.setReturnValue({err:true});return}}if(!X){if(W){B=d;R=true}else{B=f}}else{B=X;R=true}var Q=null;if(O){Q=O.GetActiveApplet()}var F;if(Q){if(B===g||B===k){F=Q.GetBusComp();if(!Q.GetName()||P.srcFieldName!==o.get("SWE_ROW_ID_FIELD")){}if(F.IsCommitPending()){F.WriteRecord()}}}$.callback(this,function(aj){var ap=o.get("SWE_PST_APP_INFO");var ax=o.get("SWE_PST_BUSOBJ_INFO");var az=o.get("SWE_PST_NEW_BUSOBJ");var aB=o.get("SWE_PST_VIEW_INFO");var ar=o.get("SWE_PROP_NAME");var aA=o.get("SWE_PST_NEW_VIEW");var ah=C.Clone();var ag=CCFMiscUtil_CreatePropSet();var aa=C.GetChildCount();if(Q&&(B===g||B===k)){var aC=Q.GetName();if(w.IsEmpty(aC)){return}}for(var aw=0;aw<aa;aw++){ah.RemoveChild(0);ag.AddChild(C.GetChild(aw))}var am=o.get("SWE_RPC_PROP_RETURN_STATUS");var at=C.GetProperty(am);if(at===E){if(M&&M.PropertyExists(t)){var ae=M.GetProperty(t).toString();if(ae===x){C.SetProperty("URL",C.GetProperty("URL").toString()+"&ObjName="+M.GetProperty("SWETA").toString()+"&Type="+q.get("POPUP_INFO"))}}N.GetPopupPM().SetProperty("CanProcessLayout",false);N.GetPopupPM().ExecuteMethod("ProcessNewPopup",C);I="refreshpopup";ah=CCFMiscUtil_CreatePropSet()}ah.SetProperty(u,true);var ab=CCFMiscUtil_CreatePropSet();var ac=CCFMiscUtil_CreatePropSet();var ao=CCFMiscUtil_CreatePropSet();ab.SetType(ap);ac.SetType(aB);ao.SetType(ax);ab.SetProperty(u,true);ac.SetProperty(u,true);ao.SetProperty(u,true);var ai;var au;var af=o.get("SWE_RPC_PROP_NOTIFICATION");var ad=null;var aq=null;var ay=N.GetActiveBusObj();var Z=null;var al=null;var ak;if(Q&&(B===g||B===k)){if(!P.busCompName){al=Q.GetName()}else{al=P.busCompName}if(B===g&&O.GetBusObj().GetName()===Z&&al===Q.GetBusComp().GetName()){B=d}}if(B===n){B=f}else{if(B===g||B===k){R=true;if(U===K){bKeepFrames=true}if(Q!==null){if(B===k){ak=P.destFieldName;F.FieldValue(P.srcFieldName)}}}}if(ay){aq=ag.GetChildByType(ap);var an=aq.GetChildByType(az);if(an){ad=an.GetChildByType(ax);var av=ay.GetName();Z=an.GetChildByType(ax).GetProperty(ar);if(av!==Z||!R){B=f}}else{ad=aq.GetChildByType(ax)}}else{B=f}$.callback(this,function(aH){if(aH){if(!aH.err){if(!w.IsEmpty(aH.retVal)){S=aH.retVal}}else{return}}if(at===E&&ay){ad.SetProperty("isPopup",true);ao.SetProperty("isPopup",true)}var aQ;var aL;if(B===d||B===g||B===k){var aN=ad.Clone();var aI=(aq.GetChildByType(aA)).Clone();N.ClearMainView(true,N);var aR=aq.GetChildCount();for(var aD=0;aD<aR;aD++){aQ=aq.GetChild(aD);aL=aQ.GetType();if(aL===az||(aI&&aL===aA)){aq.RemoveChild(aD);aD--;aR--}}aq.AddChild(aN);if(aI){aq.AddChild(aI)}}var aG=ag.FindChildPosition(af);if(aG>=0){ag.RemoveChild(aG)}var aP=o.get("SWE_HIST_OUI_UPDATE_INFO");var aO=ag.GetChildByType(aP);if(aO){var aF=window.location.origin;aF=aF.concat(window.location.pathname);aO.SetProperty(o.get("SWE_HIST_NAV_URL"),HtmlEncode(aF))}var aS=["dPS",ap,aB,ax];var aK=[ah,ab,ac,ao];SiebelApp.S_App.Model.SetDyncPS(aS,aK,4);L=ag.EncodeAsString();G.push(L);G.push("success");var aM=N.ProcessResponse.apply(N,G);this.PopulateDeferredArray(aM);var aJ;var aE;aM.done(function(){SiebelApp.OfflineAppMgr.RemoveObj(aM);var aT=N.GetActiveView();aT.ActivateFields();$.callback(this,function(){var aU=P?P.visibilityType:null;SiebelApp.S_App.Model.EndSetupView(N.GetActiveBusObj(),K,al,ak,S,aU);
$.callback(this,function(aZ){if(!aZ.err){var aY=false;if(window.localStorage.getItem("reload")&&JSON.parse(window.localStorage.getItem("reload"))&&window.localStorage.getItem("contextArray")){aY=true;var aV=JSON.parse(window.localStorage.getItem("contextArray"));aJ=aV.length;aE=SiebelApp.S_App.GetActiveBusObj()}if(aY){for(var aW=0;aW<aJ;aW++){var aX=aE.GetBusCompX(aV[aW].bc,true);if(!w.IsEmpty(aV[aW].ss)){aX.SetSearchSpec(aV[aW].ss)}if(aV[aW].sc>0){aX.SetScrollCount(aV[aW].sc);var a0=aX.GetCursor();a0[0]=aV[aW].sc;aX.SetCursor(a0)}}}aT.Populate();$.callback(this,function(a3){if(aY){var a2=0;var a1=function(){};a1=function(){var a5=aE.GetBusCompX(aV[a2].bc,true);if(a5){if(aV[a2].Id){a5.PositionById(aV[a2].Id)}else{var a4=(a5.GetWS().size)?a5.GetWS()[0]:undefined;if(a4&&a4.Id){a5.PositionById(a4.Id)}}}$.callback(this,function(a6){if(!a6.err){a2++;if(a2<aJ){a1.call(this)}}})};if(a2<aJ){a1.call(this)}}$.callback(this,function(a7){window.localStorage.setItem("reload",false);if(!a7.err){var a8,a4,a6;a4=aT.GetAppletMap();var a5=null;while(b.length>0){a8=b.shift();if(a8.methodType===q.get("TYPE_BUSCOMP")){for(a5 in a4){if(a4[a5].GetBusComp().GetName()===a8.objName){a6=a4[a5];break}}}else{if(a8.methodType===q.get("TYPE_FRAME")){for(a5 in a4){if(a4[a5].GetName()===a8.objName){a6=a4[a5];break}}}}}if(a6){if(a8.methodName){a6.InvokeMethodX(a8.methodName,a8.psInputArgs)}}$.callback(this,function(bg){if(!bg.err){var bj=N.GetActiveBusObj();var bb=SiebelApp.S_App.Model.GetDyncPS("",true);var bd=bb.dPS;var a9=bb.vi;if(!aO.GetProperty(o.get("SWE_HIST_REPLACE"))){window.localStorage.setItem("view",aT.GetName());var bl=[];var bf="";for(app in a4){var ba=a4[app];var bi=ba.GetBusComp();var bk=bi.GetName();if((bf.indexOf(bk)===-1)&&!(bi.IsCommitPending())&&!((typeof(ba.GetAssocAppletName)!=="undefined")||(typeof(ba.GetPickAppletName)!=="undefined"))){var bh={};bf=bf.concat(bk);bh.bc=bk;bh.ss=bi.GetSearchSpec();bh.sc=bi.GetScrollCount();if(bi.CheckActiveRow()&&bi.GetWS()[bi.GetActiveRow()]){bh.Id=bi.GetWS()[bi.GetActiveRow()].Id}bl.push(bh)}}var be=[];be=SiebelApp.OfflineAppMgr.SortBCOrder(bl,be);window.localStorage.setItem("contextArray",JSON.stringify(be))}aT.InterpolateDyncUIPS(a9);$.callback(this,function(){var bc=bb.boi;bj.InterpolateBCPS(bc);$.callback(this,function(){var bm=bb.api;bm.AddChild(bc);bm.AddChild(a9);bd.AddChild(bm);aT.GetNotifyPropSet(bd,T);$.callback(this,function(){aT.SetNotifyObjData(ao);$.callback(this,function(bp){if(!bp.err){var bn=bd.EncodeAsString();var bo=H.call(N,bn);SiebelApp.OfflineAppMgr.PopulateDeferredArray(bo);bo.done(function(){SiebelApp.OfflineAppMgr.RemoveObj(aM);SiebelApp.S_App.Model.ResetDyncPS();var bq=0;var br=SiebelApp.OfflineAppMgr.HasPendingOp();if(br){bq=1;SiebelApp.OfflineAppMgr.CallPendingOp();$.callback(this,function(){if(I==="refreshpopup"){SiebelApp.S_App.GetPopupPM().SetProperty("CanProcessLayout",true);SiebelApp.EventManager.fireEvent(I)}SiebelApp.OfflineAppMgr.SetPendingOp(false);$.setReturnValue(a7);if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().EndTime("OfflineAppMgr.prototype.GetReturnPropSet")}SiebelApp.OfflineAppMgr.SetStatus("")})}if(!bq){$.setReturnValue(a7);SiebelApp.OfflineAppMgr.SetStatus("")}})}else{SiebelApp.OfflineAppMgr.SetStatus("");$.setReturnValue(bp)}})})})})}})}})})}})})})})})}};c.prototype.SortBCOrder=function(B,G,E){var D=SiebelApp.S_App.GetActiveBusObj();if(B.length===1){G.push(B[0]);B.splice(0,1);return G}else{if(B.length===0){return G}}for(var C=0;C<B.length;C++){var F=D.GetBusCompX(B[C].bc,true);if(!F.GetParentBusComp()||(F.GetParentBusComp().GetName()===E)){G.push(B[C]);B.splice(C,1);this.SortBCOrder(B,G,F.GetName())}}return G};c.prototype.InvokeAppletMethod=function(B,C,I,H){if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().StartTime("OfflineAppMgr.prototype.InvokeAppletMethod")}var G;var F;var E=unescape(B.GetProperty(o.get("SWE_APPLET_STR")).toString());F=SiebelApp.S_App.GetActiveView().GetActiveApplet();if(F&&(F.GetParentApplet()!==null)&&(F.GetName()===E)){G=F}else{G=SiebelApp.S_App.GetActiveView().GetApplet(E)}var D=B.GetProperty(q.get("SWE_FRAME_ID_STR"));G.PrepareToInvokeMethod(C,H);$.callback(this,function(){G.SetDefaultShowMode();var J={};J.callback=I;J.request=H;var K=CCFMiscUtil_CreatePropSet();K.SetProperty("Request",H);G.InvokeMethodX(C,K);$.callback(this,function(L){if(!L.err){if(i.Action){h.call(this,J)}else{if(!D){SiebelApp.OfflineAppMgr.ShowViewOrApplet(C,J)}else{this.PostActions(q.get("ACTION_RPC_COMPLETED"),C);h.call(this,J)}}$.callback(this,function(M){if(!M.err){SiebelApp.OfflineAppMgr.ClearPostedActions();$.setReturnValue(M);if(SiebelApp.S_App.GetTimer()){SiebelApp.S_App.GetTimer().EndTime("OfflineAppMgr.prototype.InvokeAppletMethod")}}else{$.setReturnValue({err:true});return}})}else{if(L.err){SiebelApp.OfflineAppMgr.ClearPostedActions();$.setReturnValue({err:true});return}}})})};c.prototype.PrepareWriteRecordResponse=function(B){var E=CCFMiscUtil_CreatePropSet();E.DecodeFromString(B);var N=E.GetChildByType("api");var R;var H;var I=N.GetChildByType("nbo");I=I.GetChildByType("boi");var M=N.FindChildPosition("nbo");N.RemoveChild(M);N.AddChild(I);var D=null;var O=N.GetChildByType("nv");var G=O.GetChildByType("vi");var C=G.Clone("vi");var F=G.GetChildCount();for(var J=0;J<F;J++){C.RemoveChild(0)}for(J=0;J<F;J++){var K=G.GetChild(J);var L=K.GetChildCount();R=null;H=null;var Q=K.GetType();if(Q==="na"){R=CCFMiscUtil_CreatePropSet();R.SetType("rctl")}else{if(Q==="nla"){H=CCFMiscUtil_CreatePropSet();H.SetType("rcl");R=CCFMiscUtil_CreatePropSet();R.SetType("rctl")}}if(L>0){for(var P=0;P<L;P++){D=K.GetChild(P);if(D.GetType()==="ai"){if(R){D.InsertChildAt(R,0)}if(H){D.InsertChildAt(H,0)}if(Q==="na"){if(D.GetPropertyAsStr(o.get("SWE_PST_APPLET_MODE"))===o.get("SWE_PST_APPLET_MODE_BASE")){D.SetPropertyStr(o.get("SWE_PROP_IS_EDIT"),"0")}}}C.AddChild(D)}}else{C.AddChild(K)}}M=N.FindChildPosition("nv");N.RemoveChild(M);N.AddChild(C);E.SetProperty("Status","RefreshLayout");var S=E.EncodeAsString();return S};c.prototype.ShowRPCError=function(E,I,G){var D=CCFMiscUtil_CreatePropSet();var C=CCFMiscUtil_CreatePropSet();var H=CCFMiscUtil_CreatePropSet();if(E&&E.HasErrorMsg()){var B=E.GetErrorCode();var F=E.GetErrorText();C.SetProperty("ErrMsg",F);C.SetProperty("ErrCode",B);H.SetType("Errors");H.AddChild(C);D.AddChild(H)}SiebelApp.OfflineAppMgr.GetReturnPropSet("Error",D,G,I)};c.prototype.CheckValidation=function(E){var C=E.GetType();var B=true;if(C==="Ack_ValidateRequest"){SiebelApp.OfflineAppSettings.SetMode(false);var D=E.GetPropertyAsStr("Status");alert(D);$(".progressbar").remove();SiebelApp.S_App.CustomToolbar.Update("DownLoadFailed");B=false}return B};c.prototype.CheckServerConnection=function(B,E){if(E||SiebelApp.OfflineUtils.IsValidServerResponse(B)){if(B.indexOf("SBL-SSM-00003")!==-1){return false}else{if(B.indexOf("SBL-SSM-00004")!==-1){return false}else{var C=B.charAt(0);if(C!=="@"){return true}else{var F=CCFMiscUtil_CreatePropSet();F.DecodeFromString(B);var D="The server you are trying to access is either busy or experiencing difficulties. Please close the Web browser, open a new browser window, and try logging in again.";
if(F.GetPropertyAsStr("ERR")==="1"||(B.indexOf(D)!==-1)){return false}}}}}else{return false}return true};c.prototype.ModifyLayout=function(B){var D=this.GetControlRegExpMap();for(var C in D){B=B.replace(D[C],C)}SiebelApp.OfflineAppMgr.SetControlRegExpMap({});return B};c.prototype.InvokeServiceMethod=function(B,C,G,F){var E=CCFMiscUtil_CreatePropSet();var D=CCFMiscUtil_CreatePropSet();if(C==="PrepareAppletMenu"){z.call(this,B,C,G,F);$.callback(this,function(H){if(H.err){$.setReturnValue(H);return}else{D=H.retVal;E.AddChild(D);E.SetType("ResultSet");SiebelApp.OfflineAppMgr.GetReturnPropSet("1",E,F,G)}})}else{if(C==="BatchCanInvoke"){v.call(this,B,C,G,F);$.callback(this,function(H){if(H.err){$.setReturnValue(H);return}else{D=H.retVal;E.AddChild(D);E.SetType("ResultSet");SiebelApp.OfflineAppMgr.GetReturnPropSet("1",E,F,G)}})}else{p.call(this,B,C,G,F,true);return}}};function v(B,I,J,E){var K;var H=CCFMiscUtil_CreatePropSet();var D=CCFMiscUtil_CreatePropSet();var F;var G=unescape(B.GetProperty("SWEIPS"));D.DecodeFromString(G);K=D.EnumProperties(true);var C=function(){p.call(this,B,K,"","",false);$.callback(this,function(L){if(L.err){$.setReturnValue(L);return}F=L.retVal;if(F){H.SetProperty(K,true)}else{H.SetProperty(K,false)}});if(K=D.EnumProperties(false)){C.call(this)}};C.call(this);$.callback(this,function(L){$.setReturnValue({err:"",retVal:H})})}function z(C,M,O,F){var H;var E=CCFMiscUtil_CreatePropSet();var G=CCFMiscUtil_CreatePropSet();var I=CCFMiscUtil_CreatePropSet();var N=CCFMiscUtil_CreatePropSet();var B;var K=q.get("MENU_INFO");var D=q.get("MENU_DATA_REQ");var J;J=C.GetProperty("SWEIPS").toString();J=unescape(J);if(!w.IsEmpty(J)){var L=CCFMiscUtil_CreatePropSet();L.DecodeFromString(J);J=L.GetProperty("Name");if(w.IsEmpty(J)){J=C.GetProperty("SWEActiveApplet").toString()}}else{J=C.GetProperty("SWEActiveApplet").toString()}SiebelApp.BrowserCacheMgr.DiscoverMetadata(F,O,D,J,K);$.callback(this,function(P){if(P.err){$.setReturnValue(P);return}B=P.retVal;E.DecodeFromString(B);$.setReturnValue({err:"",retVal:E});return})}function p(C,F,O,G,L){var J="";var D=null;var M="";var B="";var I={};var K=o.get("PROP_SERVICE");if(!F){$.setReturnValue({err:"",retVal:false});return}I=r.call(this,F);if(!I){$.setReturnValue({err:"",retVal:false});return}if(I[o.get("PROP_TARGET")]!=="Server"&&I[o.get("PROP_TARGET")]!=="SI Plus"){var E=SiebelApp.S_App.GetActiveView();if(I[o.get("PROP_APPLET")]){if(E===null){$.setReturnValue({err:"",retVal:false});return}}if(I[o.get("PROP_TARGET")]!=="Browser Applet"&&E&&E.GetName()==="Task Pane View"){if(I.method!=="Logoff"){$.setReturnValue({err:"",retVal:false});return}}}if(I[o.get("PROP_ARGUMENT")]){C.SetProperty("Method Argument",I[o.get("PROP_ARGUMENT")])}C.SetProperty("Command",F);if(I[K]!==" "&&I[K]){J=I[K];M=I.method;D=SiebelApp.S_App.GetService(J);if(D){if(L){D.Invoke(M,C);$.callback(this,function(P){if(P.err){$.setReturnValue(P);return}})}else{D.DoCanInvokeMethod(M);$.callback(this,function(P){if(P.err){$.setReturnValue(P);return}else{var Q=P.retVal;$.setReturnValue({err:"",retVal:Q});return}})}}}else{if(I[o.get("PROP_APPLET")]){B=I[o.get("PROP_APPLET")];M=I.method;if(!L){var N;var H=SiebelApp.S_App.GetActiveView().GetActiveApplet();if(H&&(H.GetParentApplet()!==null)&&(H.GetName()===B)){N=H}else{N=SiebelApp.S_App.GetActiveView().GetApplet(B)}N.CanInvokeMethodX(M);$.callback(this,function(Q){if(Q.err){$.setReturnValue(Q);return}else{var P=Q.retVal;$.setReturnValue({err:"",retVal:P});return}})}}else{$.setReturnValue({err:"",retVal:false});return}}}function r(F){var B={};var D=[];var E=CCFMiscUtil_CreatePropSet();var C=0;if(!F){return}if(F.indexOf(o.get("CMDMGR_AT"))>=0){E.DecodeFromString(F);return(true)}if(F.indexOf(o.get("CMDMGR_STAR"))<0){return(false)}D=F.split(o.get("CMDMGR_STAR"));for(C=0;C<D.length;C++){if(C===0){continue}switch(C){case 1:B[o.get("PROP_TARGET")]=D[C];break;case 2:B[o.get("PROP_SERVICE")]=D[C];break;case 3:B[o.get("PROP_METHOD")]=D[C];break;case 4:B[o.get("PROP_APPLET")]=D[C];break;case 5:B[o.get("PROP_ARGUMENT")]=D[C];break;case 6:B[o.get("PROP_DX")]=D[C];break;case 7:B[o.get("PROP_DY")]=D[C];break;case 8:B.popup=D[C];break;default:break}}return(B)}return a}())};