/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2013 Oracle and/or its affiliates. All rights reserved.
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
if(typeof(SiebelAppFacade.CommToolbarPhyRenderer)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.CommToolbarPhyRenderer");SiebelAppFacade.CommToolbarPhyRenderer=(function(){function e(f){this.m_toolbarUI=$(f.Get("GetPlaceholder"));this.m_focusEditBeforeClick="";this.m_sSelText="";this.m_curFocusEditName="";this.m_timerId=0;this.m_oldtitle="";this.m_mapOrderToName={};this.m_mapNameToOrder={};this.m_mark=false;this.m_bIsMakeCallPopupNeeded=f.Get("IsMakeCallPopupNeeded");this.GetPM=function(){return f}}e.prototype.GetControljqObj=function(h){var g=$('<div role="presentation"></div>');var f;if(h===undefined){g=$();return g}g.addClass(SiebelApp.S_App.GetDirection()?"siebui-text-align-right ":"");switch(h.m_type){case"button":var i=h.m_image;if(h.m_state==="disabled"){i=h.m_imgd}f=$("<img>");f.attr({name:h.m_name,id:h.m_id,title:h.m_tooltip,alt:a(h),src:i,role:"button","aria-label":a(h),tabindex:"-1"});if(h.m_name.indexOf("Agent State")>=0){f.attr("aria-pressed","false")}g.attr("id","CommBtn_"+h.m_id);if(h.m_name.indexOf("SidewayPopup")===0){g.addClass("commSidewayBtnContainer siebui-commbtn-enabled");f.addClass("commSidewayBtn commBtnEnabled")}else{if(h.m_index!==0){f.addClass("commSubBtn");g.addClass("commSubBtnContainer")}else{f.addClass("commTopBtn");g.addClass("commTopBtnContainer")}if(h.m_state==="enabled"){g.addClass("siebui-commbtn-enabled");f.addClass("commBtnEnabled")}else{g.addClass("siebui-commbtn-disabled")}}g.append(f);this.InjectQTPInfo(h,f);break;case"edit":f=$("<input/>");f.attr({id:h.m_id,name:h.m_name,title:h.m_tooltip,alt:h.m_name,type:"text",value:h.m_value,style:"width: "+h.m_width*0.7+"em",tabindex:"-1",role:"textbox","aria-label":h.m_name});f.addClass("commEdit");g.attr("id","CommEdit_"+h.m_id);g.addClass("commEditContainer");g.append(f);this.InjectQTPInfo(h,f);break;case"combo box":f=$("<select></select>");f.attr({id:h.m_id,name:h.m_name,title:h.m_tooltip,style:"width: "+h.m_width*0.7+"em",tabindex:"-1",role:"combobox","aria-label":h.m_name});f.addClass("commCombo");g.attr("id","CommCombo_"+h.m_id);g.addClass("commComboContainer");g.append(f);this.InjectQTPInfo(h,f);break;case"separator":f=$("<span></span>");f.attr({id:h.m_id,role:"separator"});f.addClass("commSep");g.attr("id","CommSep_"+h.m_id);g.addClass("commSepContainer");g.append(f);break;case"timer":f=$("<span></span>");f.text("00:00:00");f.attr({id:h.m_id,name:h.m_name,tabindex:"-1",role:"timer","aria-label":h.m_name});f.addClass("commTimerSpan");g.attr("id","CommTimer_"+h.m_id);g.addClass("commTimerContainer");g.append(f);this.InjectQTPInfo(h,f);break;default:g=$();break}return g};e.prototype.InjectQTPInfo=function(g,f){if(this.GetPM().Get("IsAutomationEnabled")){f.attr({rn:g.m_name,un:g.m_id,ot:g.m_type})}};e.prototype.ShowUI=function(){var v=null;var k=null;var y=0;var t=this.GetPM();var g=t.Get("GetPopSidewayCtrl");var r=g.m_name;var x=0;var m=t.Get("GetTopControlNum");var o=t.Get("GetTopCtrlsSeqMap");var h=t.Get("GetSubCtrlsSeqMap");var f;var u=$("<div></div>");var n;var l=true;var p=0;this.m_toolbarUI.attr({role:"toolbar","aria-label":SiebelApp.S_App.LocaleObject.GetLocalString("IDS_CTI_TOOLBAR_TITLE"),"aria-expanded":"true"});for(var s=1;s<=m;s++){v=o[s];if(v!==undefined){n=this.GetControljqObj(v);if(l){n.children().attr("tabindex","0");l=false}u.append(n);if(v.m_type!=="separator"){this.m_mapNameToOrder[v.m_id]=p;this.m_mapOrderToName[p++]=v.m_id}f=h[s];if(f===undefined){y=0}else{y=h[s].length-1}if(y>0){g.m_id=r+x++;n=this.GetControljqObj(g);n.children().attr("aria-label",SiebelApp.S_App.LocaleObject.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL"));u.append(n);this.m_mapNameToOrder[g.m_id]=p;this.m_mapOrderToName[p++]=g.m_id;var w=$("<div></div>");w.attr("id","SubCmdOf"+v.m_id);w.attr("role","group");w.addClass("commSubCmdContainer"+(SiebelApp.S_App.GetDirection()?" siebui-text-align-right":""));for(var q=1;q<=y;q++){k=f[q];w.append(this.GetControljqObj(k));this.m_mapNameToOrder[k.m_id]=p;this.m_mapOrderToName[p++]=k.m_id}w.hide().attr({"aria-hidden":"true","aria-expanded":"false"});u.append(w)}}}this.m_toolbarUI.hide().append(u.contents()).show().find(".commTopBtn, .commSubBtn, .commSidewayBtn, .commTimerSpan, .commEdit, .commCombo").tooltip({position:{my:"left top",at:"right bottom+5",collision:"flipfit"},show:null,hide:null}).tooltip("disable");this.m_toolbarUI.parent().parent().addClass(SiebelApp.S_App.GetDirection()?"siebui-text-align-left":"")};e.prototype.CollectComboValue=function(){var f={};$(".commCombo").each(function(){var h=$(this).attr("name");var g=$(this).find(":selected");if(g.length>0){f[h]=g.val()}else{f[h]=""}});return f};e.prototype.CollectEditText=function(){var f={};$(".commEdit").each(function(){var g=$(this).attr("name");var h=$(this).val();h=h.replace(/\s/g,"");f[g]=h});return f};e.prototype.GetFocusEditName=function(g){if(g){var f=document.activeElement.id;if(f!==""){return $("#"+f.replace(/\s/g,"\\ ")).attr("name")}else{return""}}else{return this.m_focusEditBeforeClick}};e.prototype.GetSelText=function(){var j="";try{if(window.getSelection){if(document.activeElement&&document.activeElement.tagName&&(document.activeElement.tagName.toLowerCase()==="textarea"||document.activeElement.tagName.toLowerCase()==="input")){var i=document.activeElement.value;j=i.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var f=window.getSelection();j=f.toString()}}else{if(document.selection&&document.selection.createRange){var g=document.selection.createRange();j=g.text}}}catch(h){SiebelApp.S_App.CommToolbarUtil.Log(3,"commToolbarprender.js: get selected text failed!")}return j};e.prototype.GetCtrlData=function(f){return{ComboValue:this.CollectComboValue(),EditText:this.CollectEditText(),FocusEdit:this.GetFocusEditName(f),SelText:this.GetSelText()}};e.prototype.BindEvents=function(){var g=this;var f=g.GetPM();g.m_toolbarUI.delegate(".commTopBtn, .commSubBtn, .commSidewayBtn, .commTimerSpan, .commEdit, .commCombo","ShowTooltipEvt",function(){if($(this).data("hovered")||$(this).data("focused")){var i=$(this).attr("old-aria-label")!==undefined?$(this).attr("old-aria-label"):$(this).attr("aria-label");$(this).tooltip("enable").tooltip("open");var k=$(this).attr("aria-describedby");var j=$("#"+k).children().text();$(this).attr("aria-label",j).attr("old-aria-label",i);if($(this).data("focused")){$(this).triggerHandler("blur");$(this).triggerHandler("focus")}window.status=j}}).delegate(".commSidewayBtn","click",function(k,i){var j=$(this).parent().next();if(j.css("display")==="none"){$(this).parent().siblings().has("div").hide().attr({"aria-hidden":"true","aria-expanded":"false"}).prev().children().attr("aria-label",SiebelApp.S_App.LocaleObject.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL"));j.show().removeAttr("aria-hidden");$(this).attr("aria-label",SiebelApp.S_App.LocaleObject.GetLocalString("IDS_CTI_SIDEWAYBTN_HIDE_LABEL")).parent().next().attr("aria-expanded","true")}else{j.hide().attr({"aria-hidden":"true","aria-expanded":"false"});$(this).attr("aria-label",SiebelApp.S_App.LocaleObject.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL"))
}if(g.m_focusEditBeforeClick!==""&&!i){g.m_toolbarUI.find("#"+g.m_focusEditBeforeClick.replace(/\s/g,"_")).focus()}else{if(g.m_toolbarUI.hasClass("floatToolbar")){$(this).focus()}}g.m_focusEditBeforeClick=""}).delegate(".commTopBtn, .commSubBtn","click",function(k,i){var l=$(this).attr("name");if($(this).hasClass("commBtnEnabled")){var j=g.GetCtrlData();j.SelText=g.m_sSelText;f.OnControlEvent("CommCommandBtnClicked",l,j,i);f.ExecuteMethod("ClearFocusInfo");f.ExecuteMethod("ApplySticky",$(this).attr("name"));if($(this).hasClass("commSubBtn")){$(this).parent().parent().hide().attr({"aria-hidden":"true","aria-expanded":"false"}).prev().children().attr("aria-label",SiebelApp.S_App.LocaleObject.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL"));g.MoveTabIndex(false,$(this).attr("id"),true)}}if(g.m_toolbarUI.hasClass("floatToolbar")&&!$(this).hasClass("commSubBtn")){$(this).focus()}SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Clicking ["+$(this).attr("name")+"]")}).delegate(".commCombo","change",function(k,i){var l=$(this).attr("name");var j=g.GetCtrlData();j.SelText=g.m_sSelText;f.OnControlEvent("CommCommandBtnClicked",l,j,i);f.ExecuteMethod("ClearFocusInfo")}).delegate(".commTopBtn, .commSubBtn, .commSidewayBtn, .commCombo, commTimerSpan","mousedown",function(i){g.m_sSelText=g.GetSelText();g.m_focusEditBeforeClick=g.m_curFocusEditName;if($(this).hasClass("commBtnEnabled")&&i.which===1){$(this).addClass("commBtnClicked")}if(($(this).hasClass("commTopBtn")||$(this).hasClass("commSubBtn")||$(this).hasClass("commCombo"))&&i.which===1){f.ExecuteMethod("CollectFocusInfo")}}).delegate(".commTopBtn, .commSubBtn, .commSidewayBtn, .commCombo, .commTimerSpan","mouseup",function(){$(this).removeClass("commBtnClicked")}).delegate(".commTopBtn, .commSubBtn, .commSidewayBtn, .commTimerSpan, .commEdit, .commCombo","mouseover mouseout",function(j){if(j.type==="mouseover"){$(this).data("hovered",true);var k=$(this).attr("name");f.ExecuteMethod("InvokeCommandToolTip",k,g.GetCtrlData(true))}else{$(this).data("hovered",false);if(!/msie/.test(navigator.userAgent.toLowerCase())||!$(this).hasClass("commCombo")){$(this).tooltip("close").tooltip("disable")}$(this).removeClass("commBtnClicked");var i=$(this).attr("old-aria-label");if(i!==undefined){$(this).attr("aria-label",i).removeAttr("old-aria-label")}}}).delegate("[tabindex]","keydown",function(i){if($(this).attr("tabindex")!=="0"){return}switch(i.which){case $.ui.keyCode.RIGHT:if($(this)[0].tagName.toUpperCase()!=="INPUT"){g.MoveTabIndex(true,$(this).attr("id"),true);i.preventDefault()}break;case $.ui.keyCode.LEFT:if($(this)[0].tagName.toUpperCase()!=="INPUT"){g.MoveTabIndex(false,$(this).attr("id"),true);i.preventDefault()}break;case $.ui.keyCode.SPACE:case $.ui.keyCode.ENTER:$(this).trigger("click",[true]);i.preventDefault();break;case $.ui.keyCode.TAB:if($(this)[0].tagName.toUpperCase()==="INPUT"){if(i.shiftKey){g.MoveTabIndex(false,$(this).attr("id"),true)}else{g.MoveTabIndex(true,$(this).attr("id"),true)}i.preventDefault()}break;default:break}}).delegate(".commTopBtn, .commSubBtn, .commSidewayBtn, .commTimerSpan, .commCombo","keypress",function(i){if(i.which===119){var j=$(this).attr("name");f.ExecuteMethod("InvokeCommandToolTip",j,g.GetCtrlData(),true)}}).delegate(".commTopBtn, .commSubBtn, .commSidewayBtn, .commTimerSpan, .commEdit, .commCombo","blur",function(j){$(this).data("focused",false);if($(this).hasClass("commEdit")){g.m_curFocusEditName=""}$(this).removeClass("commFocused");var i=$(this);setTimeout(function(){i.tooltip("close").tooltip("disable");var k=i.attr("old-aria-label");if(k!==undefined){i.attr("aria-label",k).removeAttr("old-aria-label")}},100)}).delegate(".commTopBtn, .commSubBtn, .commSidewayBtn, .commTimerSpan, .commEdit, .commCombo","focus",function(i){$(this).data("focused",true);if($(this).hasClass("commEdit")){g.m_curFocusEditName=$(this).attr("name")}g.m_toolbarUI.find(".commFocused").removeClass("commFocused");g.FocusControl($(this));$(this).addClass("commFocused")}).mouseup(function(i){g.m_mark=true});var h=$("#s_toolbar").find("[name='Toggle CTI Toolbar']");if(h.length>0){g.RegisterControlBtn(h)}$("body").delegate(".siebui-call-from-ui-enabled","click",function(i){if($(this).text().length>0){g.MakeCallToUIPhone($(this).text(),$(this),g.m_bIsMakeCallPopupNeeded)}});$(document).mouseup(function(){if(g.m_timerId!==0){clearInterval(g.m_timerId);g.m_timerId=0;document.title=g.m_oldtitle}}).keydown(function(){if(g.m_timerId!==0){clearInterval(g.m_timerId);g.m_timerId=0;document.title=g.m_oldtitle}})};e.prototype.BindData=function(){};e.prototype.MakeCallToUIPhone=function(f,l,h){var g=this.GetPM();var j=this;if(h){var i=$("#comm_makecall_popup");if(i.length<=0){i=$('<div id="comm_makecall_popup"></div>');$("body").append(i)}var k={};k[SiebelApp.S_App.LocaleObject.GetLocalString("IDS_CTI_CALL")]=function(){g.ExecuteMethod("CallContactFromUI",f,j.GetCtrlData());SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Make Call to phone number ["+f+"]");$(this).dialog("close");l.focus()};i.dialog({title:SiebelApp.S_App.LocaleObject.GetLocalString("IDS_CTI_PHONE_LABEL")+" "+f,buttons:k,position:[l.offset().left+l.width()+10,l.offset().top+l.height()],dialogClass:"commMakeCallFromUIPopup",close:function(){l.focus()},width:200,height:80})}else{g.ExecuteMethod("CallContactFromUI",f,this.GetCtrlData());SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Make Call to phone number ["+f+"]")}};e.prototype.TriggerEvent=function(h,f){var g=h.replace(/\s/g,"\\ ");this.m_toolbarUI.find("#"+g).trigger(f)};e.prototype.RefreshControl=function(h,g){var i=h.m_id;var j;var f=this.m_toolbarUI.find("#"+i);if(f.length<=0){return}if(h.m_type==="button"){if(g==="state"){j=f.attr("src");if(j!==""){switch(h.m_state){case"enabled":j=h.m_image;f.attr("src",j).addClass("commBtnEnabled").removeAttr("aria-disabled").parent().addClass("siebui-commbtn-enabled").removeClass("siebui-commbtn-disabled");SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Enabled ["+h.m_name+"]");break;case"disabled":j=h.m_imgd;f.attr("src",j).removeClass("commBtnEnabled").attr("aria-disabled","true").parent().removeClass("siebui-commbtn-enabled").addClass("siebui-commbtn-disabled");break}}f.attr({alt:a(h),"aria-label":a(h)}).removeAttr("old-aria-label")}else{if(g==="effect"){j=f.attr("src");if(j!==""){switch(h.m_effect){case"toggled":f.addClass("commBtnToggled").attr("aria-pressed","true");break;case"untoggled":h.m_effect="";f.removeClass("commBtnToggled");if(f.attr("aria-pressed")!==undefined){f.attr("aria-pressed","false")}break;case"blinking":f.addEffectForCommToolbar("blink");SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Blinking ["+h.m_name+"]");break;case"unblinking":h.m_effect="";f.addEffectForCommToolbar("stopblink");break}}f.attr({alt:a(h),"aria-label":a(h)}).removeAttr("old-aria-label")}else{if(g==="value"){if(h.m_bStatic){j=h.m_image}else{if(h.m_state==="enabled"){j=h.m_image}else{j=h.m_imgd}}if(j===""){f.attr("src",j).hide();if(f.attr("tabindex")==="0"){this.FocusControl(this.m_toolbarUI.find('img[tabindex][aria-disabled!="true"]:visible').first())
}f.attr("aria-hidden","true")}else{f.attr("src",j).show().removeAttr("aria-hidden")}}}}}if(g==="tooltip"){f.tooltip("enable").attr("title",h.m_tooltip).tooltip("disable").trigger("ShowTooltipEvt")}};e.prototype.MoveTabIndex=function(h,j,i){var f;var g;f=this.m_mapNameToOrder[j];if(h){g=this.m_mapOrderToName[++f]}else{g=this.m_mapOrderToName[--f]}while(g!==undefined&&(($("#"+g).hasClass("commSubBtn")&&$("#"+g).parent().parent().css("display")==="none")||$("#"+g).css("display")==="none")){if(h){++f}else{--f}g=this.m_mapOrderToName[f]}if(g===undefined){return false}else{$("#"+j).attr("tabindex","-1");$("#"+g).attr("tabindex","0");if(i){$("#"+g).focus()}return true}};e.prototype.FocusControl=function(f){this.m_toolbarUI.find('[tabindex="0"]').attr("tabindex","-1");f.attr("tabindex","0")};e.prototype.UpdateHTMLControl=function(j,h,g){if(j===undefined||h===""){return}var k=j.m_id;switch(h){case"state":this.RefreshControl(j,"state");break;case"effect":this.RefreshControl(j,"effect");break;case"value":switch(j.m_type){case"edit":this.m_toolbarUI.find("#"+k).attr("value",j.m_value);break;case"combo box":this.m_toolbarUI.find("#"+k).empty();for(var f=0;f<g.length;f+=2){if(f+1<g.length){var l=$("<option></option>");l.append(g[f]).attr({value:g[f+1],role:"option"});this.m_toolbarUI.find("#"+k).append(l)}}break;case"button":this.RefreshControl(j,"value");break;default:break}break;case"starttimer":this.m_toolbarUI.find("#"+k).addEffectForCommToolbar("starttimer",{driverTime:g[0],serverTime:g[1]});break;case"stoptimer":this.m_toolbarUI.find("#"+k).addEffectForCommToolbar("stoptimer");break;case"changetooltip":this.RefreshControl(j,"tooltip");break;case"":break;default:break}};function a(f){var g;if(f.m_effect==="toggled"&&f.m_name.indexOf("Agent State")!==-1){g="Change To Ready. Enabled."}else{if(f.m_state==="enabled"&&f.m_name.indexOf("Agent State")!==-1){g="Change To Not Ready. Enabled."}else{if(f.m_effect!==""){g=f.m_effect}else{g=f.m_state}}}return f.m_name+". "+g}e.prototype.ShowStatusText=function(i,g){window.status=i;var h=$("#MsgLayer");h.addClass(SiebelApp.S_App.GetDirection()?"siebui-text-align-right":"");if(h.length>0){var f=h.attr("timerid");if(f>0){clearTimeout(f)}if(i.length>75){var j=i;i=i.substr(0,75)+"...";h.html('<span id="MessageSpan" class="CommStatusMessage" title="'+j+'" role="alert">'+i+"</span>")}else{h.html('<span id="MessageSpan" class="CommStatusMessage" role="alert">'+i+"</span>")}f=setTimeout(function(){h.html("")},g);h.attr("timerid",f)}};e.prototype.ShowMessageWithAlert=function(f){alert(f)};e.prototype.FlashTitle=function(g){if(this.m_timerId===0){this.m_oldtitle=document.title;var h=this.m_oldtitle;var f=0;this.m_timerId=setInterval(function(){if(f%2===1){document.title=g}else{document.title=h}f++},1000)}};e.prototype.PlaySound=function(f){if(this.m_toolbarUI.find("#CommSounderWrapper").length>0){this.m_toolbarUI.find("#CommSounderWrapper").empty()}else{this.m_toolbarUI.append('<div id="CommSounderWrapper" style="visibility:hidden" aria-hidden="true"></div>')}this.m_toolbarUI.find("#CommSounderWrapper").append('<audio autoplay src="'+f+'"></audio>')};var c;var b;var d={DOCK:{next_status:["HIDDEN"],status_func:function(f,g){g.removeClass("floatToolbar");g.css("display","inline");if(f.isBlink===true){f.isBlink=false;f.addEffectForCommToolbar("stopblink")}if(g.data("uiDraggable")!==undefined){g.draggable("option","disabled",true)}g.attr("aria-expanded","true").removeAttr("aria-hidden").removeAttr("aria-disabled")}},HIDDEN:{next_status:["DOCK","FLOAT"],status_func:function(f,g){if(g.hasClass("floatToolbar")){c=g.offset();g.removeClass("floatToolbar")}g.css("display","none");if(f.isBlink===true){f.addEffectForCommToolbar("blink")}g.attr({"aria-expanded":"false","aria-hidden":"true"})}},FLOAT:{next_status:["DOCK","HIDDEN"],status_func:function(f,h,g){h.css("display","inline");h.addClass("floatToolbar");if(h.data("uiDraggable")===undefined){h.position({my:"left top",at:"right bottom",of:f,collision:"flipfit"});if($.ui.ddmanager){if($.ui.ddmanager.dragStart===undefined){$.ui.ddmanager.dragStart=function(){}}if($.ui.ddmanager.dragStop===undefined){$.ui.ddmanager.dragStop=function(){}}}h.draggable({containment:"window"});if(navigator.appName.indexOf("Microsoft")<0){h.mousedown(function(){if(f.status==="FLOAT"){var j=h.find('[tabindex="0"]').attr("id");var i=h.find(".commEdit");if(i.length>0){i.first().focus().blur()}if(!$("#"+j).hasClass("commEdit")){h.find("#"+j).focus()}}})}}else{h.offset(c);h.draggable("option","disabled",false)}if(f.isBlink===true){f.isBlink=false;f.addEffectForCommToolbar("stopblink")}h.attr("aria-expanded","true").removeAttr("aria-hidden").removeAttr("aria-disabled")}},UNKNOWN:{next_status:[],stauts_func:undefined}};e.prototype.CtrlBtnOp=function(n,l,f){var i=$(SiebelApp.S_App.CommToolbar.GetPlaceholder());if(n.status===undefined){if(i.css("display")==="inline"){n.status="DOCK"}else{if(i.css("display")==="none"){n.status="HIDDEN"}else{SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: toolbar control display is: "+i.css("display"));n.status="UNKNOWN"}}}var p=l;if(p==="TOGGLE"){if(n.status==="DOCK"){p="HIDDEN"}else{p="DOCK"}}else{if(p==="HIDDEN_FLOAT"){if(n.status!=="FLOAT"){return}else{p="HIDDEN"}}}var j=d[n.status];if(j==="undefined"){SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: unknown toolbar status: "+j);return}var g=j.next_status;for(var o=0,m=g.length;o<m;o++){var h=g[o];if(h===p){n.status=p;var k=d[p];k.status_func(n,i,f);return}}};e.prototype.BlinkParentBtn=function(){if(b===undefined||b.status===undefined){return}if(b.status==="HIDDEN"){b.isBlink=true;b.addEffectForCommToolbar("blink")}};e.prototype.StopBlinkCtrlBtn=function(){if(b===undefined){return}b.isBlink=false;if(b.status!=="Dock"){b.addEffectForCommToolbar("stopblink")}};e.prototype.RegisterControlBtn=function(f){b=f;if(b.length===0){return}var g=this;b.mouseup(function(){g.CtrlBtnOp(b,"TOGGLE");g.m_mark=true});b.keydown(function(h){if(h.which===$.ui.keyCode.ENTER){g.CtrlBtnOp(b,"TOGGLE")}});$(document).mouseup(function(){if(g.m_mark===false){g.CtrlBtnOp(b,"HIDDEN_FLOAT")}g.m_mark=false});b.mouseover(function(h){g.CtrlBtnOp(b,"FLOAT",h)})};e.prototype.GotoCTIToolbar=function(){this.m_toolbarUI.find('[tabindex="0"]').focus()};e.prototype.HideCTIToolbar=function(){this.m_toolbarUI.hide()};e.prototype.UpdateCallContactFromUI=function(f){if(f){$(".siebui-call-from-ui-disabled").removeClass("siebui-call-from-ui-disabled").addClass("siebui-call-from-ui-enabled")}else{$(".siebui-call-from-ui-enabled").removeClass("siebui-call-from-ui-enabled").addClass("siebui-call-from-ui-disabled");try{var h=$("#comm_makecall_popup");if(h.length>0){h.dialog("close")}}catch(g){SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: "+g)}}};e.prototype.OpenCallContactFromUIPopup=function(f,i){try{if(this.m_bIsMakeCallPopupNeeded){if(f.length>0){if(i===null||i===undefined){i=$(":focus").first()}this.MakeCallToUIPhone(f,i,true)}else{var h=$("#comm_makecall_popup");
if(h.length>0){h.dialog("close")}}}else{if(f.length>0){this.MakeCallToUIPhone(f,i,false)}}}catch(g){SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: "+g)}};(function(h){function f(l){var k=Math.floor(l/1000);var i=Math.floor(k/3600);k-=i*3600;var j=Math.floor(k/60);k-=j*60;if(i<10){i="0"+i}if(j<10){j="0"+j}if(k<10){k="0"+k}return i+":"+j+":"+k}var g={blink:function(j){var k={delay:500,opacity:1};var i=h.extend(k,j);return this.each(function(){var l=h(this);if(l.attr("timerid")>0){clearInterval(l.attr("timerid"))}var m=setInterval(function(){if(l.css("opacity")==="1"){l.animate({opacity:0},i.delay/2,"",function(){if(l.attr("timerid")==="0"){l.css("opacity",i.opacity===1?1:0)}})}else{l.animate({opacity:1},i.delay/2)}},i.delay);l.attr("timerid",m)})},stopblink:function(j){var k={opacity:1};var i=h.extend(k,j);return this.each(function(){var l=h(this);if(l.attr("timerid")>0){clearInterval(l.attr("timerid"));l.attr("timerid",0);l.stop();l.css("opacity",i.opacity===1?1:0)}})},starttimer:function(j){var k={delay:1000};var i=h.extend(k,j);return this.each(function(){var o=h(this);var n=i.driverTime*1000;var l=i.serverTime*1000;var q=new Date();var m=new Date().getTime()-q.getTime()+l-n;o.text(f(m));if(o.attr("timerid")>0){clearInterval(o.attr("timerid"))}var p=setInterval(function(){m=new Date().getTime()-q.getTime()+l-n;o.text(f(m))},i.delay);o.attr("timerid",p)})},stoptimer:function(){return this.each(function(){var i=h(this);i.text("00:00:00");if(i.attr("timerid")>0){clearInterval(i.attr("timerid"));i.attr("timerid",0)}})}};h.fn.addEffectForCommToolbar=function(i){if(g[i]){return g[i].apply(this,Array.prototype.slice.call(arguments,1))}}}(jQuery));return e}())};