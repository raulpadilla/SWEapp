/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2013 Oracle and/or its affiliates. All rights reserved.
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
if(typeof(SiebelAppFacade.JQMMapCtrl)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.JQMMapCtrl");var LoadMap=function(){};var LoadAcctsMap=function(){};var loadGAPIs=function(){$.getScript(SIEBEL_BUILD+"3rdParty/jquery-ui-map/jquery.ui.map.js");$.getScript(SIEBEL_BUILD+"3rdParty/jquery-ui-map/jquery.ui.map.services.js");$.getScript(SIEBEL_BUILD+"3rdParty/jquery-ui-map/jquery.ui.map.extensions.js");SiebelJS.Log("[LoadGAPIs] Google APIs Loaded...")};var prevValue=$.ajaxSetup().async;$.ajaxSetup({async:false});$.getScript("https://www.google.com/jsapi?callback=loadGAPIs",function(){});$.ajaxSetup({async:prevValue});SiebelAppFacade.JQMMapCtrl=(function(){var a=SiebelJS.Dependency("SiebelApp.Utils");function b(h){var f="jqmMapCtrl";var d="SiebelMapContainer";var g="scrollviewcontainer_s_1_l";var j;var e;var i;this.GetPlaceholder=function(){return $("#"+f)};this.GetmapContainer=function(){return $("#"+d)};this.GetScrollContainer=function(){return $("#"+g)};this.GetMapCSSHeight=function(){return $("#"+f).css("height")};this.GetMapHeight=function(){return $("#"+f).clientHeight};this.SetMapCenterLatLng=function(k){i=k};this.GetMapCenterLatLng=function(){return i};this.GetMapHideControl=function(){j=$("<div id='mapHideControl'>");var k='<button id="mapHideCtrl" data-inline="true" /*data-iconpos="center" data-icon="close"*/ class="ui-icon-custom-close" ></button></div>';j.html(k);return $(j)};this.GetMapOpenControl=function(){e=$("<div id='mapOpenControl'>");var k='<button id="mapOpenControl" data-inline="true" data-iconpos="center" data-icon="open" class="ui-icon-open" ></button></div>';e.html(k);return $(e)}}b.prototype.GetCurrLocationLatLng=function(e){var d=null;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(f){var g=f.coords.latitude;var h=f.coords.longitude;d=(g+","+h);e(d)},function(f){e(d)},{timeout:1000})}};b.prototype.GetInlineRoute=function(e){var f=this;var d=f.GetmapContainer();var g=f.GetMapHideControl();LoadMap=function(){var j=null;var h=e;var i=document.getElementById("mapHideControl");if(i){f.GetPlaceholder().gmap("destroy")}f.GetPlaceholder().gmap({mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_LEFT},callback:function(l){var k=this;k.getCurrentPosition(function(m,n){if(n==="OK"){j=new google.maps.LatLng(m.coords.latitude,m.coords.longitude)}else{j=f.GetPlaceholder().attr("myLocation")||"500 Oracle Parkway, Redwood Shores, CA 94065";switch(n.code){case n.PERMISSION_DENIED:SiebelJS.Log("Could not get current location as permission was denied.");break;case n.POSITION_UNAVAILABLE:SiebelJS.Log("Could not get current location as this information is not available at this time.");break;case n.TIMEOUT:SiebelJS.Log("Attempt to get current location timed out.");break;case n.UNKNOWN_ERROR:SiebelJS.Log("An unknown error occurred. Code: "+n.code+" Message: "+n.message);break}}if((j!==null&&j!==undefined)&&(h!==null&&h!==undefined)){c(k,j,h)}});k.addControl(g,google.maps.ControlPosition.TOP_RIGHT);$(g).unbind("click.SiebelAppFacade.JQMMapCtrl");$(g).bind("click",{ctx:this},function(m){f.HideMapContainer()})}})};if(f.GetPlaceholder().length===1){this.ShowMapContainer(d);this.LoadAPI("LoadMap")}else{SiebelJS.Log("Define jqmMapCtrl DIV in View Web Template to get the map")}};b.prototype.CreateURLForDirection=function(f){var d=f;var g=null;var e=null;this.GetCurrLocationLatLng(function(j){if(j===null){j="Current Location"}if(d!==null&&d!==undefined){e="http://maps.google.com/maps?saddr="+j+"&daddr="+d+"&sensor=false"}else{e="http://maps.google.com/maps?q="+j+"&sensor=false"}e=encodeURI(e);var h=document.createElement("a");h.setAttribute("href",e);if(!((window.navigator.standalone!==undefined)&&window.navigator.standalone)){h.setAttribute("target","_blank")}var i=document.createEvent("HTMLEvents");i.initEvent("click",true,true);h.dispatchEvent(i);h=null})};b.prototype.OpenDynamicGoogleMap=function(f){var e="http://maps.google.com/maps?saddr=";var d=0;for(d=0;d<f.length;d++){if(d===0){e=e.concat(f[d]+"&daddr=")}else{e=e.concat(f[d]+"+to:")}}e=e.substring(0,e.length-4);e=e.concat("&sensor=false");e=encodeURI(e);window.open(e)};b.prototype.ShowMapLocations=function(e){var g=this;var f=g.GetmapContainer();var h=g.GetMapHideControl();var d=g.GetMapOpenControl();LoadAcctsMap=function(){var k=null;var i=null;var j=document.getElementById("mapHideControl");if(j){g.GetPlaceholder().gmap("destroy")}g.GetPlaceholder().gmap({minZoom:2,mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_LEFT},callback:function(s){var o=this;var n=null;var q=null;var m;var l=SiebelApp.S_App.GetPageURL().split("start.swe")[0]+"images/marker_blue.png";var r=this.get("services > Geocoder",new google.maps.Geocoder());var p=this.get("bounds",new google.maps.LatLngBounds());if(o&&typeof o.getCurrentPosition==="function"){o.getCurrentPosition(function(t,u){if(u==="OK"){k=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);if(!a.IsEmpty(k)){setTimeout(r.geocode({location:k},function(w,v){if(v===google.maps.GeocoderStatus.OK){if((v!==google.maps.GeocoderStatus.ZERO_RESULTS)&&(v!==google.maps.GeocoderStatus.OVER_QUERY_LIMIT)){q=(w[0].formatted_address);o.addMarker({position:k,icon:l}).click(function(){o.openInfoWindow({content:q},this)});p.extend(k);g.GetPlaceholder().gmap("get","map").fitBounds(p);i=s.getCenter();g.SetMapCenterLatLng(i);k=q;m=e.indexOf(k);if(m===-1){e.unshift(k)}}}}),5000)}}else{k=g.GetPlaceholder().attr("myLocation")||"500 Oracle Parkway, Redwood Shores, CA 94065";setTimeout(r.geocode({address:k},function(x,w){if(w===google.maps.GeocoderStatus.OK){if((w!==google.maps.GeocoderStatus.ZERO_RESULTS)&&(w!==google.maps.GeocoderStatus.OVER_QUERY_LIMIT)){var v=new google.maps.LatLng(x[0].geometry.location.lat(),x[0].geometry.location.lng());o.addMarker({position:v,icon:l}).click(function(){o.openInfoWindow({content:k},this)});p.extend(v);g.GetPlaceholder().gmap("get","map").fitBounds(p);i=s.getCenter();g.SetMapCenterLatLng(i);m=e.indexOf(k);if(m===-1){e.unshift(k)}}}else{SiebelJS.Log("Geocode was not successful for "+k+": "+w)}}),5000)}})}else{k=g.GetPlaceholder().attr("myLocation")||"500 Oracle Parkway, Redwood Shores, CA 94065";setTimeout(r.geocode({address:k},function(v,u){if(u===google.maps.GeocoderStatus.OK){if((u!==google.maps.GeocoderStatus.ZERO_RESULTS)&&(u!==google.maps.GeocoderStatus.OVER_QUERY_LIMIT)){var t=new google.maps.LatLng(v[0].geometry.location.lat(),v[0].geometry.location.lng());o.addMarker({position:t,icon:l}).click(function(){o.openInfoWindow({content:k},this)});p.extend(t);g.GetPlaceholder().gmap("get","map").fitBounds(p);i=s.getCenter();g.SetMapCenterLatLng(i);m=e.indexOf(k);if(m===-1){e.unshift(k)}}}else{SiebelJS.Log("Geocode was not successful for "+k+": "+u)}}),5000)}$.each(e,function(u,t){setTimeout(r.geocode({address:t},function(x,v){if(v===google.maps.GeocoderStatus.OK){if((v!==google.maps.GeocoderStatus.ZERO_RESULTS)&&(v!==google.maps.GeocoderStatus.OVER_QUERY_LIMIT)){var w=new google.maps.LatLng(x[0].geometry.location.lat(),x[0].geometry.location.lng());
if(e[u]!==k&&e[u]!==q){var B="http://www.google.com/maps?saddr=";var A=SiebelApp.S_App.LocaleObject.GetLocalString("IDS_SWE_MOBIIE_DRIVING_DIRECTIONS")||"Driving Directions";var z=null;if(!a.IsEmpty(k)){z=k}else{z="Current Location"}var y="<p><a href='"+B+z+" &daddr="+e[u]+"' target='_blank'>"+A+"</a></p>";o.addMarker({position:w}).click(function(){o.openInfoWindow({content:t+y},this)});p.extend(w);g.GetPlaceholder().gmap("get","map").fitBounds(p);i=g.GetPlaceholder().gmap("get","map").getCenter();g.SetMapCenterLatLng(i)}}}else{SiebelJS.Log("Geocode was not successful for "+e[u]+": "+v)}}),5000)});o.addControl(h,google.maps.ControlPosition.TOP_RIGHT);$(h).unbind("click.SiebelAppFacade.JQMMapCtrl");$(h).bind("click",{ctx:this},function(t){g.HideMapContainer()});o.addControl(d,google.maps.ControlPosition.TOP_RIGHT);$(d).unbind("click.SiebelAppFacade.JQMMapCtrl");$(d).bind("click",{ctx:this},function(t){g.OpenDynamicGoogleMap(e)});f.unbind("orientationchange.SiebelAppFacade.JQMMapCtrl");f.bind("orientationchange.SiebelAppFacade.JQMMapCtrl",{ctx:this},function(t){var u=g.GetPlaceholder().gmap("get","map");i=g.GetMapCenterLatLng();$(u).triggerEvent("resize");u.setCenter(i)})}})};if(g.GetPlaceholder().length===1){this.ShowMapContainer(f);this.LoadAPI("LoadAcctsMap")}else{SiebelJS.Log("Define jqmMapCtrl DIV in View Web Template to get the map")}};function c(f,e,d){if((e!==null&&e!==undefined)&&(d!==null&&d!==undefined)){f.displayDirections({origin:e,destination:d,travelMode:google.maps.DirectionsTravelMode.DRIVING},{panel:document.getElementById("#DirectionResults")},function(h,g){})}}b.prototype.AdjustHeight=function(l){var h=this.GetScrollContainer().height();var f=this.GetMapCSSHeight();var e=this.GetMapHeight();var g=l;var d;var m;var k;if(h===null){var j=$("#scrollviewcontainer_s_2_l");h=j.height()}var i=$("#_FormParentRelatedItemsOuterCont");m=i.height();if(f!==undefined&&f!==""){f=f.substring(0,f.length-2)}if(g===true){if(e===undefined||e===""){if(f>0){if(h>0){d=h-(f*(0.71));$("#_Parentapplet_List").css("height",d+"px")}if(m>0){k=m-(f*(1.025));$("#_FormParentRelatedItemsOuterCont").css("height",k+"px")}}}}else{if(f>0){if(h>0){d=h+(f*(0.29));$("#_Parentapplet_List").css("height",d+"px")}if(m>0){k=m+(f*(1.025));$("#_FormParentRelatedItemsOuterCont").css("height",k+"px")}}}};b.prototype.ShowMapContainer=function(e){e.addClass("SiebelMapContainer");var d=true;this.AdjustHeight(d);e.show()};b.prototype.HideMapContainer=function(){var e=this.GetmapContainer();var d=false;this.AdjustHeight(d);e.removeClass("SiebelMapContainer");e.hide()};b.prototype.LoadAPI=function(d){if(typeof(google)!=="undefined"){google.load("maps","3",{other_params:"sensor=false",callback:d})}};return b}())};