if(typeof(SiebelAppFacade.JSTreeRenderer)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.JSTreeRenderer");if(typeof(SiebelApp)!="undefined"&&typeof(SiebelApp.S_App)!="undefined"){if(typeof(SiebelApp.Constants)!="undefined"){SiebelApp.S_App.RegisterConstructorAgainstKey(SiebelApp.Constants.get("SWE_UIDEF_SCRTREE_PRENDR"),"SiebelAppFacade.JSTreeRenderer")}}SiebelAppFacade.JSTreeRenderer=(function(){var a=SiebelJS.Dependency("SiebelApp.Constants");function b(f){var d=f;this.GetPM=function(){return d};var g={};this.GetDataSet=function(){return g};this.EmptyDataSet=function(){g={}};if(this.GetPM().Get("IsScreen")){this.GetPM().AttachPMBinding("Refresh",this.BindData,{scope:this})}this.GetKey=function(){var i=a.get("SWE_PROP_NC_ID_SCREEN_CONTROL");var h=this.GetPM().Get("IsScreen")?"screenName":"viewName";this.GetKey=function(){return h};return h};var e=this;$(window).resize(function(){if(e.TreeLoaded){e.Refresh(true)}})}b.prototype.ShowUI=function(){var d=this.GetPM();var f=this;var e=$("#"+d.Get("GetType"));SiebelJS.Log("[JSTreeRenderer] -> jqcontainer = "+e.length);if(e.length===1){e.dynatree({autoCollapse:true,imagePath:" ",classNames:{nodeIcon:null},clickFolderMode:3,minExpandLevel:1,persist:false,expandOnAdd:true,onPostInit:function(h,g){this.reactivate()},onClick:function(j,i){var l;var g=f.GetPM();if(j&&j.getEventTargetType(i)==="title"&&j.data.key){var m;if(j.data.isFolder===true){if(f.GetDataSet()!==null){l=f.GetDataSet()[j.data.key];m=l[g.Get("IsScreen")?"defaultViewName":f.GetKey()]}}else{var h=g.Get("GetSelectedTabKey");var k=null;if(h!==null&&h!==undefined){k=g.Get("GetTabInfo")[h][f.GetKey()]}if(k!==j.parent.data.key){k=j.parent.data.key}l=f.GetDataSet()[k];m=l.links[j.data.key].viewName}if(!g.OnControlEvent("OnClick",m)){return false}}return true}});this.TreeLoaded=true}};b.prototype.BindEvents=function(){};b.prototype.BindData=function(){var e=this.GetPM();var l=e.Get("GetDataReload");var d=e.Get("GetTabInfo");var j=e.Get("GetSelectedTabLinkInfo");var k;var h;if(l){this.EmptyDataSet()}var g=this.GetDataSet();var f={};if(d!==null&&(l)){for(h in d){if(d.hasOwnProperty(h)){if(h.search("tabScreen")===-1){continue}k=d[h];g[k[this.GetKey()]]=k}}}var i=e.Get("GetSelectedTabKey");var n=null;if(i!==null&&i!==undefined&&d[i]!==undefined){n=d[i][this.GetKey()]}var m=false;if(j!==null&&g[n]!==undefined&&g[n].links===undefined){for(h in j){if(j.hasOwnProperty(h)){if(h.search("tabView")===-1){continue}k=j[h];f[k.viewName]=k}}g[n].links=f;m=true}if(l){m=true}this.Refresh(m)};b.prototype.Refresh=function(s){if(!s){return}var D=this.GetPM();if($("#"+D.Get("GetType")).dynatree("getRoot").length===0){return}$("#"+D.Get("GetType")).dynatree("getRoot").removeChildren();var v=D.Get("GetTabInfo")||{};var r=D.Get("GetSelectedTabLinkInfo")||{};var G=$("#"+D.Get("GetType")).dynatree("getRoot");var d;var h;var J;if(D.Get("IsScreen")){d=G.addChild({title:"Screens",key:"AllScreens",addClass:"dynatree-root-tag",isFolder:true,expand:true,url:null})}else{d=G}var m=D.Get("GetSelectedTabKey");var o=null;if(m!==null&&m!==undefined){o=(v[m]||v.tabScreen0)[this.GetKey()]}o=String(o);var q=D.Get("GetSelectedLinkKey");var i=null;if(q!==null&&q!==undefined){i=r[q]?r[q].viewName:""}i=String(i);var g=($("#"+D.Get("GetType")).width())>($("#"+D.Get("GetType")).height())?1:0;var u=g?$("#"+D.Get("GetType")).width():$("#"+D.Get("GetType")).height();var p=45;var w=false;var t="j_"+D.Get("GetType");var H=(D.Get("IsScreen"))?"siebui-nav-screenlist":"siebui-nav-viewlist";var F='<select id="'+t+'" class="'+H+'"><option></option>';var B=false;var I=(D.Get("GetTabInfo")[D.Get("GetSelectedTabKey")]||D.Get("GetTabInfo")["tabScreen0"]);var C=null;C=d.addChild({title:I.captionName,isFolder:true,url:I.captionName,icon:I.tabIcon,activate:(I.captionName===o),addClass:(I.captionName===o)?"screen-tab-selected":"screen-tab-deselected",expand:I.captionName===o,key:I});var j=$($(C)[0].li).outerWidth(true);p+=j;d.removeChildren();$("#"+t).remove();var E=0;var k=0;for(var e in this.GetDataSet()){if(!w){h=d.addChild({title:this.GetDataSet()[e].captionName,isFolder:true,url:this.GetDataSet()[e].captionName,icon:this.GetDataSet()[e].tabIcon,activate:(e===o),addClass:(e===o)?"screen-tab-selected":"screen-tab-deselected",expand:e===o,key:e});if(e===o){B=true;p-=j}for(J in this.GetDataSet()[e].links){if(this.GetDataSet()[e].links.hasOwnProperty(J)){var f=h.addChild({title:this.GetDataSet()[e].links[J].captionName,isFolder:false,url:this.GetDataSet()[e].links[J].captionName,activate:J===i,addClass:(J===i)?"view-tab-selected":"view-tab-deselected",key:J})}}var y=g?$($(h)[0].li).outerWidth(true):$($(h)[0].li).outerHeight(true);if((p+y)<=u){p+=y}else{if(g){w=true;h.remove();F+="<option value = "+(this.GetDataSet()[e].captionName)+">"+(this.GetDataSet()[e].captionName)+"</option>";k++}}}else{F+="<option value = "+(this.GetDataSet()[e].captionName)+">"+(this.GetDataSet()[e].captionName)+"</option>";k++}E++}if(w){F+="</select>";$("#"+D.Get("GetType")).append(F);var A=this.GetDataSet()[o].captionName;$("#"+t).find("option").each(function(){if(String(A)===$(this).text()){$(this).remove()}})}if(!B){var n=(D.Get("IsScreen"))?String(I.screenName):String(I.viewName);h=d.addChild({title:I.captionName,isFolder:true,url:I.captionName,icon:I.tabIcon,activate:(n===o),addClass:(n===o)?"screen-tab-selected":"screen-tab-deselected",expand:n===o,key:n});for(J in I.links){if(I.links.hasOwnProperty(J)){var z=h.addChild({title:I.links[J].captionName,isFolder:false,url:I.links[J].captionName,activate:J===i,key:J})}}}var l=this;$("#"+t).change(function(){var L=$("#"+t).find("option:selected").text();for(var K in l.GetDataSet()){if(L===String(l.GetDataSet()[K].captionName)){var M=l.GetDataSet()[K].viewName;if(M===null||M===undefined){M=l.GetDataSet()[K].defaultViewName}D.OnControlEvent("OnClick",M)}}});var x={};x.comboContainer=t;x.chtotal=E;x.count=k;x.overflow=w;c.call(this,d,x)};function c(t,v){var k=this.GetPM();var m=k.Get("GetTabContainerQTPInfo");var d=k.Get("GetTabItemsQTPInfo");var p=k.Get("IsScreen")?(k.Get("GetTabInfo")[k.Get("GetSelectedTabKey")]&&k.Get("GetTabInfo")[k.Get("GetSelectedTabKey")].screenName):(k.Get("GetTabInfo")[k.Get("GetSelectedTabKey")]&&k.Get("GetTabInfo")[k.Get("GetSelectedTabKey")].viewName);var s=k.Get("GetTabViewLinkContainerQTPInfo");var f=k.Get("GetTabViewLinkItemsQTPInfo");var l=a.get("SWE_PROP_QTP_OT");var r=a.get("SWE_PROP_QTP_RN");var q=a.get("SWE_PROP_QTP_UN");if(m&&(typeof(m.GetProperty)==="function")){t.ul.setAttribute("ot",m.GetProperty(l));t.ul.setAttribute("rn",m.GetProperty(r));t.ul.setAttribute("un",m.GetProperty(q))}for(var o=0;o<t.getChildren().length;o++){var e=t.getChildren()[o];if(d[o]&&(typeof(d[o].GetProperty)==="function")){e.li.setAttribute("ot",d[o].GetProperty(l));e.li.setAttribute("rn",d[o].GetProperty(r));e.li.setAttribute("un",d[o].GetProperty(q))}if((e.getChildren()!==null)&&(p===e.data.key)){if(s&&(typeof(s.GetProperty)==="function")){e.ul.setAttribute("ot",s.GetProperty(SiebelApp.Constants.get(l)));
e.ul.setAttribute("rn",s.GetProperty(SiebelApp.Constants.get(r)));e.ul.setAttribute("un",s.GetProperty(SiebelApp.Constants.get(q)))}for(var n=0;n<e.getChildren().length;n++){var h=e.getChildren()[n];if(f[n]&&(typeof(f[n].GetProperty)==="function")){h.li.setAttribute("ot",f[n].GetProperty(l));h.li.setAttribute("rn",f[n].GetProperty(r));h.li.setAttribute("un",f[n].GetProperty(q))}}}}if(!v.overflow){return}var t=$("#"+v.comboContainer);var u=k.Get("GetJumpTabQTPInfo");var l=a.get("SWE_PROP_QTP_OT");var r=a.get("SWE_PROP_QTP_RN");var q=a.get("SWE_PROP_QTP_UN");var g=v.chtotal-v.count;if(u&&(typeof(u.GetProperty)==="function")){t.attr("ot",u.GetProperty(l));t.attr("rn",u.GetProperty(r));t.attr("un",u.GetProperty(q))}e=t.children("option");var n=1;for(o=g;o<v.chtotal&&e.length>0;o++){if(d[o]&&(typeof(d[o].GetProperty)==="function")){e.eq(n).attr("ot",d[o].GetProperty(l));e.eq(n).attr("rn",d[o].GetProperty(r));e.eq(n).attr("un",d[o].GetProperty(q));n++}}}return b}())};