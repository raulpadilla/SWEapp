/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2013 Oracle and/or its affiliates. All rights reserved.
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
if(typeof(SiebelAppFacade.SmartScriptPresentationModel)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.SmartScriptPresentationModel");define("siebel/smartscriptpmodel",[],function(){SiebelAppFacade.SmartScriptPresentationModel=(function(){var b=SiebelJS.Dependency("SiebelApp.Utils");var a=SiebelJS.Dependency("SiebelApp.Constants");function g(h){this.m_name="";this.m_label="";this.m_afterFluff="";this.m_beforeFluff="";this.m_requiredIndicatorStyle="*";this.m_currPage=null;this.m_pageArray=[];this.m_exposedSectionArray=[];this.m_bAtFinish=0;this.m_currQuest=null;var i=null;SiebelAppFacade.SmartScriptPresentationModel.superclass.constructor.call(this,h);this.CcInitialize=function(r){var k;var n=r.GetChild(0);var l=r.GetProperty(a.get("SWE_PROP_NAME"));i=this.ExecuteMethod("GetControl",l);if(n===null){SiebelJS.Log("SmartScript missing property set for custom control.");return false}k=n.EnumChildren(true);while(k){var o=0;var t=k.GetType();var q=k.GetChildCount();var j;var s;var p;SiebelJS.Log("SmartScript property set ["+t+"] with ["+q+"] children.");if(t==="PageInfo"){for(o=0;o<q;o++){j=k.GetChild(o);s=new f();s.m_name=j.GetProperty("p_n");s.m_displayName=j.GetProperty("p_dn");if(s.m_name!==null){s.m_index=this.m_pageArray.length;this.m_pageArray[s.m_index]=s}}}else{if(t==="QuestInfo"){for(o=0;o<q;o++){j=k.GetChild(o);p=new d();p.m_name=j.GetProperty("q_n");p.m_controlName=j.GetProperty("q_cn");p.m_displayName=j.GetProperty("q_dn");p.m_fieldName=j.GetProperty("q_fn");p.m_pageName=j.GetProperty("q_pn");p.m_uiInputName=j.GetProperty("q_uin");p.m_enabledHTML=j.GetProperty("q_html");p.m_bEnable=(j.GetProperty("q_en")==="1");p.m_bInfoOnly=(j.GetProperty("q_io")==="1");p.m_mustAnswer=parseInt(j.GetProperty("q_ma"),10);s=this.GetPage(p.m_pageName);if(s!==null&&p.m_name!==null){s.m_questionArray[s.m_questionArray.length]=p}}}else{if(t==="ExposedQuest"){for(o=0;o<q;o++){j=k.GetChild(o);var m=j.GetProperty("q_n");if(this.m_currPage!==null){p=this.m_currPage.GetQuestion(m);p.m_bIsExposed=1;this.m_exposedSectionArray[this.m_exposedSectionArray.length]=p}}}else{if(t==="ScriptInfo"){this.m_name=k.GetProperty("s_n");this.m_label=k.GetProperty("s_l");this.m_requiredIndicatorStyle=k.GetProperty("s_ri");this.m_beforeFluff=k.GetProperty("s_bf");this.m_afterFluff=k.GetProperty("s_af");var u=k.GetProperty("s_cp");if(this.m_requiredIndicatorStyle===null||this.m_requiredIndicatorStyle===""){this.m_requiredIndicatorStyle="*"}this.SetCurrentPage(u)}}}}k=n.EnumChildren(false)}return true};this.CcPopulate=function(){this.GenExposedSectionSpans();this.DisplayExposedSection()};this.SetCurrentPage=function(j){this.HideCurrentPage();var k=this.GetPage(j);if(k!==null){this.m_currPage=k;this.m_currPage.m_bIsExposed=1}};this.HideCurrentPage=function(){var k=0;if(this.m_currPage===null){return}this.m_currPage.m_bIsExposed=0;for(k=0;k<this.m_currPage.m_questionArray.length;k++){var j=this.m_currPage.m_questionArray[k];if(j!==null&&j.m_bIsExposed){j.m_bIsExposed=0}}};this.HidePreviousSection=function(){var k;var j;if(this.m_exposedSectionArray.length>0){for(k=0;k<this.m_exposedSectionArray.length;k++){j=this.m_exposedSectionArray[k];if(j!==null){j.m_bIsExposed=0}}}this.m_exposedSectionArray.splice(0)};this.SetExposedQuestion=function(j){var l;var k;if(j!==null&&j!==""&&this.m_currPage!==null){k=this.m_currPage.GetQuestion(j);if(k!==null){k.m_bIsExposed=1;if(this.m_exposedSectionArray===null){this.m_exposedSectionArray=[]}l=this.m_exposedSectionArray.length;this.m_exposedSectionArray[l]=k}}};this.GetPage=function(j){var k;var l;if(this.m_pageArray===null){return(null)}for(k=0;k<this.m_pageArray.length;k++){l=this.m_pageArray[k];if(l.m_name===j){return(l)}}return(null)};this.GenExposedSectionSpans=function(){var k=0;if(this.m_currPage===null){return false}var l="";for(k=0;k<this.m_exposedSectionArray.length;k++){var j=this.m_exposedSectionArray[k];if(j!==null&&j.m_bIsExposed&&j.m_pageName===this.m_currPage.m_name){if(j.m_enabledHTML!==null&&j.m_enabledHTML!==undefined){l=l+j.m_enabledHTML}else{SiebelJS.Log("SmartScript error, GenExposedSectionSpans missing enabledHTML for question ["+j.m_uiInputName+"] - "+j.m_displayName)}}}this.GetRenderer().PopulateQuestionList(this.m_beforeFluff+l+this.m_afterFluff);return true};this.DisplayExposedSection=function(){var k=0;var l=this.GetRenderer();l.DisplayPageLabel(this.m_currPage);for(k=0;k<this.m_exposedSectionArray.length;k++){var j=this.m_exposedSectionArray[k];l.DisplayQuestion(j,this.m_requiredIndicatorStyle)}$("body").scrollTop();return true};this.GetHtmlForQuestions=function(){var n={};var p=this.GetRenderer();var m,l;var o;var k;for(m=0;m<this.m_pageArray.length;m++){o=this.m_pageArray[m];for(l=0;l<o.m_questionArray.length;l++){k=o.m_questionArray[l];n[k.m_uiInputName]=k}}p.ExtractHtmlForQuestions(n)};this.ShowExposedQuestions=function(){var n=this.GetRenderer();var j=this.Get("GetControls");for(var m=0;m<this.m_exposedSectionArray.length;m++){var l=this.m_exposedSectionArray[m];var k=l.m_uiInputName;var p=null;for(var o in j){if(j.hasOwnProperty(o)){if(j[o].GetInputName()===k){p=j[o];break}}}if(p!==null){n.ShowUIControl(p);n.BindControlEvents(p)}else{SiebelJS.Log("SmartScript Error: control not found for question: "+k)}}n.ShowSelection();$("body").scrollTop();return true};this.FocusOnFirstQuestion=function(){var j=this.Get("GetControls");var p=null;for(var m=0;m<this.m_exposedSectionArray.length;m++){var l=this.m_exposedSectionArray[m];var k=l.m_uiInputName;var o=null;for(var n in j){if(j.hasOwnProperty(n)){if(j[n].GetInputName()===k){o=j[n];break}}}if(p===null&&o!==null){p=o;break}}this.SetProperty("firstQuestionFocus",p);return true};this.GetSmartScriptControl=function(){return i};this.ExpandNotifyArgs=function(p,j){var n;var k;var q=p;var o;var l;var m;var r;if(j===null){return}j.splice(0);l=0;while(q.length>0){m=q.indexOf("*",l);if(m<0){return(null)}q=q.substr(m+1,q.length);o=parseInt(q,10);if(isNaN(o)){return}m=q.indexOf("*",l);q=q.substr(m+1,q.length);r="";r=q.substr(0,o);q=q.substr(o,q.length);j[j.length]=r}};this.OnNewPage=function(k){if(k!==null&&k.length>0){var j=k[0];this.SetCurrentPage(j)}};this.OnNewQuestion=function(n){var m;var j;var l;var o=[];var k=n[0];if(k){this.ExpandNotifyArgs(k,o)}if(n!==null&&n.length>0){if(this.m_currPage!==null){if(o!==null&&o.length>0){j=o[0];l=o[1]}if(j!==""){m=this.m_currPage.GetQuestion(j);if(m!==null){this.m_currQuest=m}}}}};this.OnRefreshDashboard=function(j){if(j.length>0){var k=j[0].substring(j[0].indexOf("=")+1,j[0].lastIndexOf(";")-1);SiebelApp.S_App.SetNextTargetViewContainer("Dashboard");SiebelApp.S_App.GotoURL(k,"Dashboard")}};this.OnExposeSection=function(q){var l;var o;var m;var n;var k;var r;var j=[];if(this.m_exposedSectionArray.length>0){this.HidePreviousSection()}if(q!==null&&q.length>0){for(o=0;o<q.length;o++){var p=q[o];if(p!==""){this.ExpandNotifyArgs(p,j);if(j.length>0){n=j[0];k=j[1];l=j[2];r=j[3];if(n!==""){m=this.m_currPage.GetQuestion(n);if(m!==null){m.m_displayName=k;if(l==="Y"||l==="y"){m.m_bAnswered=true
}else{m.m_bAnswered=false}if(r==="Y"||r==="y"){m.m_bEnable=true}else{m.m_bEnable=false}}this.SetExposedQuestion(n)}}}}}this.GenExposedSectionSpans();this.DisplayExposedSection();this.ShowExposedQuestions();this.FocusOnFirstQuestion()};this.OnUpdateQuestions=function(q){var l;var r;var p,m;var s,n;var k;var o;var j=[];if(q!==null&&q.length>0){o=q[0];if(o!==""){this.ExpandNotifyArgs(o,j);if(j.length>0){s=j[0];n=j[1];k=j[2];l=j[3];r=j[4];if(n!==""&&s!==""){p=this.GetPage(s);if(p!==null){m=p.GetQuestion(n);if(m!==null){m.m_displayName=k;if(l==="Y"||l==="y"){m.m_bAnswered=true}else{m.m_bAnswered=false}if(r==="Y"||r==="y"){m.m_bEnable=true}else{m.m_bEnable=false}}}}}}}}}SiebelJS.Extend(g,SiebelAppFacade.PresentationModel);g.prototype.Init=function(){SiebelAppFacade.SmartScriptPresentationModel.superclass.Init.call(this);this.AddProperty("firstQuestionFocus",null);this.AttachEventHandler(a.get("PHYEVENT_INVOKE_CONTROL"),e);this.AttachNotificationHandler(a.get("SWE_PROP_BC_NOTI_GENERIC"),function(h){c.call(this,h)})};g.prototype.Setup=function(h){SiebelAppFacade.SmartScriptPresentationModel.superclass.Setup.call(this,h);SiebelApp.S_App.uiStatus.Busy({timeOut:false,mask:true});var k=h.EnumChildren(true);do{if(k.GetType()===a.get("SWE_PST_CNTRL_LIST")){var i=k.EnumChildren(true);var j=k.GetChildCount();SiebelJS.Log("SmartScript control list of ["+j+"] controls.");do{if(i.GetType()===a.get("SWE_PST_CUSTOM_CTRL")){SiebelJS.Log("SmartScript got custom control information.");this.CcInitialize(i);break}i=k.EnumChildren(false)}while(i);break}k=h.EnumChildren(false)}while(k)};g.prototype.Show=function(){this.GetHtmlForQuestions();this.CcPopulate();SiebelAppFacade.SmartScriptPresentationModel.superclass.Show.call(this);this.FocusOnFirstQuestion();SiebelApp.S_App.uiStatus.Free()};function c(k){var j=k.GetProperty(a.get("SWE_PROP_NOTI_TYPE"));var l=k.GetProperty(a.get("SWE_PROP_ARGS_ARRAY"));var o=[];if(l){CCFMiscUtil_StringToArray(l,o)}switch(j){case"SWEICanUpdate":break;case"EndOfScript":this.m_bAtFinish=1;break;case"ResetAll":break;case"NewPage":this.OnNewPage(o);break;case"NewQuestion":this.OnNewQuestion(o);break;case"ExposeSection":this.OnExposeSection(o);break;case"RefreshDashboard":this.OnRefreshDashboard(o);break;case"UpdateQuestions":this.OnUpdateQuestions(o);break;case"GetQuickPickInfo":var q=o[1];var i=o[2];var m=o[3];var n=(o[4]==="true");var r=o[5];var p=o.splice(6);var h=this.Get("GetActiveControl");var s=h.GetFieldName();break;default:break}}function e(h){var i=false;return true}function f(){this.m_name="";this.m_displayName="";this.m_bIsExposed=0;this.m_index=-1;this.m_questionArray=[]}f.prototype={};f.prototype.GetQuestion=function(h){var j;var k;if(this.m_questionArray===null){return(null)}for(k=0;k<this.m_questionArray.length;k++){j=this.m_questionArray[k];if(j.m_name===h){return(j)}}return(null)};function d(){this.m_bEnable=true;this.m_bIsExposed=0;this.m_controlName="";this.m_displayName="";this.m_fieldName="";this.m_index=-1;this.m_mustAnswer=0;this.m_bAnswered=0;this.m_bInfoOnly=0;this.m_name="";this.m_pageName="";this.m_uiInputName="";this.m_height=0;this.m_width=0;this.m_maxLength=0;this.m_group="";this.m_enabledHTML=""}d.prototype={};return g}());return"SiebelAppFacade.SmartScriptPresentationModel"});SiebelApp.S_App.RegisterConstructorAgainstKey("SmartScriptPM","SiebelAppFacade.SmartScriptPresentationModel")};