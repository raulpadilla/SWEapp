/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2013 Oracle and/or its affiliates. All rights reserved.
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
if(typeof(SiebelAppFacade.ChatPhyRenderer)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.ChatPhyRenderer");var consts=SiebelJS.Dependency("SiebelApp.Constants");var utils=SiebelJS.Dependency("SiebelApp.Utils");SiebelAppFacade.ChatPhyRenderer=(function(){var q;var j;function z(H){SiebelAppFacade.ChatPhyRenderer.superclass.constructor.call(this,H)}SiebelJS.Extend(z,SiebelAppFacade.BasePR);z.prototype.Init=function(){SiebelAppFacade.ChatPhyRenderer.superclass.Init.call(this);this.AttachPMBinding("NewChatMessage",k,{scope:this});this.AttachPMBinding("ShowTypingMsg",B,{scope:this});this.AttachPMBinding("ChatResumed",r,{scope:this});this.AttachPMBinding("ChatIdHold",E,{scope:this});this.AttachPMBinding("ChatIdRemoved",d,{scope:this});this.AttachPMBinding("ChatUpdated",c,{scope:this});this.AttachPMBinding("ChatClearLog",G,{scope:this});this.AttachPMBinding("TextInput4Set",x,{scope:this});this.AttachPMBinding("UrlInput4Set",t,{scope:this});this.AttachPMBinding("GetTextInputValue",function(H){w.call(this,H)},{scope:this});this.AttachPMBinding("GetUrlInputValue",function(H){D.call(this,H)},{scope:this});this.AttachPMBinding("ChatTabMap",f,{scope:this});this.AttachPMBinding("CurrentChat",F,{scope:this});this.AttachPMBinding("ReadLastMessage",e,{scope:this});this.AttachPMBinding("SetFocus",a,{scope:this})};z.prototype.ShowUI=function(){SiebelAppFacade.ChatPhyRenderer.superclass.ShowUI.call(this);var H=$("#SS_ChatUI");if(H){H.attr("role","application")}Candy.Wrapper.init({renderer:this,onAgentTyping:h,onHoldTab:C,onSendMessage:A,onSwitchChat:y,implicitSave:n,focusToTitleBar:m})};z.prototype.BindEvents=function(){var K=$("#s_ChatPane").find("#s_chatclose");var I=$("#SS_ChatUI");if(K.length>0&&I){K.unbind("click");K.bind("click",{ctx:this},function(L){L.data.ctx.GetPM().OnControlEvent(consts.get("CHAT_PANE_CLOSE"));q="CLOSED";g.call(L.data.ctx,I)});l.call(this,K)}var J=$("#s_toolbar").find("[name='Toggle Chat Pane']");if(J.length>0&&I){o.call(this,J,I)}var H=$("#s_ChatPane").find("#chatpaneHeader");if(H.length>0&&I){i.call(this,H,I)}};z.prototype.BindData=function(){u.call(this);this.GetPM().ExecuteMethod("LoadChatData")};function o(J,I){var H=this;if(q===undefined||q==="CLOSED"){q="DOCK"}if(q==="DOCK"){g.call(H,I);I.css({top:0,right:"",bottom:"",left:0})}else{if(q==="FLOAT"){v.call(H,I)}}J.unbind("mouseup");J.bind("mouseup",function(){if(q==="DOCK"){q="HIDDEN";g.call(H,I)}else{if(q==="HIDDEN"){q="DOCK"}else{if(q==="FLOAT"){H.GetPM().ExecuteMethod("CloseChatPane");q="DOCK"}}}})}function i(J,L){var I=this;if(L.data("uiDraggable")===undefined){L.draggable({handle:J,start:function(){if(q==="FLOAT"){L.css({right:"",bottom:""})}},stop:function(){if(q==="DOCK"){q="FLOAT";v.call(I,L);L.css({top:"",right:5,bottom:5,left:""})}else{if(q==="FLOAT"){var O=parseInt(L.css("top"),10);var R=parseFloat(L.css("left"));var N=$(window).width();var M=L.outerWidth(true);var Q=50-M+parseInt(L.css("marginRight"),10);var P=$(window).height()-$("#s_ChatPane").find("#chatpaneHeader").outerHeight(true)-$("#s_ChatPane").find("#chat-tabs").outerHeight(true)-parseInt(L.css("marginTop"),10)-5;if(O<0){L.css("top",0)}else{if(O>P){L.css("top",P)}}if(SiebelApp.S_App.GetDirection()){if(R<Q){L.css("left",Q)}else{if(R>(N-M)){L.css("left",N-M)}}}else{if(R<5){L.css("left",5)}else{if(R>(N-50)){L.css("left",N-50)}}}}}}})}else{L.draggable("option","handle",J)}var K=$("#s_ChatPane").find("#chatContainer");K.css("cursor","default");var H=$("#s_ChatPane").find("#chat-rooms");J.unbind("dblclick");J.bind("dblclick",function(){if(q==="FLOAT"){if(j===undefined||j==="MAXIMIZED"){j="MINIMIZED";H.css("display","none");L.css({top:"",bottom:5})}else{if(j==="MINIMIZED"){j="MAXIMIZED";H.css("display","");L.css({top:5,bottom:""})}}}})}function h(I,H){I.GetPM().ExecuteMethod("AgentTyping",H)}function C(J,I,H){s.call(J,3,"OnHoldTab: "+I);J.GetPM().ExecuteMethod("HoldTab",I,H)}function A(I,H){s.call(I,3,"OnSendMessage: "+H.toString());I.GetPM().ExecuteMethod("SendMessage",H)}function n(H){return H.GetPM().ExecuteMethod("ImplicitSave")}function y(I,J,H){s.call(I,3,"OnSwitchChat: "+J+", "+H);I.GetPM().ExecuteMethod("SwitchChat",J,H)}function u(){var I=this.GetPM().Get("LocaleInfo");if(I){var J=$("#s_ChatPane").find("#IDS_CHATPANE_CAPTION");var H;if(J){H=J.parent();J.remove();H.append("<label>"+I.CAPTION+"</label>")}}}function k(){var H=this.GetPM().Get("NewChatMessage");if(H){Candy.Wrapper.TypingIndicator.hide(H.chatId);Candy.Wrapper.Room.appendMessage(H.chatId,H.userName,H.text,H.timestamp)}}function B(){var H=this.GetPM().Get("ShowTypingMsg");if(H){Candy.Wrapper.TypingIndicator.show(H.Id,H.caption);setTimeout(function(){Candy.Wrapper.TypingIndicator.hide(H.Id)},this.GetPM().Get("ChatSysPref").nCustomerTypeDisplayTime)}}function r(){var I=this.GetPM().Get("ChatResumed");if(I){var H=I.Id;if(I.state!==consts.get("CHATUISVC_CHATSTATE_ACTIVE")){Candy.Wrapper.Room.disable(H)}else{Candy.Wrapper.Room.enable(H)}Candy.Wrapper.Room.show(H);s.call(this,3,H+" is resumed")}}function E(){var H=this.GetPM().Get("ChatIdHold");if(H){Candy.Wrapper.Room.disable(H);s.call(this,3,H+" is held")}}function d(){var H=this.GetPM().Get("ChatIdRemoved");if(H){Candy.Wrapper.Room.close(H);s.call(this,3,H+" is removed")}}function c(){var I=this.GetPM().Get("ChatUpdated");if(I){var H=I.Id;if(!Candy.Wrapper.Room.exists(H)){Candy.Wrapper.Room.init(H,I.caption);s.call(this,3,H+" is added")}else{Candy.Wrapper.Room.updateTabCaption(H,I.caption);s.call(this,3,H+" is updated")}if(I.state!==consts.get("CHATUISVC_CHATSTATE_ACTIVE")){Candy.Wrapper.Room.disable(H)}else{Candy.Wrapper.Room.enable(H)}if(I.newMsgCnt>0){Candy.Wrapper.Room.showUnreadCount(H,I.newMsgCnt)}Candy.Wrapper.Room.updateTabTooltip(H,p(I))}}function F(){var I=this.GetPM().Get("CurrentChat");if(I){var H=I.Id;if(Candy.Wrapper.Room.exists(H)){Candy.Wrapper.Room.show(H);s.call(this,3,"Current chat is set to: "+H)}}}function p(H){if(H.newMsgCnt>0){return H.newMsg}else{return H.caption}}function b(J,I){var H=this.GetPM().Get("ChatSysPref");if(H&&H.bEnableBlinkTab){if(I){J.addEffectForCommToolbar("blink")}else{J.addEffectForCommToolbar("stopblink")}}}function f(){var H=this.GetPM().Get("ChatTabMap");for(var J in H){if(H.hasOwnProperty(J)){var K=H[J];if(!K){continue}var I=this.GetPM().ExecuteMethod("GetCurrChatId");if(K.Id===I&&K.state!==consts.get("CHATUISVC_CHATSTATE_HOLDNEW")){Candy.Wrapper.Room.removeClassToTab(J,"siebui-chattab-wrapup-terminate siebui-chattab-holdnew siebui-chattab-newmsg siebui-chattab-newmsg-holdnew");b.call(this,Candy.Wrapper.Room.getChatTab(J),false)}else{if(K.state===consts.get("CHATUISVC_CHATSTATE_WRAPUP")||K.state===consts.get("CHATUISVC_CHATSTATE_TERMINATE")){Candy.Wrapper.Room.removeClassToTab(J,"siebui-chattab-holdnew siebui-chattab-newmsg siebui-chattab-newmsg-holdnew");Candy.Wrapper.Room.addClassToTab(J,"siebui-chattab-wrapup-terminate");b.call(this,Candy.Wrapper.Room.getChatTab(J),false)}else{if(K.newMsgCnt>0||K.state===consts.get("CHATUISVC_CHATSTATE_HOLDNEW")){b.call(this,Candy.Wrapper.Room.getChatTab(J),true);
if(K.newMsgCnt<=0){Candy.Wrapper.Room.addClassToTab(J,"siebui-chattab-holdnew")}else{if(K.state!==consts.get("CHATUISVC_CHATSTATE_HOLDNEW")){Candy.Wrapper.Room.addClassToTab(J,"siebui-chattab-newmsg")}else{Candy.Wrapper.Room.removeClassToTab(J,"siebui-chattab-holdnew");Candy.Wrapper.Room.addClassToTab(J,"siebui-chattab-newmsg-holdnew")}}}}}}}}function G(){var H=this.GetPM().Get("ChatClearLog");if(H){Candy.Wrapper.Room.clearMessage(H.chatId)}}function x(){var H=this.GetPM().ExecuteMethod("GetCurrChatId");var I=this.GetPM().Get("TextInput4Set");Candy.Wrapper.Room.setInputText(H,I)}function t(){}function w(H){var I=Candy.Wrapper.Room.getInputText(H);this.GetPM().AddProperty("TextInput4Get",I)}function D(H){}function e(){var H=this.GetPM().Get("ReadLastMessage");Candy.Accessibility.Room.Log.readLastMessage(H)}function a(){if(q==="DOCK"||q==="FLOAT"){var H=this.GetPM().ExecuteMethod("GetCurrChatId");if(H&&Candy.Wrapper.Room.exists(H)){Candy.Accessibility.Room.Tab.setFocus(H)}else{m()}}}function s(I,H){this.GetPM().ExecuteMethod("LogMsg",I,"chatprenderer.js: "+H)}function v(H){H.css("position","fixed");H.css("z-index","9999");$("#_sweview").removeClass("siebui-chatpane-content-indent")}function g(H){H.css("position","");H.css("z-index","")}function m(){$("#s_chatclose").focus()}function l(H){H.attr({tabindex:"0","aria-label":"Close chat pane",role:"button"});H.unbind("keydown");H.bind("keydown",{ctx:this},function(J){if(J.which===$.ui.keyCode.TAB&&!J.shiftKey){var I=J.data.ctx.GetPM().ExecuteMethod("GetCurrChatId");if(I){Candy.Accessibility.Room.Tab.setFocus(I);J.preventDefault()}}else{if(J.which===$.ui.keyCode.ENTER||J.which===$.ui.keyCode.SPACE){$(this).trigger("click")}}})}return z}())};