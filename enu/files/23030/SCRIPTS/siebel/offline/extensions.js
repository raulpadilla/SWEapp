/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2013 Oracle and/or its affiliates. All rights reserved.
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
if(typeof(SiebelApp.AjaxRequestMgr)){(function(){var c=SiebelApp.AjaxRequestMgr.constructor;var k=SiebelJS.Dependency("SiebelApp.Utils");var i=SiebelApp.OfflineAppSettings;var d=SiebelApp.Offlineconstants;var h=SiebelApp.OfflineUtils;var g=[];var j=null;var e=window.location;var m=e.origin.concat(e.pathname);var b=false;var f=true;var a={};if(i.GetMode()){if(e.href===m||!(navigator.onLine)){var l=JSON.parse(window.localStorage.getItem("StringCache"));if(l){SiebelApp.S_App.SetStringCache(l)}}else{b=true}}c.prototype.ProcessToolbarResponse=function(r){var x="";if(this.data){x=this.data}else{if(this.url){x=this.url}}if(!x){return}var v;var s={};if(IsOfflineModeEnabled()&&(x.search("SWECmd=Go+")!==-1)&&(x.search("Offline")!==-1)){var o=CCFMiscUtil_CreatePropSet();o.DecodeFromString(r);v=SiebelApp.OfflineAppMgr.CheckValidation(o);if(v){var q;var u;if(o.GetType()!=="offpkg"){q="IDS_DOUI_ERR_OFFLINE_PKG_SRVR";u=SiebelApp.S_App.OfflineLocaleObject.GetLocalString(q);alert(u);SiebelJS.Log("Failed to get Offline Package from Server. Please verify Offline repository configuration.");$(".progressbar").remove();SiebelApp.S_App.CustomToolbar.Update("FullDownLoadFailed");s.bContinue=false;return s}var t=o.GetChildCount();var p=o.GetProperty("Status");var w=o.GetValue();if(p==="Error"||(!t&&w!=="nochng")){q="IDS_DOUI_ERR_METADATA_SRVR";SiebelJS.Log("Failed to Get MetaData from Server");u=SiebelApp.S_App.OfflineLocaleObject.GetLocalString(q);alert(u);$(".progressbar").remove();SiebelApp.S_App.CustomToolbar.Update("FullDownLoadFailed");s.bContinue=false;return s}if(w==="new"){s.bContinue=true;SiebelApp.BrowserCacheMgr.CacheSyncNodeId(o.GetProperty("SyncNodeId"));SiebelApp.BrowserCacheMgr.CacheSRFId(o.GetProperty("srfid"));s.args=[o];s.callback=function(y){SiebelApp.SyncMgr.LoadOfflinePackage(y,false)};return s}if(w==="nochng"){s.bContinue=true;s.args=[];s.callback=function(){i.OnSuccessfulMetaDataDownload();SiebelApp.ProactiveCacheBuilder.ClearDataTables(false)}}}else{s.bContinue=false}return s}if(IsOfflineModeEnabled()&&x.search("SWECmd=GetOfflineData")!==-1){var n=CCFMiscUtil_CreatePropSet();n.DecodeFromString(r);v=SiebelApp.OfflineAppMgr.CheckValidation(n);if(v){$.callback(this,function(){var y=function(){if(i.GetMetadata()){SiebelJS.Log("Received Offline Data Package. "+SiebelApp.OfflineUtils.GetTS());$(".progressbar").find("img").removeClass().addClass("offlineDataEnd");SiebelApp.SyncMgr.LoadOfflinePackage(n,true)}else{$.callback(this,function(){y.call(this)})}};y.call(this)})}else{return false}}};c.prototype.SetSrvrReqInputProp=function(s,z,t,v,y){var r=s;var x=SiebelApp.Constants;if(!k.IsEmpty(s)&&!k.IsEmpty(z)&&t){var p=t.length;var u=z.length;if(p===u){var o=k.DecodeFromQueryString(s);for(var q=0;q<u;q++){var w=o.GetProperty(z[q]);if(k.IsEmpty(w)||w!==t[q]){o.SetProperty(z[q],t[q])}}r=k.EncodeToQueryString(o,false);if(k.IsEmpty(y)){r=SiebelApp.S_App.GetPageURL()+x.get("SWE_ARG_START")+r}else{r=y+x.get("SWE_ARG_START")+r}}}return r};c.prototype.Get=function(n,p){var o={};o.url=n;o.type="GET";o.async=true;o.successfncallback=p;this.Ajax(o)};c.prototype.Post=function(n,p){var o={};o.successfncallback=p;this.Ajax(o)};c.prototype.SetDepnRequestMap=function(n){a=n};c.prototype.GetDepnRequestMap=function(n){return a[n]};c.prototype.SetActiveRequest=function(n,o){j=n;f=o};c.prototype.GetRequestQueue=function(){return g};c.prototype.GetActiveRequest=function(){return j};c.prototype.IsActiveRequestAsync=function(){return f};c.prototype.ClearActiveRequest=function(){return g.shift()};c.prototype.GetActiveRequestObj=function(){var o=this.GetActiveRequest();if(o){var n=o.url;if(o.data){n+="?"+o.data}n=h.JsonRecordSet(n);if(o.activeControl){n.activeControl=o.activeControl}return n}else{return null}};c.prototype.CanExecuteCurrRequest=function(w,n,x,y){var z={};var o;var t;if(x||!SiebelApp.RequestProcessor.IsSupported(y,false,this.GetActiveRequest())){return true}if(!n&&!n.SweCommands&&!n.SweCommands.SWEMethod){return false}else{o=n.SweCommands.SWEMethod}z=this.GetDepnRequestMap(o);var p=w.length;for(var r=0;r<p;r++){var u=w[r];var q=u.url;if(u.data){q+="?"+u.data}u=h.JsonRecordSet(q);if(!u&&!u.SweCommands&&!u.SweCommands.SWEMethod){return false}else{t=u.SweCommands.SWEMethod}if(SiebelApp.RequestProcessor.IsCUDRequest(t)){return true}if(z){var v=z.length;if(v>0){for(var s=0;s<v;s++){if(z[s]===t){return true}}}}}return false};c.prototype.Ajax=function(r,q){var o=r.url;if(r.data){o+="?"+r.data}if(b&&navigator.onLine){$.ajaxSetup({cache:"true"});$.ajax({url:r.url,data:r.data,type:r.type,async:r.async,contentType:r.contentType,success:function(v,w,u){var s=[];s.push(v);s.push(w);s.push(u);if(SiebelApp.OfflineUtils.IsValidServerResponse(v)){if(SiebelApp.S_App.GetUserName){if(SiebelApp.S_App.GetUserName()===SiebelApp.S_App.Model.GetLoginName()){b=false;var t=JSON.parse(window.localStorage.getItem("StringCache"));SiebelApp.S_App.CustomToolbar.Update("UpSyncDone");if(t){SiebelApp.S_App.SetStringCache(t)}}else{i.SetMode(false,true);b=false}}r.successfncallback.apply(r.context||this,s)}else{b=false;this.Ajax(r)}},error:r.errfncb,context:r.context,complete:function(s,u,t){if(u==="error"){b=false;this.Ajax(r)}}});return}if(i.CheckOfflineMode()&&(q!==false)&&(SiebelApp.OfflineAppMgr.IsCachableRequest(o))&&!i.GetMode()){$.ajaxSetup({cache:"true"});$.ajax({url:r.url,data:r.data,type:r.type,async:r.async,contentType:r.contentType,success:function(x,z,w){if(e.href===m){var v=k.DecodeFromQueryString(o);var u=v.GetProperty("SWECmd").toString();if(u==="GetCachedFrame"){var y=v.GetProperty("SWEFrame").toString();if(y==="top._swe"){if(SiebelApp.OfflineAppMgr.CheckServerConnection(x)){var t=e.pathname;t=t.concat("?SWENeedContext=false&SWECmd=Logoff&SWEBID=-1&SRN=&SWETS=");Top().location.replace(t);return}else{if(i.GetPkgStatus()){i.OnSuccessfulDataDownload();e.replace(e.origin.concat(e.pathname))}}}}}var s=[];s.push(x);s.push(z);s.push(w);if(SiebelApp.OfflineUtils.IsValidServerResponse(x)){SiebelApp.OfflineAppMgr.CacheResponse(o,s);r.successfncallback.apply(r.context||this,s)}else{SiebelJS.Log("Received Invalid Server Response for request: "+o);SiebelJS.Log("Invalid Server Response: "+x)}},error:r.errfncb,complete:function(u,x,v){if(x==="error"){var t=k.DecodeFromQueryString(o);var s=t.GetProperty("SWECmd").toString();if(s==="GetCachedFrame"){var w=t.GetProperty("SWEFrame").toString();if(w==="top._swe"){if(i.GetPkgStatus()){i.OnSuccessfulDataDownload();e.replace(e.origin.concat(e.pathname))}}}}}})}else{if(i.GetMode()&&SiebelApp.OfflineAppMgr.IsCachableRequest(o)){if(!this.GetActiveRequest()){this.SetActiveRequest(r,r.async);SiebelApp.OfflineAppMgr.OfflineRequestHandler(o,r,r.async);$.callback(this,function(){var s=this.IsActiveRequestAsync();var u=this.GetActiveRequestObj();this.SetActiveRequest(null);var t=this.GetRequestQueue();if(t.length>0&&(this.CanExecuteCurrRequest(t,u,s,o))){this.Ajax(this.ClearActiveRequest())}else{g=[]}})}else{if(!SiebelApp.OfflineAppMgr.CheckResolvedState()){var n=SiebelApp.S_App.GetActiveView();
if(n){var p=n.GetActiveApplet();if(n&&p&&p.GetActiveControl()){r.activeControl=p.GetActiveControl()}}g.push(r)}else{this.SetActiveRequest(null);g.push(r);this.Ajax(this.ClearActiveRequest())}}}else{$.ajax({url:r.url,data:r.data,type:r.type,async:r.async,contentType:r.contentType,success:r.successfncallback,error:r.errfncb,context:r.context})}}}}())}if(typeof(SiebelApp.OfflineExtensions)==="undefined"){Namespace("SiebelApp.OfflineExtensions");SiebelApp.OfflineExtensions=(function(){SiebelApp.S_App.constructor.prototype.OfflineCallMethod=function(){if(IsOfflineModeEnabled()){c.call(this,arguments)}};function c(f){var e=f[0];switch(e){case"ProcessAppletSelfProps":a.call(this,f);break;case"AddFieldName":d.call(this,f);break;case"ReplaceShortURL":b.call(this,f);break;default:break}}function a(g){if(SiebelApp.OfflineAppSettings.GetMode()){var f=g[1];var e=f.GetView();var h=e?e.GetActiveApplet():null;if(h){var i=h.GetActiveControl();if(i&&i.GetUIType()==="Pick"){var j={};j.SrcApplet=h.GetName();j.SrcAppletFld=i.GetFieldName();f.GetPickAppletSrcInfo=function(){return j}}}}}function d(l){if(SiebelApp.OfflineAppSettings.GetMode()){var i="OF_";var g=l[1];var h=l[2];var e=l[3];var f=l[4];var m=g.GetControls();var j=m[e];var k=j.GetFieldName();if((g.IsInQueryMode())||(j.GetCtrlFldEncode())){h.SetProperty(i+k,f)}else{h.SetProperty(i+k,g.GetFieldValue(j))}}}function b(g){var f=window.applicationCache;if(f.status!==1||(SiebelApp.OfflineAppSettings.GetMode())){var i=g[1];var e=g[2];var h="start.swe";History.pushState(null,null,h)}}}())};