/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2013 Oracle and/or its affiliates. All rights reserved.
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
if(typeof(SiebelApp.PharmaCallValidatorsvc)==="undefined"){SiebelJS.Namespace("SiebelApp.PharmaCallValidatorsvc");define("siebel/offline/PharmaCallValidatorsvc",["siebel/offline/model","siebel/offline/servicemodel"],function(){var e=0;var u=0;var c=false;var n=false;var w=[];var t={};var r={};var l=true;var o=true;var a="";var s=true;var f=[];var g=1;var v=6;var q=1;var b=2;var i=4;var h=[];var d;var m;var p;var x;var j=SiebelApp.Offlineconstants;var k={};k[j.get("DOUIREG_OBJ_NAME")]="LS Pharma Validation Service";k[j.get("DOUIREG_SRVC_NAME")]="PharmaCallValidatorsvc";SiebelApp.S_App.Model.ServiceRegistry(k);SiebelApp.PharmaCallValidatorsvc=(function(){var ap=SiebelJS.Dependency("SiebelApp.Utils");function H(){SiebelApp.PharmaCallValidatorsvc.superclass.constructor.call(this)}SiebelJS.Extend(H,SiebelApp.ServiceModel);H.prototype.DoCanInvokeMethod=function(ar){if(ar==="CallValidate"){$.setReturnValue({err:false,retVal:true});return}else{if(ar==="CanAddSample"){$.setReturnValue({err:false,retVal:true});return}else{return SiebelApp.PharmaCallValidatorsvc.superclass.DoCanInvokeMethod.call(this,ar)}}};H.prototype.DoInvokeMethod=function(av,au){var at=CCFMiscUtil_CreatePropSet();if(!av){$.setReturnValue({err:false,retVal:false});return}if(av==="CallValidate"){h=[];var ar=SiebelApp.S_App.GetActiveView().GetActiveApplet().GetBusComp();this.ExecuteAllBCs(ar);$.callback(this,function(ax){var aw=ax.err;if(aw!==true){this.CallValidate(au);$.callback(this,function(ay){at=ay.retVal;this.CleanUp();$.setReturnValue({err:false,retVal:at});return})}})}else{if(av==="CanAddSample"){aj.call(this,au);$.callback(this,function(aw){$.setReturnValue({err:aw.err,retVal:aw.retVal});return})}else{return SiebelApp.PharmaCallValidatorsvc.superclass.DoInvokeMethod.call(this,av,au)}}};function D(ar){var at=function(){ar.DeleteRecord();$.callback(this,function(){if(ar.GetWS().length>0){at.call(this)}})};if(ar.CheckActiveRow()===true){at.call(this)}}H.prototype.ExecuteAllBCs=function(aD){var az=[];d=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var at=d.GetBusComp("Pharma Attendee Call Mobile");var aA=d.GetBusComp("Pharma Call Products Detailed");var aE=d.GetBusComp("Pharma Promotional Items Dropped");var ar=d.GetBusComp("Pharma Call Sample Dropped");var ax=d.GetBusComp("LS Pharma Call Validation Results");p=SiebelApp.S_App.Model.GetBusObj("Contact");var av=p.GetBusComp("Pharma Professional State Licenses");var aB=p.GetBusComp("Pharma Address Inter Table - CE");var ay=p.GetBusComp("Contact");var aC=d.GetBusComp("Employee");x=SiebelApp.S_App.Model.GetBusObj("Account");var aw=x.GetBusComp("CUT Address - CE");var au=[];aD.FieldValue("Id");$.callback(this,function(aG){var aF=aG.retVal;aD.FieldValue("Category");$.callback(this,function(aH){var aI=aH.retVal;aD.FieldValue("Contact Id");$.callback(this,function(aK){var aJ=aK.retVal;aD.FieldValue("State");$.callback(this,function(aL){var aM=aL.retVal;aD.FieldValue("Contact Address Id");$.callback(this,function(aO){var aN=aO.retVal;aD.FieldValue("Account Address Id");$.callback(this,function(aQ){var aP=aQ.retVal;aD=d.GetBusComp("Pharma Professional Call - Mobile");aD.SetFldSearchSpec("Id",aF);aD.Execute();$.callback(this,function(aR){aD.Home();$.callback(this,function(aX){var a7=function(){aD.ActivateField("Primary Owner Id");aD.SetFldSearchSpec("Id",aF)};var a6=function(){h.push(aD);ar.ActivateField("Activity Id");ar.ActivateField("Lot Name");ar.ActivateField("Parent Inventory Flag");ar.ActivateField("Parent Lots Defined Flag");ar.ActivateField("Cutoff Date");ar.ActivateField("Call Date");ar.ActivateField("Max Per Call");ar.ActivateField("Max Per Allocation");ar.ActivateField("Sum Qty Alloc");ar.ActivateField("Stop Sampling Flag");ar.ActivateField("Controlled Substance");ar.SetFldSearchSpec("Activity Id",aF)};var a3=function(){h.push(ar);ax.ActivateField("Object Id");ax.ActivateField("Object Type");ax.ActivateField("Rule Number");ax.ActivateField("Message Type");ax.ActivateField("Message Type LIC");ax.ActivateField("Message");ax.ActivateField("Call Id");ax.SetFldSearchSpec("Call Id",aF)};var a1=function(){return[ax]};var a0=function(){h.push(ax);aA.SetFldSearchSpec("Activity Id",aF)};var aZ=function(){h.push(aA);aE.ActivateField("Max Per Call");aE.ActivateField("Max Per Allocation");aE.ActivateField("Stop Sampling Flag");aE.ActivateField("Sum Qty Alloc");aE.SetFldSearchSpec("Activity Id",aF)};var aY=function(){h.push(aE);at.ActivateField("Parent Activity Id");at.SetSearchExpr("[Parent Activity Id] = '"+aF+"'")};var aW=function(){h.push(at);var a8=SiebelApp.Metadata.GetUserProperty("License Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var a9=SiebelApp.Metadata.GetUserProperty("License Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var ba=SiebelApp.Metadata.GetUserProperty("License Status Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));av.ActivateField(a8);av.ActivateField(a9);av.ActivateField(ba);av.ActivateField("One Time Sample Flag");av.SetFldSearchSpec("Professional Id",aJ);av.SetFldSearchSpec("State",aM)};var aV=function(){h.push(av);var a8=SiebelApp.Metadata.GetUserProperty("DEA Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));aB.ActivateField(a8);a8=SiebelApp.Metadata.GetUserProperty("DEA Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));aB.ActivateField(a8);aB.SetFldSearchSpec("Professional Id",aJ);aB.SetFldSearchSpec("Address Id",aN)};var aU=function(){h.push(aB);var a8=SiebelApp.S_App.Model.GetLoginId();aC.ActivateField("Id");aC.ActivateField("OK to Sample");aC.SetFldSearchSpec("Id",a8)};var a5=function(){h.push(aC)};var aT=function(){var a9=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");var a8=SiebelApp.S_App.Model.GetLovNameVal("Professional Call","TODO_TYPE");if((aI===a8)&&aN){aw.SetFldSearchSpec("Id",aN)}else{aw.SetFldSearchSpec("Id",aP)}};var a4=function(){h.push(aw)};var aS=function(){ay.SetSearchSpec("[Id] = '"+aJ+"'")};var a2=function(){ay.PositionById(aJ);h.push(ay)};au[0]={execute:ar.Execute,executeScope:ar,preExecute:a6};au[1]={execute:ar.Home,executeScope:ar};au[2]={execute:ax.Execute,executeScope:ax,preExecute:a3};au[3]={execute:ax.Home,executeScope:ax};au[4]={execute:D,executeScope:this,preExecute:a1};au[5]={execute:aA.Execute,executeScope:aA,preExecute:a0};au[6]={execute:aA.Home,executeScope:aA};au[7]={execute:aE.Execute,executeScope:aE,preExecute:aZ};au[8]={execute:aE.Home,executeScope:aE};au[9]={execute:at.Execute,executeScope:at,preExecute:aY};au[10]={execute:at.Home,executeScope:at};au[11]={execute:av.Execute,executeScope:av,preExecute:aW};au[12]={execute:av.Home,executeScope:av};au[13]={execute:aB.Execute,executeScope:aB,preExecute:aV};au[14]={execute:aB.Home,executeScope:aB};au[15]={execute:aC.Execute,executeScope:aC,preExecute:aU};au[16]={execute:aC.Home,executeScope:aC,postExecute:a5};au[17]={execute:aw.Execute,executeScope:aw,preExecute:aT};
au[18]={execute:aw.Home,executeScope:aw,postExecute:a4};au[19]={execute:ay.Execute,executeScope:ay,preExecute:aS};au[20]={execute:ay.Home,executeScope:ay,postExecute:a2};$.eachAsyncOp(this,au);$.callback(this,function(a8){$.setReturnValue({err:false,retval:"success"})})})})})})})})})})};H.prototype.CallValidate=function(av){SiebelJS.Log("Invoked CallValidateOverride ");var au="Submit";var at=CCFMiscUtil_CreatePropSet();e=0;u=0;au=av.GetProperty("EventName");var ar=ao("Pharma Professional Call - Mobile");ak(ar);$.callback(this,function(ax){var aw=ax.retVal;if(aw){this.ValidateAttendeeCall(ar,au);$.callback(this,function(aA){var ay=e;var az=u;at.SetProperty("ErrorCount",ay);at.SetProperty("WarningCount",az);e=u=0;$.setReturnValue({err:false,retVal:at})})}else{G(ar);$.callback(this,function(az){var ay=az.retVal;if(ay){this.ValidateAccountCall(ar,au);$.callback(this,function(aC){var aA=e;var aB=u;at.SetProperty("ErrorCount",aA);at.SetProperty("WarningCount",aB);e=u=0;$.setReturnValue({err:false,retVal:at})})}else{this.ValidateProfCall(ar,au);$.callback(this,function(aC){var aA=e;var aB=u;at.SetProperty("ErrorCount",aA);at.SetProperty("WarningCount",aB);e=u=0;$.setReturnValue({err:false,retVal:at})})}})}})};H.prototype.ValidateAttendeeCall=function(au,av){SiebelJS.Log("Invoked ValidateAttendeeCall Method");var at=[];var ar=false;this.CleanUp();this.ExecuteAllBCs(au);$.callback(this,function(aw){this.PreValidate();$.callback(this,function(ax){this.SetValidateEventCode(av);$.callback(this,function(aA){for(var aD=1;aD<=20;aD++){var aF="Validation Rule "+aD;var az=SiebelApp.Metadata.GetUserProperty(aF,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));at.push(az)}var ay=at.length;for(var aB=0;aB<ay;aB++){var aC=at[aB];if(!ap.IsEmpty(aC)){var aG=aC.split(",");if((aG[4].valueOf()&b)===b){ar=true;var aE=this.ValidateRule(aC)}}}if(!ar){w=""}au.FieldValue("Id");$.callback(this,function(aI){var aH=aI.retVal;this.UpsertResult(aH)})})})})};H.prototype.ValidateAccountCall=function(au,aw){SiebelJS.Log("Invoked ValidateAccountCall Method");var at=[];var ar=false;var av;this.PreValidate();$.callback(this,function(ax){this.SetValidateEventCode(aw);$.callback(this,function(aB){for(var aE=1;aE<=20;aE++){var aG="Validation Rule "+aE;var az=SiebelApp.Metadata.GetUserProperty(aG,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));at.push(az)}var ay=at.length;for(var aC=0;aC<ay;aC++){var aD=at[aC];if(!ap.IsEmpty(aD)){var aI=aD.split(",");if((aI[4].valueOf()&i)===i){ar=true;var aF=this.ValidateRule(aD)}}}if(!ar){w=""}au.FieldValue("Id");$.callback(this,function(aL){av=aL.retVal;this.UpsertResult(av)});var aH=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var aK=aH.GetBusComp("Pharma Professional Call - Mobile");var aA=function(){this.ValidateAttendeeCall(aK,"SUBMIT");$.callback(this,function(aL){aK.NextRecord();$.callback(this,function(aN){var aM=aN.err;if(!aM){aA.call(this)}})})};var aJ=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");aK.SetSearchExpr("[Parent Activity Id] = '"+av+"' AND [Category] = '"+aJ+"'");aK.Execute();$.callback(this,function(aL){aK.Home();$.callback(this,function(aM){if(aK.CheckActiveRow()===true){aA.call(this);$.callback(this,function(aN){SiebelApp.S_App.Model.ReleaseBO(aH)})}})})})})};function ao(au){var ar;for(var at=0;at<h.length;at++){if(h[at].GetName().trim()===au){ar=h[at]}}return ar}H.prototype.ValidateProfCall=function(au,av){SiebelJS.Log("Invoked ValidateProfCall Method");var at=[];var ar=false;this.PreValidate();$.callback(this,function(aw){this.SetValidateEventCode(av);$.callback(this,function(az){for(var aC=1;aC<=20;aC++){var aE="Validation Rule "+aC;var ay=SiebelApp.Metadata.GetUserProperty(aE,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));at.push(ay)}var ax=at.length;for(var aA=0;aA<ax;aA++){var aB=at[aA];if(!ap.IsEmpty(aB)){var aF=aB.split(",");if((aF[4].valueOf()&q)===q){ar=true;var aD=this.ValidateRule(aB)}}}if(!ar){w=""}au.FieldValue("Id");$.callback(this,function(aH){var aG=aH.retVal;this.UpsertResult(aG);this.PostValidate()})})})};function ak(ar){J(ar,"Attendee Call");$.callback(this,function(at){$.setReturnValue({err:false,retVal:at.retVal})})}function G(ar){J(ar,"Account Call");$.callback(this,function(at){$.setReturnValue({err:false,retVal:at.retVal})})}function J(at,ar){var au="";var av="";if(!ap.IsEmpty(at)){au=at.FieldValue("Category");$.callback(this,function(ax){au=ax.retVal;av=SiebelApp.S_App.Model.GetLovValName(ar,"TODO_TYPE");var aw=false;if(au===av){aw=true}$.setReturnValue({err:false,retVal:aw})})}}H.prototype.CleanUp=function(){SiebelJS.Log("Invoked CleanUp Method");w=[];h=[];SiebelApp.S_App.Model.ReleaseBO(d);SiebelApp.S_App.Model.ReleaseBO(p);SiebelApp.S_App.Model.ReleaseBO(x);if(m){SiebelApp.S_App.Model.ReleaseBO(m)}};H.prototype.PreValidate=function(){SiebelJS.Log("Invoked PreValidate Method");var ar=ao("Pharma Professional Call - Mobile");ar.FieldValue("Category");$.callback(this,function(av){var au=av.retVal;var at=SiebelApp.S_App.Model.GetLovValName(au,"TODO_TYPE");if(at==="Attendee Call"||at==="Professional Call"){this.SaveCallProductState("Pharma Call Products Detailed");this.SetCtrledSamplingFlags();this.ProcessSREProfTypeException();this.SetCallType()}else{c=false;n=false}})};H.prototype.SaveCallProductState=function(){SiebelJS.Log("Invoked SaveCallProductState Method")};H.prototype.SetCallType=function(){SiebelJS.Log("Invoked SetCallType Method");var au;var aw=false;var ar=false;var ax=false;var at;var av;au=SiebelApp.S_App.GetActiveView().GetActiveApplet().GetBusComp();aw=N("Pharma Call Products Detailed");ar=N("Pharma Call Sample Dropped");if(aw&&ar&&ax){at=SiebelApp.S_App.Model.GetLovNameVal("DETAIL WITH SAMPLES","TODO_TYPE");au.SetFieldValue("Type",at,true)}else{if((aw&&ar)||(aw&&ax)){at=SiebelApp.S_App.Model.GetLovNameVal("Detail With Sample Drop","TODO_TYPE");au.SetFieldValue("Type",at,true)}else{if(aw){at=SiebelApp.S_App.Model.GetLovNameVal("Detail","TODO_TYPE");au.SetFieldValue("Type",at,true)}else{if(ar||ax){at=SiebelApp.S_App.Model.GetLovNameVal("Sample Drop","TODO_TYPE");au.SetFieldValue("Type",at,true)}else{at=SiebelApp.S_App.Model.GetLovNameVal("Call","TODO_TYPE");au.SetFieldValue("Type",at,true)}}}}};H.prototype.ProcessSREProfTypeException=function(){SiebelJS.Log("Invoked ProcessSREProfTypeException Method");var av=true;var at=true;var au="";var ar=ao("Pharma Professional Call - Mobile");U();$.callback(this,function(aw){var ax=aw.retVal;ar.FieldValue("Professional Type");$.callback(this,function(az){var aC=az.retVal;var aD=SiebelApp.S_App.Model.GetLovValName(aC,"CONTACT_TYPE");var aB=SiebelApp.S_App.Model.GetLovValName(ax,"STATE_ABBREV");var ay="SRE PT Exception - License: "+aD;var aA=SiebelApp.Metadata.GetUserProperty(ay,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(!ap.IsEmpty(aA)){au=aA.split("|");if(au[0]===aB||au[1]===aB){o=false}}ay="SRE PT Exception - DEA: "+aD;aA=SiebelApp.Metadata.GetUserProperty(ay,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));
if(!ap.IsEmpty(aA)){au=aA.split("|");if(au[0]===aB||au[1]===aB){s=false}}})})};H.prototype.CopyStateLicenseInfo=function(){SiebelJS.Log("Invoked CopyStateLicenseInfo Method");var ar="";var at="";var av="";var au=ao("Pharma Professional Call - Mobile");var aw=U();au.FieldValue("Contact Id");$.callback(this,function(aD){var ay=aD.retVal;au.SetCommitPending(true);au.WriteRecord();if(!ap.IsEmpty(aw)){var aB=ao("Pharma Professional State Licenses");var ax=SiebelApp.Metadata.GetUserProperty("License Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var aA=SiebelApp.Metadata.GetUserProperty("License Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var aC=SiebelApp.Metadata.GetUserProperty("License Status Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(aB.CheckActiveRow()===true){ar=aB.FieldValue(ax);at=aB.FieldValue(aA);av=aB.FieldValue(aC);var az=aB.FieldValue("One Time Sample Flag")}if(au.IsCommitPending()===true){au.WriteRecord()}au.SetFieldValue("License Number",ar);au.SetFieldValue("License Expiry Date",at);au.SetFieldValue("License Status",av);au.WriteRecord()}})};H.prototype.CopyDEAInfo=function(){SiebelJS.Log("Invoked CopyDEAInfo Method");var at=ao("Pharma Professional Call - Mobile");var av=at.FieldValue("Contact Id");var aw=at.FieldValue("Contact Address Id");if(!ap.IsEmpty(av)&&!ap.IsEmpty(aw)){var ax=ao("Pharma Address Inter Table - CE");if(ax.CheckActiveRow()!==true){return}var au=SiebelApp.Metadata.GetUserProperty("DEA Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var ar=ax.FieldValue(au);au=SiebelApp.Metadata.GetUserProperty("DEA Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var ay=ax.FieldValue(au);if(!ap.IsEmpty(ar)&&!ap.IsEmpty(ay)){at.SetFieldValue("DEA#",ar);at.SetFieldValue("DEA Expiry Date",ay);at.WriteRecord()}}};H.prototype.SetCtrledSamplingFlags=function(){SiebelJS.Log("Invoked SetCtrledSamplingFlags Method");c=false;n=false;var ar=ao("Pharma Call Sample Dropped");if(!ap.IsEmpty(ar)){var at=function(au){if(ar.CheckActiveRow()===true){ar.FieldValue("Controlled Substance");$.callback(this,function(av){var aw=av.retVal;if(aw==="Y"){c=true}else{n=true}ar.NextRecord();$.callback(this,function(ay){var ax=ay.err;if(!ax){at.call(this)}else{ar.Home()}})})}};if(ar.CheckActiveRow()===true){at.call(this)}}};H.prototype.SetValidateEventCode=function(au){SiebelJS.Log("Invoked SetValidateEventCode Method");var ar=false;var aw=false;var av=false;var at=ao("Pharma Professional Call - Mobile");at.FieldValue("Category");$.callback(this,function(az){var ay=az.retVal;var ax=SiebelApp.S_App.Model.GetLovValName(ay,"TODO_TYPE");if(ax==="Account Call"){a=v;return}if(!ap.IsEmpty(au)){if(au.toLowerCase()==="sign"){a=g}else{a=v}}else{at.FieldValue("Signature Captured");$.callback(this,function(aA){av=aA.retVal;if(av===false){at.FieldValue("Paper Signature");$.callback(this,function(aB){av=aB.retVal})}ar=av?true:false;if(ar){a=v}else{a=g}})}})};H.prototype.UpsertResult=function(aJ){SiebelJS.Log("Invoked UpsertResult Method");var aC=false;var aA={};var aw="";var aI=SiebelApp.S_App.OfflineErrorObject;var at=ao("LS Pharma Call Validation Results");if(at.CheckActiveRow()===true){aC=true}var ay=w.length;var ax=0;var aD=1;var az=[];var ar=[];var aK=[];var av=["Message Type","Message Type LIC","Message","Call Id","Rule Number"];var au=["strTemp","ErrMsgType","Message","Call Id"];var aG,aE;for(aG=0;aG<ay*2;aG=aG+2){aE=aG;var aH=function(aL){aA=w[ax];if((aA.ErrMsgType).toLowerCase()==="error"){aw=SiebelApp.S_App.Model.GetLovNameVal("ERROR","LS_VALIDATION_MESSAGE_TYPE")}else{if((aA.ErrMsgType).toLowerCase()==="ignore"){aw=SiebelApp.S_App.Model.GetLovNameVal("IGNORE","LS_VALIDATION_MESSAGE_TYPE")}else{if((aA.ErrMsgType).toLowerCase()==="warning"){aw=SiebelApp.S_App.Model.GetLovNameVal("WARNING","LS_VALIDATION_MESSAGE_TYPE")}else{aw=SiebelApp.S_App.Model.GetLovNameVal("SUCCESS","LS_VALIDATION_MESSAGE_TYPE")}}}if(aL===0){at.NewRecord(false)}ar[0]=av[aL];if(aL===0){ar[1]=aw}else{if(aL===1){ar[1]=aA.ErrMsgType}else{if(aL===2){ar[1]=aA.Message}else{if(aL===3){ar[1]=aJ}else{if(aL===4){ar[1]=aD;aD++}}}}}ar[2]=true;return ar};var aF=function(){at.SetCommitPending(true);aK[0]=false;return aK};var aB=function(){ax++};az[aE]={execute:at.SetFieldValue,executeScope:at,preExecute:aH,iterations:5};az[aE+1]={execute:at.WriteRecord,executeScope:at,preExecute:aF,postExecute:aB}}if(ay>0){$.eachAsyncOp(this,az);$.callback(this,function(aL){$.setReturnValue({err:false,retVal:"Success"})})}};H.prototype.PostValidate=function(){SiebelJS.Log("Invoked PostValidate Method");this.RestoreCallProductState("Pharma Call Products Detailed")};H.prototype.RestoreCallProductState=function(ar){SiebelJS.Log("Invoked RestoreCallProductState Method")};H.prototype.ValidateRule=function(ar){SiebelJS.Log("Invoked LogValidationMsg Method");var at=false;at=af(ar);if(at===true){var av=ar.split(",");var au=av[2].trim();an(ar,true);switch(au){case"IsValidCallDate":C();break;case"AreProductsDetailed":ab();break;case"IsValidPositionToSubmit":y();break;case"AreProdDetailedValid":ad();break;case"ValidateReqFields":P();break;case"ValidateSampRefNum":K();break;case"IsCallDateInReconciled":ag();break;case"IsValidSREProfType":T();break;case"AreSamplesRequestedValid":W();break;case"ArePromoItemsDroppedValid":V.call(this);break;case"IsLicenseExpired":A();break;case"IsValidLicenseNumber":al();break;case"IsValidLicenseStatus":ac();break;case"IsValidProfProfile":ai();break;case"IsValidEmpToSample":am.call(this);break;case"IsValidDEANumber":z();break;case"IsDEAExpired":Y();break;case"IsValidProfToSample":Q();break;case"AreSamplesDropped":ah();break;case"AreSamplesDroppedValid":S();break;default:break}an(ar,false)}};function af(ar){var at=false;if(!ap.IsEmpty(ar)){var au=ar.split(",");if(au[1].valueOf()&a){at=true}}return at}function an(ar,au){var at={};if(au){var av=ar.split(",");at.RuleName=av[0];at.EventToCheck=av[1];at.MethodName=av[2];at.ErrMsgType=av[3];at.RuleType=av[4];r=at}else{at.RuleName="";at.EventToCheck="";at.MethodName="";at.ErrMsgType="";at.RuleType="";r=at}}function I(){return r}function Z(ar){SiebelJS.Log("Invoked InitValidationMsg Method");var at;var au;t={};t.RuleName=r.RuleName;t.ObjectType=ar;if(ar==="CONTACT"){at=ao("Pharma Professional Call - Mobile");at.FieldValue("Contact Id");$.callback(this,function(av){au=av.retVal;t.ObjectId=au})}else{if(ar==="PHARMA CALL"){at=ao("Pharma Professional Call - Mobile");at.FieldValue("Id");$.callback(this,function(av){au=av.retVal;t.ObjectId=au})}else{if(ar==="EMPLOYEE"){at=ao("Employee")}}}}function X(ay,ax,aw){SiebelJS.Log("Invoked LogValidationMsg Method");if(ap.IsEmpty(ax)){ax=""}if(ap.IsEmpty(aw)){aw=""}if(l===false){return}var au="";var av={};var at=SiebelApp.S_App.OfflineLocaleObject;var az=at.GetLocalString(ay);if(!ap.IsEmpty(az)){var ar=SiebelApp.S_App.Model.GetLovNameVal(t.RuleName,"LS_VALIDATION_RULE_NAME");
au=ar+" : "+az}if(ay==="SSAPhmaValidationRuleIgnored"){SiebelJS.Log("LogValidationMsg  Rule Ignored ");t.ErrMsgType="IGNORE";au=t.RuleName+" : Rule Ignored"}else{if(ay==="SSAPhmaValidationRulePassed"){SiebelJS.Log("LogValidationMsg Success");t.ErrMsgType="SUCCESS";au=t.RuleName+" : Rule Passed"}else{SiebelJS.Log("LogValidationMsg Failed");t.ErrMsgType=r.ErrMsgType.trim();if(t.ErrMsgType==="ERROR"){e++}else{if(t.ErrMsgType==="WARNING"){u++}}}}if(!ap.IsEmpty(ax)){au=au.replace(/%1/,ax)}if(!ap.IsEmpty(aw)){au=au.replace(/%2/,aw)}t.Message=au;av=t;if(t.ErrMsgType==="ERROR"||t.ErrMsgType==="WARNING"){w.push(av)}}function ab(){Z("PHARMA CALL");var ar="";var av="";var au=N("Pharma Call Products Detailed");var at=ao("Pharma Professional Call - Mobile");at.FieldValue("Type");$.callback(this,function(aw){ar=aw.retVal;av=SiebelApp.S_App.Model.GetLovValName(ar,"TODO_TYPE");if(au||av.indexOf("Sample Drop")!==-1){return X("SSAPhmaValidationRulePassed")}else{return X("SSAPhmaErrDetailProd")}})}function N(au){var at=false;var ar=ao(au);if(ar.CheckActiveRow()===true){at=true}return at}function C(){Z("PHARMA CALL");var ar=ao("Pharma Professional Call - Mobile");if(!ap.IsEmpty(ar)){ar.FieldValue("Start Date");$.callback(this,function(au){var at=au.retVal;if((new Date(at).getTime()>new Date().getTime())){return X("SSAPhmaErrNoSignAfterToday")}})}}function y(){var ar="";Z("EMPLOYEE");var at=ao("Pharma Professional Call - Mobile");at.FieldValue("Primary Owner Id");$.callback(this,function(au){ar=au.retVal;if(ap.IsEmpty(ar)){ar="1-7D"}if(ar!==SiebelApp.S_App.Model.GetLoginId()){return X("SSAPhmaErrNoSignUnlessOwn")}else{return X("SSAPhmaValidationRulePassed")}})}function ad(){var au=1;Z("PHARMA CALL");var ar=ao("Pharma Call Products Detailed");var at=function(){ar.FieldValue("Priority");$.callback(this,function(aw){var ax=aw.retVal;var av=parseInt(ax,10);if((av!==au)||ap.IsEmpty(ax)||av===0){X("IDS_LS_TARGET_PRIORITY_VALIDATION_FAILED");return}else{au++;ar.NextRecord();$.callback(this,function(az){var ay=az.err;if(!ay){at.call(this)}})}})};if(ar.CheckActiveRow()===true){at.call(this)}}function P(){var av=false;var au="";var aw="";var ar="";Z("PHARMA CALL");var at=ao("Pharma Professional Call - Mobile");at.FieldValue("Category");$.callback(this,function(aA){ar=aA.retVal;ar="Required Fields To Submit: "+ar;aw=SiebelApp.Metadata.GetUserProperty(ar,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ap.IsEmpty(aw)){return}var az=aw.split(",");var ax=az.length;for(var ay=0;ay<ax;ay++){au=at.FieldValue(az[ay]);if(ap.IsEmpty(au)){av=true;return X("SSAFReqFieldNotExist",az[ay])}}})}function K(){var at="";Z("PHARMA CALL");if(c||n){var ar=ao("Pharma Professional Call - Mobile");ar.FieldValue("Contact Full Name");$.callback(this,function(av){var au=av.retVal;ar.FieldValue("Paper Signature");$.callback(this,function(aw){var ax=aw.retVal;ar.FieldValue("Signature Captured");$.callback(this,function(az){var ay=az.retVal;ar.FieldValue("Sample Reference Number");$.callback(this,function(aA){var aB=aA.retVal;if(ax===true){at=SiebelApp.Metadata.GetUserProperty("Enable Paper Reference Required",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(at.toLowerCase()==="y"){if(ap.IsEmpty(aB)){return X("SSAPhrmaErrRefNumIfSamp",au)}}else{if(ap.IsEmpty(aB)){ar.FieldValue("Id");$.callback(this,function(aC){at=aC.retVal;ar.SetFieldValue("Sample Reference Number",at)})}}}else{if(ay.toLowerCase()==="y"){if(at.toLowerCase()==="y"){if(ap.IsEmpty(aB)){return X("SSAPhrmaErrRefNumIfSamp",au)}}else{if(ap.IsEmpty(aB)){ar.FieldValue("Id");$.callback(this,function(aC){at=aC.retVal;ar.SetFieldValue("Sample Reference Number",at)})}}}else{t.RuleName="CALL NEED SIGN RULE";return X("SSAPhmaErrCallNeedsSign",au)}}return X("SSAPhmaValidationRulePassed")})})})})}else{return X("SSAPhmaValidationRuleIgnored")}}function ag(){var av=false;var au="";var ar="";Z("PHARMA CALL");var at=ao("Pharma Professional Call - Mobile");if(!ap.IsEmpty(at)){at.FieldValue("Signature Captured");$.callback(this,function(ay){av=ay.retVal;if(av===false){av=at.FieldValue("Paper Signature");$.callback(this,function(az){av=az.retVal})}var aw=av?true:false;if(!c&&!n&&!aw){return X("SSAPhmaValidationRuleIgnored")}if(true){aw=at.FieldValue("Signature Captured");if(aw){var ax=ao("Pharma Promotional Items Dropped");if(ax.CheckActiveRow()!==true){return X("SSAPhmaValidationRuleIgnored")}}}})}}function T(){var ax=false;var aw="";var av="";var at="";var au="";Z("CONTACT");aw=SiebelApp.Metadata.GetUserProperty("SRE Professional Types",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ap.IsEmpty(aw)){X("SSAPhmaValidationRuleIgnored");ax=true;$.setReturnValue({err:false,retVal:ax});return}var ar=ao("Pharma Professional Call - Mobile");ar.FieldValue("Professional Type");$.callback(this,function(aA){av=aA.retVal;var aB=SiebelApp.S_App.Model.GetLovValName(av,"CONTACT_TYPE");var az=","+aB+",";var ay=aw.indexOf(az);if(!ap.IsEmpty(av)&&(ay!==-1)){X("SSAPhmaValidationRulePassed");ax=true;$.setReturnValue({err:false,retVal:ax});return}U();$.callback(this,function(aD){var aF=aD.retVal;var aE=SiebelApp.S_App.Model.GetLovValName(aF,"STATE_ABBREV");var aC="SRE PT Exception - License: "+aB;at=SiebelApp.Metadata.GetUserProperty(aC,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));aC="SRE PT Exception - DEA: "+aB;au=SiebelApp.Metadata.GetUserProperty(aC,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ap.IsEmpty(at)){at=""}if(ap.IsEmpty(au)){au=""}if(!ap.IsEmpty(aF)&&((au.indexOf(aE)<0)&&c)){X("SSAPhrmaErrNotValidProfTypeForSRE");$.setReturnValue({err:ax,retVal:ax})}else{if(!ap.IsEmpty(aF)&&((at.indexOf(aE)<0)&&(c||n))){X("SSAPhrmaErrNotValidProfTypeForSRE");$.setReturnValue({err:ax,retVal:ax})}else{if(!ap.IsEmpty(aF)){X("SSAPhmaValidationRulePassed");$.setReturnValue({err:ax,retVal:ax})}}}if(!c&&!n){X("SSAPhmaValidationRuleIgnored");$.setReturnValue({err:ax,retVal:ax})}if(!ap.IsEmpty(aF)&&(at.indexOf(aE)>=0||au.indexOf(aE)>=0)){ax=true;$.setReturnValue({err:false,retVal:true});return}})})}function U(){var au="";var at=ao("Pharma Professional Call - Mobile");var ar=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");at.FieldValue("Category");$.callback(this,function(av){var ay=av.retVal;if(ay===ar){at.FieldValue("State");$.callback(this,function(az){var aA=az.retVal;$.setReturnValue({err:false,retVal:aA})})}else{var ax="State";var aw=ao("CUT Address - CE");aw.FieldValue(ax);$.callback(this,function(az){var aA=az.retVal;$.setReturnValue({err:false,retVal:aA})})}})}function W(){Z("PHARMA CALL")}function V(){Z("PHARMA CALL");var ar=false;var au=false;var aw=false;var at=I().ErrMsgType;if(at!=="IGNORE"){var ax=ao("Pharma Promotional Items Dropped");var av=function(){ax.FieldValue("Sum Qty Alloc");$.callback(this,function(ay){var az=ay.retVal;ax.SetFieldValue("Calc Sum Qty Alloc",az);$.callback(this,function(aA){ax.FieldValue("Max Per Allocation");$.callback(this,function(aB){az=aB.retVal;
ax.SetFieldValue("Alloc Max Qty Per Period",az,true);$.callback(this,function(aC){ax.FieldValue("Max Per Call");$.callback(this,function(aD){az=aD.retVal;ax.SetFieldValue("Alloc Max Qty Per Call",az,true);ax.FieldValue("Quantity");$.callback(this,function(aF){var aE=aF.retVal;if(aE<=0){return}E.call(this,ax);$.callback(this,function(aG){aw=aG.retVal;ar=!aw;O(ax);$.callback(this,function(aH){au=aH.retVal;ar=!au;F(ax);$.callback(this,function(aI){au=aI.retVal;ar=!au;ax.NextRecord();$.callback(this,function(aK){var aJ=aK.err;if(!aJ){av.call(this)}})})})})})})})})})})};if(ax.CheckActiveRow()===true){av.call(this)}}}function aq(){m=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var aw=m.GetBusComp("Pharma Professional Call - Mobile");var at=this.GetContext().GetBusComp().GetParentBusComp();var au=m.GetBusComp("Employee");x=SiebelApp.S_App.Model.GetBusObj("Account");var ax=x.GetBusComp("CUT Address - CE");var av=SiebelApp.S_App.Model.GetLovNameVal("Account Call","TODO_TYPE");var ar=SiebelApp.S_App.Model.GetLovNameVal("Professional Call","TODO_TYPE");at.FieldValue("Parent Activity Id");$.callback(this,function(az){var ay=az.retVal;at.FieldValue("Category");$.callback(this,function(aA){var aB=aA.retVal;at.FieldValue("Contact Address Id");$.callback(this,function(aD){var aC=aD.retVal;h.push(at);au.ActivateField("OK to Sample");au.Execute();$.callback(this,function(aE){au.Home();$.callback(this,function(aF){h.push(au);if((aB===ar)&&aC){ax.SetFldSearchSpec("Id",aC)}else{aw.SetSearchExpr("[Parent Activity Id] = '"+ay+"' AND [Category] = '"+av+"'");aw.ActivateField("Contact Address Id");aw.ActivateField("Account Address Id");aw.Execute();$.callback(this,function(aG){aw.Home();$.callback(this,function(aH){if(aw.CheckActiveRow()===true){aw.FieldValue("Contact Address Id");$.callback(this,function(aI){aC=aI.retVal;aw.FieldValue("Account Address Id");$.callback(this,function(aK){var aJ=aK.retVal;if(aC){ax.SetFldSearchSpec("Id",aC)}else{ax.SetFldSearchSpec("Id",aJ)}})})}})})}$.callback(this,function(aG){ax.Execute();$.callback(this,function(aH){ax.Home();$.callback(this,function(aI){h.push(ax)})})})})})})})})}function E(at){var ax=[];var aw=true;ax.push("EMPLOYEE SAMPLING RULE, 1, IsValidEmpToSample, ERROR, 3");ax.push("CONTACT SAMPLING RULE, 1, IsValidProfToSample, ERROR, 3");ax.push("SRE PROFESSIONAL RULE, 1, IsValidSREProfType, ERROR, 3");var av=ax.length;l=false;for(var au=0;au<av;au++){var ar=ax[au];aw=this.ValidateRule(ar);if(!aw){break}}l=true}function aj(ar){var at=false;l=false;aq.call(this);$.callback(this,function(){am();$.callback(this,function(au){at=au.retVal;if(at){Q();$.callback(this,function(av){at=av.retVal;if(at){T();$.callback(this,function(aw){at=aw.retVal;$.setReturnValue({err:false,retVal:at});SiebelApp.S_App.Model.ReleaseBO(m);SiebelApp.S_App.Model.ReleaseBO(x);return})}else{$.setReturnValue({err:false,retVal:at});SiebelApp.S_App.Model.ReleaseBO(m);SiebelApp.S_App.Model.ReleaseBO(x);return}})}else{$.setReturnValue({err:false,retVal:at});SiebelApp.S_App.Model.ReleaseBO(m);SiebelApp.S_App.Model.ReleaseBO(x);return}})});l=true}function O(au){var at;var av=SiebelApp.Metadata.GetUserProperty("Enable Max Samples Per Call Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ap.IsEmpty(av)){$.setReturnValue({err:false,retVal:true});return}var ay=av.split(",");var ar=ay[0];var aw=ay[1];var ax=ay[2];if(aw==="N"){$.setReturnValue({err:false,retVal:true});return}au.FieldValue("Quantity");$.callback(this,function(aA){var az=aA.retVal;au.FieldValue("Max Per Call");$.callback(this,function(aE){var aB=aE.retVal;var aD=parseInt(aB,10);var aC=parseInt(az,10);if((aD>0)&&(aC<=aD)||ap.IsEmpty(aB)){at=true;$.setReturnValue({err:false,retVal:at});return}t.RuleName="MAX PER CALL SUB RULE";t.ErrMsgType=ax;au.FieldValue("Name");$.callback(this,function(aG){var aF=aG.retVal;if(!ap.IsEmpty(av)){$.setReturnValue({err:false,retVal:false});X("SSAPhmaErrMaxQtyPerCallExceeded",aF,aB);return}})})})}function F(au){var at=true;var av=SiebelApp.Metadata.GetUserProperty("Enable Max Samples Per Allocation Period Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ap.IsEmpty(av)){return}var ay=av.split(",");var ar=ay[0];var aw=ay[1];var ax=ay[2];if(aw==="N"){return}au.FieldValue("Sum Qty Alloc");$.callback(this,function(aA){var az=aA.retVal;au.FieldValue("Max Per Allocatio");$.callback(this,function(aE){var aD=aE.retVal;if(ap.IsEmpty(aD)){$.setReturnValue({err:false,retVal:true});return}var aB=aD.valueOf();if((aB>0)&&(az<=aB)||ap.IsEmpty(aD)){at=true;$.setReturnValue({err:false,retVal:at});return}at=false;t.RuleName=ar;t.ErrMsgType=ax;var aC=au.FieldValue("Name");if(!ap.IsEmpty(av)){$.setReturnValue({err:false,retVal:false});X("SSAPhmaErrMaxQtyPerAllocPeriodExceeded",aC,aD);return}})})}function am(){var ar=false;Z("EMPLOYEE");$.callback(this,function(){R();$.callback(this,function(at){ar=at.retVal;if(c||n){if(ar){X("SSAPhmaValidationRulePassed")}else{X("SSAPhmaValdnMsgInValidEmpToSample")}}else{X("SSAPhmaValidationRuleIgnored")}$.setReturnValue({err:false,retVal:ar});return})})}function R(){var ar=ao("Employee");var at;var av=false;var au="OK to Sample";if(ar.CheckActiveRow()===true){ar.FieldValue(au);$.callback(this,function(aw){at=aw.retVal;if((at.toLowerCase()==="y")||(at.toLowerCase()==="true")){av=true}$.setReturnValue({err:false,retVal:av});return})}else{$.setReturnValue({err:false,retVal:av})}}function Q(){var ar=false;Z("CONTACT");$.callback(this,function(){B();$.callback(this,function(at){ar=at.retVal;if(c||n){if(ar){X("SSAPhmaValidationRulePassed")}else{X("SSAPhrmaErrOKToSampleFlgNotSet")}}else{X("SSAPhmaValidationRuleIgnored")}$.setReturnValue({err:false,retVal:ar});return})})}function B(){var ar=ao("Pharma Professional Call - Mobile");var at;var av=false;var au="OK To Sample";ar.FieldValue(au);$.callback(this,function(aw){at=aw.retVal;if((at.toLowerCase()==="y")||(at.toLowerCase()==="true")){av=true}$.setReturnValue({err:false,retVal:av});return})}function A(){var at=false;var ar=false;Z("CONTACT");U();$.callback(this,function(aw){var ax=aw.retVal;if(!ap.IsEmpty(ax)){if((n||c)&&o){var au=ao("Pharma Professional State Licenses");var av=SiebelApp.Metadata.GetUserProperty("License Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));au.FieldValue(av);$.callback(this,function(az){var ay=az.retVal;if(!ap.IsEmpty(ay)){if((new Date(ay).getTime()<new Date().getTime())){ar=true}}else{at=true}if(!at&&!ar){return X("SSAPhmaValidationRulePassed")}else{if(at){return X("SSAPhrmaErrLicFldsNotFilled","License Expiry Date")}else{return X("SSAPhrmaErrLicNumExpDtExpired")}}})}else{return X("SSAPhmaValidationRuleIgnored")}}else{return X("SSAPhrmaErrLicNumExpDtExpired")}})}function al(){var ar=false;var at=false;Z("CONTACT");U();$.callback(this,function(aw){var ax=aw.retVal;if(!ap.IsEmpty(ax)){if((n||c)&&o){var av=ao("Pharma Professional State Licenses");var au=SiebelApp.Metadata.GetUserProperty("License Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));
av.FieldValue(au);$.callback(this,function(az){var ay=az.retVal;if(!ap.IsEmpty(ay)){ar=true}else{at=true}if(!at&&ar){return X("SSAPhmaValidationRulePassed")}else{if(at){return X("SSAPhrmaErrLicFldsNotFilled","License Number")}}})}else{return X("SSAPhmaValidationRuleIgnored")}}else{return X("SSAPhrmaErrLicFldsNotFilled","License Number")}})}function ac(){var av=false;var at=false;var au="";var aw="";Z("CONTACT");var ar=ao("Pharma Professional State Licenses");U();$.callback(this,function(ay){var az=ay.retVal;if(!ap.IsEmpty(az)){var ax=SiebelApp.Metadata.GetUserProperty("License Status Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));ar.FieldValue(ax);$.callback(this,function(aB){var aD=aB.retVal;if(ap.IsEmpty(aD)){av=true}else{au=SiebelApp.S_App.Model.GetLovValName(aD,"STATE_LICENSE_STATUS");aw=SiebelApp.Metadata.GetUserProperty("Valid License Status",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ap.IsEmpty(aw)){if(au==="Active"){at=true}}else{var aC=aw.split(",");for(var aA=0;aA<aC.length;aA++){if(au===aC[aA]){at=true;break}}}}if(av){return X("SSAPhrmaErrLicFldsNotFilled","License Status")}else{if(!at){return X("SSAPhrmaErrLicStatusInactive")}else{if(!av&&at){return X("SSAPhmaValidationRulePassed")}}}})}else{return X("SSAPhrmaErrLicStatusInactive")}})}function z(){var at=false;Z("CONTACT");var ar=ao("Pharma Professional Call - Mobile");ar.FieldValue("Category");$.callback(this,function(aw){var av=aw.retVal;var au=SiebelApp.S_App.Model.GetLovValName(av,"TODO_TYPE");if(c&&s&&au!=="Attendee Call"){ae();$.callback(this,function(ax){at=ax.retVal;if(at){return X("SSAPhmaValidationRulePassed")}else{return X("SSAPhrmaErrDEANumNotValid")}})}else{return X("SSAPhmaValidationRuleIgnored")}})}function ae(){var at=false;var ar=ao("Pharma Address Inter Table - CE");ar.FieldValue("DEA#");$.callback(this,function(aw){var ax=aw.retVal;var aG,aF,aE,aD,aC,aB,aA,az,ay;var aO,aN,aM,aL,aK,aJ,aI,av,au,aH;if(ax.length!==9){$.setReturnValue({err:false,retVal:at});return}aG=ax.charAt(0);aF=ax.charAt(1);aE=ax.charAt(2);aD=ax.charAt(3);aC=ax.charAt(4);aB=ax.charAt(5);aA=ax.charAt(6);az=ax.charAt(7);ay=ax.charAt(8);if((aG===aG.toUpperCase())&&(aF===aF.toUpperCase())){if(isNaN(aE)||isNaN(aD)||isNaN(aC)||isNaN(aB)||isNaN(aA)||isNaN(az)||isNaN(ay)){$.setReturnValue({err:false,retVal:at});return}aO=aE.valueOf();aN=aD.valueOf();aM=aC.valueOf();aL=aB.valueOf();aK=aA.valueOf();aJ=az.valueOf();aI=ay.valueOf();av=parseInt(aO,10)+parseInt(aM,10)+parseInt(aK,10);au=parseInt(aN,10)+parseInt(aL,10)+parseInt(aJ,10);aI=parseInt(aI,10);aH=av+(2*au);if(aH%10===aI){at=true}}$.setReturnValue({err:false,retVal:at});return})}function Y(){var aw=false;var au=false;var av="";var ay="";var ar;var ax;Z("CONTACT");var at=ao("Pharma Professional Call - Mobile");at.FieldValue("Category");$.callback(this,function(aB){var aA=aB.retVal;var az=SiebelApp.S_App.Model.GetLovValName(aA,"TODO_TYPE");if(c&&s&&az!=="Attendee Call"){at=ao("Pharma Address Inter Table - CE");at.FieldValue("DEA Expr");$.callback(this,function(aD){var aC=aD.retVal;if(!ap.IsEmpty(aC)){if((new Date(aC).getTime()<new Date().getTime())){ar=true}}else{ax=true}if(aw){return X("SSAPhrmaErrDEANumFldsNotFilled","DEA Expiry Date")}else{if(ar){return X("SSAPhrmaErrDEANumExpDtExpired")}else{return X("SSAPhmaValidationRulePassed")}}})}else{return X("SSAPhmaValidationRuleIgnored")}})}function S(){Z("PHARMA CALL");var ar=false;var au=false;var av=false;var at=I().ErrMsgType;if(at!=="IGNORE"){var aw=ao("Pharma Call Sample Dropped");if(aw.CheckActiveRow()===true){aw.FieldValue("Sum Qty Alloc");$.callback(this,function(ax){var ay=ax.retVal;aw.SetFieldValue("Calc Sum Qty Alloc",ay);$.callback(this,function(az){aw.FieldValue("Max Per Allocation");$.callback(this,function(aA){ay=aA.retVal;aw.SetFieldValue("Alloc Max Qty Per Period",ay);$.callback(this,function(aB){aw.FieldValue("Max Per Call");$.callback(this,function(aC){ay=aC.retVal;aw.SetFieldValue("Alloc Max Qty Per Call",ay);aw.FieldValue("Quantity");$.callback(this,function(aE){var aD=aE.retVal;if(aD<=0){return}M(aw);$.callback(this,function(aF){au=aF.retVal;ar=!au;if(au){L(aw);$.callback(this,function(aG){au=aG.retVal;ar=!au})}O(aw);$.callback(this,function(aG){au=aG.retVal;ar=!au;F(aw);$.callback(this,function(aH){au=aH.retVal;ar=!au})})})})})})})})})}}}function M(aD){var at=false;var ay=SiebelApp.Metadata.GetUserProperty("Enable Lot Validation Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ap.IsEmpty(ay)){$.setReturnValue({err:false,retVal:true});return}var aC=ay.split(",");var az=aC[0];var ax=aC[1];var aA=aC[2];if(ap.IsEmpty(ay)||ax.toLowerCase()!=="y"){at=true;return}t.RuleName=az;var aG=aD.FieldValue("Name");var aE=aD.FieldValue("Lot Name");var av=aD.FieldValue("Call Date");var ar=aD.FieldValue("Parent Inventory Flag");var aB=aD.FieldValue("Parent Lots Defined Flag");var au=SiebelApp.Metadata.GetUserProperty("Validate Lot# Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var aF=aD.FieldValue("Parent Lots Defined Flag");if(!ap.IsEmpty(aE)){if(new Date(aF).getTime()<new Date().getTime()){t.RuleName="LOT EXPIRY RULE";return X("IDS_LS_PHARMA_EXPIRED_LOT")}}else{if(ap.IsEmpty(aE)&&(aB)){var aw=SiebelApp.S_App.Model.GetSystemPreference("Samples Lots Enabled");var aH=SiebelApp.S_App.Model.GetSystemPreference("Lots For Disperse Only");if(aw.toLowerCase()===true&&aH.toLowerCase()!==true){return X("IDS_LS_PHARMA_LOT_NUMBER_REQ","Lot #")}}}at=true;return at}function L(az){var ar=false;var aw=SiebelApp.Metadata.GetUserProperty("Enable Lot Cutoff Validation Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(ap.IsEmpty(aw)){$.setReturnValue({err:false,retVal:true});return}var aC=aw.split(",");var au=aC[0];var av=aC[1];var ax=aC[2];if(ap.IsEmpty(aw)||av.toLowerCase!=="y"){ar=true;return}t.RuleName=au;var at=new Date();var aA=az.FieldValue("Lot Name");if(!ap.IsEmpty(aA)){var ay=az.FieldValue("Cutoff Date");var aB=az.FieldValue("Name");if(!ap.IsEmpty(ay)&&(new Date(ay).getTime()<new Date().getTime())){return X("SSAPhmaValdnMsgLotCutOff",aB)}}ar=true}function ai(){var av=["Last Name","Contact First Name","Address","Title"];var aw;var ar=0;Z("CONTACT");if(c||n){var at=ao("Pharma Professional Call - Mobile");var au=function(){at.FieldValue(av[ar]);$.callback(this,function(ax){aw=ax.retVal;if(ap.IsEmpty(aw)){if(av[ar]==="Title"){aa(at);$.callback(this,function(ay){aw=ay.retVal;if(ap.IsEmpty(aw)){return X("SSAPhrmaErrProfProfileNotFilled",av[ar])}else{return X("SSAPhmaValidationRulePassed")}})}else{return X("SSAPhrmaErrProfProfileNotFilled",av[ar])}}else{if(ar<3){ar++;au.call(this)}else{return X("SSAPhmaValidationRulePassed")}}})};if(at.CheckActiveRow()===true){au.call(this)}}else{return X("SSAPhmaValidationRuleIgnored")}}function ah(){Z("PHARMA CALL");var ar=false;ar=N("Pharma Call Sample Dropped");if(ar){return X("SSAPhmaValidationRulePassed")}else{return X("SSAPhmaErrSampDropSign")}}function aa(ar){var at=ao("Contact");
if(at.CheckActiveRow()===true){at.FieldValue("M/M");$.callback(this,function(av){var au=av.retVal;$.setReturnValue({err:false,retVal:au});return})}}return H}());return"SiebelAppFacade.PharmaCallValidatorsvc"})};