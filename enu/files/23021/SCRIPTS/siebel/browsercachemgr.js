if(typeof(SiebelApp.BrowserCacheMgr)==="undefined"){Namespace("SiebelApp.BrowserCacheMgr");SiebelApp.BrowserCacheMgr=(function(){var c=new e();var b=SiebelApp.OfflineCacheConfig;var a=SiebelApp.Offlineconstants;var d=SiebelJS.Dependency("SiebelApp.Utils");var f=SiebelJS.Dependency("SiebelApp.Constants");var g=[];function e(){var j;var h;var k;var i;l=function l(){h=JSON.parse(window.localStorage.getItem("ViewTagInfo"));if(SiebelApp.OfflineAppSettings.GetMode()===true){var m=JSON.parse(window.localStorage.getItem("StringCache"));if(m){SiebelApp.S_App.SetStringCache(m)}}if(!(window.localStorage.getItem("ResetApp"))){window.localStorage.setItem("ResetApp","false")}return j};l.prototype=this;j=new l();j.constructor=l;i=SiebelApp.OfflineUtils.GetBrowserStorage();if(i.Initialize){i.Initialize(SiebelApp.OfflineUtils.GetOfflineCacheConfig())}this.GetBrowserStorage=function(){return i};this.SetViewTagInfo=function(){SiebelApp.BrowserLocalStorage.SelectAll("ViewTagInfo",function(m){h=m})};this.GetViewTagInfo=function(m){return h};this.SetParentTagInfo=function(){SiebelApp.BrowserLocalStorage.SelectAll("ParentTag",function(m){k=m})};this.GetParentTagInfo=function(m){return k};return j}e.prototype.ResetApp=function(h){window.localStorage.setItem("ResetApp",h)};e.prototype.IsResetApp=function(){return(window.localStorage.getItem("ResetApp"))};e.prototype.ResetSyncRecordObject=function(){g=[]};e.prototype.CacheOnlineOp=function(i){var k=SiebelApp.OfflineAppMgr.GetCacheType();if(k!=="Reactive"){return}var j=this.GetBrowserStorage();var h=b.get("REACTIVE_CACHE_TBL_COLS");j.SelectRecord(b.get("REACTIVE_CACHE_TBL"),[h.Request],[i.url],function(l){if(!l){j.InsertRecord(b.get("REACTIVE_CACHE_TBL"),[h.Request,h.Response,h.Status,h.StatusText,h.ResponseHeaders],[i.url,i.response,i.status,i.statusText,i.responseHeaders])}})};e.prototype.CacheOfflineOp=function(o){var q=SiebelApp.OfflineAppMgr.GetCacheType();var p=this.GetBrowserStorage();var r=SiebelApp.SyncMgr.BuildRequest(o.request);var s;var t;if(q==="Proactive"){SiebelApp.OfflineAppSettings.SetSyncStatus(true);var m=SiebelApp.RequestProcessor.GetRequestType(o.request);var l=b.get("PRO_SYNCQUEUE_DB_TBL_COLS");switch(m){case a.get("WRITERECORD"):s=SiebelApp.OfflineDataMgr.JsonRecordSet(o.request);var i=o.async;var h=(SiebelApp.OfflineDataMgr.GetRecordParam()).AppletName;var j=d.UrlDecode(s.SweCommands.SWEActiveApplet);if((j===h)&&(!i)){SiebelApp.OfflineAppMgr.SetWriteDone(true)}syncRecordLen=g.length;if(syncRecordLen>0){t=[];t.push(r.txnid);t.push(r.request);g.push(t);p.InsertRecordSet(b.get("PRO_SYNCQUEUE_DB_TBL"),[l.TransactionId,l.Request],g,function(){SiebelApp.OfflineDataMgr.UpdateDataStore(s,o.request,o.callback,o.async);g=[]})}else{p.InsertRecord(b.get("PRO_SYNCQUEUE_DB_TBL"),[l.TransactionId,l.Request,l.SyncStatus],[r.txnid,r.request,""],function(){SiebelApp.OfflineDataMgr.UpdateDataStore(s,o.request,o.callback,o.async);g=[]})}SiebelApp.S_App.CustomToolbar.Update();break;case a.get("DELETERECORD"):s=SiebelApp.OfflineDataMgr.JsonRecordSet(o.request);p.InsertRecord(b.get("PRO_SYNCQUEUE_DB_TBL"),[l.TransactionId,l.Request,l.SyncStatus],[r.txnid,r.request,""],function(){SiebelApp.OfflineDataMgr.DeleteDataStoreRec(s)});SiebelApp.S_App.CustomToolbar.Update();break;case a.get("ADDRECORD"):syncRecordLen=g.length;if(syncRecordLen>0){t=[];t.push(r.txnid);t.push(r.request);g.push(t);p.InsertRecordSet(b.get("PRO_SYNCQUEUE_DB_TBL"),[l.TransactionId,l.Request],g,function(){SiebelApp.OfflineDataMgr.SetNewRecordCommit(false)})}else{p.InsertRecord(b.get("PRO_SYNCQUEUE_DB_TBL"),[l.TransactionId,l.Request,l.SyncStatus],[r.txnid,r.request,""],function(){SiebelApp.OfflineDataMgr.SetNewRecordCommit(false)})}g=[];SiebelApp.S_App.CustomToolbar.Update();break;default:t=[];t.push(r.txnid);t.push(r.request);g.push(t);break}}else{var n=b.get("PRO_SYNCQUEUE_DB_TBL_COLS");var k=SiebelApp.OfflineDataMgr.InsertJsonRecord(o.request);p.InsertRecord(b.get("PRO_SYNCQUEUE_DB_TBL"),[n.Request,n.SyncStatus],[k,""])}};e.prototype.GetCachedResponse=function(l,o,j){var n=SiebelApp.OfflineAppMgr.GetCacheType();if((n==="Proactive")){var h=SiebelApp.RequestProcessor.GetRequestType(l);if(h){SiebelApp.BrowserCacheMgr.GetPCachedResponse(l,h,o,j)}else{o(null)}}else{var k=this.GetBrowserStorage();var i=b.get("REACTIVE_CACHE_TBL_COLS");if(SiebelApp.RequestProcessor.IsCUDRequest(l)){var m=a.get("CUD_RESPONSE");o(m)}else{k.SelectRecord(b.get("REACTIVE_CACHE_TBL"),[i.Request],[l],o)}}};e.prototype.GetItemsToSync=function(j,k){var i=this.GetBrowserStorage();var h="";if(SiebelApp.OfflineAppMgr.GetCacheType()==="Proactive"){h=b.get("PRO_SYNCQUEUE_DB_TBL");i.SelectFilterRecord(h,"RecordNum","TransactionId",j,k)}else{h=b.get("PRO_SYNCQUEUE_DB_TBL");i.SelectAll(h,k)}};e.prototype.Delete=function(i,k,j){var h=this.GetBrowserStorage();if(SiebelApp.OfflineAppMgr.GetCacheType()==="Proactive"){i=b.get("PRO_SYNCQUEUE_DB_TBL");h.DeleteFilterRecord(i,"RecordNum",k,j)}else{i=b.get("PRO_SYNCQUEUE_DB_TBL");h.DeleteRecord(i,k,j)}SiebelApp.OfflineDataMgr.DeleteJsonRecord(j)};e.prototype.DBInitialize=function(j){var h=this.GetBrowserStorage();var i=function(){if(h.Initialize){switch(j){case b.get("PRO_DATASTORE_DB"):h.Initialize(SiebelApp.OfflineUtils.GetOfflineCacheConfig(b.get("PRO_DATASTORE_DB")));break;case b.get("PRO_METADATASTORE_DB"):h.Initialize(SiebelApp.OfflineUtils.GetOfflineCacheConfig(b.get("PRO_METADATASTORE_DB")));break;case b.get("PRO_SYNCQUEUE_DB"):h.Initialize(SiebelApp.OfflineUtils.GetOfflineCacheConfig(b.get("PRO_SYNCQUEUE_DB")));break;default:h.Initialize(SiebelApp.OfflineUtils.GetOfflineCacheConfig(b.get("")));break}}return h};return i()};e.prototype.GetPCachedResponse=function(n,w,o,p){var y=this.GetBrowserStorage();var z="";var i=[];var j=[];var r="";var m=[];var l="";var s;var q;var u=d.DecodeFromQueryString(n);var k=SiebelApp.OfflineDataMgr.GetRecordParam();switch(w){case (a.get("GOTOVIEW")):case (a.get("GETVIEWLAYOUT")):l=a.get("VIEW_INFO");r=unescape(u.GetProperty("SWEView"));SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break;case (a.get("NEWRECORD")):case (a.get("EDITRECORD")):l=a.get("NEW_VIEW_INFO");s=unescape(u.GetProperty("SWEView"));q=unescape(u.GetProperty("SWEActiveApplet"));if(!q){q=unescape(u.GetProperty("SWEApplet"))}r=s.concat("/",q);SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break;case (a.get("NEWLAYOUT")):l=a.get("NEW_VIEW_INFO");s=k.ViewName;q=k.AppletName;r=s.concat("/",q);w=a.get("GETVIEWLAYOUT");SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break;case (a.get("GETCACHEDFRAME")):var A=SiebelApp.RequestProcessor.GetPrevReqObj();if(A.reqType===a.get("EDIT_FIELD")){l=a.get("PICK_APLT_INFO");r=A.searchVal;SiebelApp.RequestProcessor.SetPrevReqObj({});SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break}else{var v=u.GetProperty(f.get("SWE_RPC_PROP_RETURN_STATUS"));if(v&&v.toString()===f.get("SWE_RPC_PROP_NEW_POPUP")){var x=SiebelApp.S_App.GetActiveView().GetActiveApplet();if(x){var h=x.GetActiveControl();if(!h||(h&&h.GetUIType()!=="Pick")){SiebelApp.OfflineDataMgr.SetRecordParam(false);
SiebelApp.OfflineAppMgr.SetWriteDone(true);l=a.get("NEW_VIEW_INFO");s=k.ViewName;q=k.AppletName;r=s.concat("/",q);SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break}}}}case (a.get("GOTOPOSTEDACTION")):l=a.get("DEFAULT_VIEW_INFO");r=unescape(u.GetProperty("SWEFrame"));SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break;case (a.get("TEXT")):l=a.get("DEFAULT_VIEW_INFO");r="scriptfiles";SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break;case (a.get("WRITERECORD")):var t=unescape(u.GetProperty("SWEActiveApplet"));q=(SiebelApp.OfflineDataMgr.GetRecordParam()).AppletName;l=a.get("VIEW_INFO");r=unescape(u.GetProperty("SWEView"));w=a.get("GOTOVIEW");SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break;case (a.get("UNDORECORD")):g=[];l=a.get("VIEW_INFO");r=unescape(u.GetProperty("SWEView"));w=a.get("GOTOVIEW");SiebelApp.OfflineDataMgr.SetNewRecordCommit(false);SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break;case (a.get("EDIT_FIELD")):s=SiebelApp.S_App.GetActiveView();q=s.GetActiveApplet();var h=q.GetActiveControl();if(h.GetUIType()==="Pick"){SiebelApp.BrowserCacheMgr.GetPickAppletInfo(s.GetName(),q.GetName(),h.GetName(),function(B){l=a.get("PICK_APLT_INFO");r=B.PickApplet;SiebelApp.RequestProcessor.SetPrevReqObj({reqType:w,searchVal:B.PickApplet});SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l)})}break;case (a.get("CREATERECORD")):l=a.get("NEW_VIEW_INFO");s=unescape(u.GetProperty("SWEView"));q=unescape(u.GetProperty("SWEActiveApplet"));if(!q){q=unescape(u.GetProperty("SWEApplet"))}r=s.concat("/",q);SiebelApp.BrowserCacheMgr.GetPCachedResponseExt(n,o,w,r,l);break;case (a.get("DELETERECORD")):break;case (a.get("DRILLDOWN")):break}};e.prototype.GetPCachedResponseExt=function(i,q,n,k,m){var p=SiebelApp.RequestProcessor.GetCmdTag(n);var l=SiebelApp.BrowserCacheMgr.DBInitialize(b.get("PRO_METADATASTORE_DB"));var r=b.get("PRO_METADATASTORE_DB_TBL");var j=b.get("PRO_METADATASTORE_DB_TBL_COLS");var h=[j.ObjName,j.SweCmd,j.Type];var o=[k,p,m];SiebelApp.OfflineUtils.Log("Getting Cached Response:");SiebelApp.OfflineUtils.Log("request -> "+i);SiebelApp.OfflineUtils.Log("table -> "+r);SiebelApp.OfflineUtils.Log("columns -> "+JSON.stringify(h));SiebelApp.OfflineUtils.Log("values -> "+JSON.stringify(o));l.SelectRecord(r,h,o,q)};e.prototype.CreateTable=function(j,h){var i=this.GetBrowserStorage();i.CreateTable(j,h)};e.prototype.InsertRecord=function(k,i,h,l){var j=this.GetBrowserStorage();j.InsertRecord(k,i,h,l)};e.prototype.InsertRecordSet=function(k,h,i,l){var j=this.GetBrowserStorage();j.InsertRecordSet(k,h,i,l)};e.prototype.Execute=function(i,k,j){var h=this.GetBrowserStorage();h.Execute(i,k,j)};e.prototype.SelectRecordSet=function(l,i,j,h,m){var k=this.GetBrowserStorage();k.SelectRecordSet(l,i,j,h,m)};e.prototype.DoesTableExist=function(i){var h=this.GetBrowserStorage();return(h.DoesTableExist(i))};e.prototype.DoesFieldExist=function(i,j){var h=this.GetBrowserStorage();return(h.DoesFieldExist(i,j))};e.prototype.CacheSCMap=function(i){if(window.localStorage.getItem(a.get("STRING_CACHE"))===null){var h=[];SiebelApp.S_App.SetStringCache(h);SiebelApp.S_App.AppendToStrCache(i);h=SiebelApp.S_App.GetStringCache();window.localStorage.setItem(a.get("STRING_CACHE"),JSON.stringify(h))}};e.prototype.UpdateRecord=function(p,l,k,h,q,j,i,n,o){var m=this.GetBrowserStorage();m.UpdateRecord(p,l,k,h,q,o,j,i,n)};e.prototype.DeleteRecord=function(k,i,h){var j=this.GetBrowserStorage();j.DeleteRecord(k,i,h)};e.prototype.SelectRecord=function(k,i,h,l){var j=this.GetBrowserStorage();j.SelectRecord(k,i,h,l)};e.prototype.UpdateSyncQueue=function(j,i,n,k,o){var m=b.get("PRO_SYNCQUEUE_DB_TBL");var l=this.GetBrowserStorage();var h=k;l.UpdateRecord(m,["SyncStatus"],j,i,n,function(){o(h)})};e.prototype.GetInitPkg=function(j){var i=b.get("REACTIVE_CACHE_TBL");var h=this.GetBrowserStorage();h.SelectAll(i,j)};e.prototype.InsertInitPkgRecords=function(k,j,i,h){var l=b.get("PRO_METADATASTORE_DB_TBL_COLS");SiebelApp.BrowserCacheMgr.InsertRecord(b.get("PRO_METADATASTORE_DB_TBL"),[l.ObjName,l.SweCmd,l.Response,l.Type],[k,j,i,h])};e.prototype.DeleteTable=function(i){var h=this.GetBrowserStorage();h.DeleteTable(i)};e.prototype.GetTag=function(m,l){var h="";var j=l.length;for(var k=0;k<j;k++){if(l[k][a.get("TAG_NAME")]===m){h=l[k][a.get("TAG")];break}}return h};e.prototype.GetRawRecordSet=function(s,q,A,j,w,o){var z=this.GetBrowserStorage();var m=[];var r=[];var y=j;var k=SiebelApp.OfflineDataMgr.GetRecordParam();SiebelApp.OfflineUtils.Log("Processing request for data from "+A+" table");A=SiebelApp.OfflineUtils.RemoveNonAlphaChars(A);var u=y.length;for(var x=0;x<u;x++){r.push(SiebelApp.OfflineUtils.RemoveNonAlphaChars(y[x]))}var B=this.GetTag(q,this.GetViewTagInfo());var h=B;if(s){h=this.GetTag(s,this.GetViewTagInfo());h=h+"."+B;if(k.State===a.get("NEW")){if(k.BC===A){var n=[];var p={Id:(k.RowId)};n.push(p);m=SiebelApp.BrowserCacheMgr.PrepareOfflineRawRecord(n,r,m)}}}y=["OF_New"];var v=["Y"];var t=[];if(w&&w.length){y.push(a.get("COL_PARENT_TAG"));v.push(w);t.push(a.get("COL_PARENT_TAG"))}z.SelectRecordSet(A,y,v,t,function(i){if(i&&i.length){m=SiebelApp.BrowserCacheMgr.PrepareOfflineRawRecord(i,r,m)}v[0]="null";y.push(a.get("COL_VIEW_TAG"));v.push(h);t.push(a.get("COL_VIEW_TAG"));z.SelectRecordSet(A,y,v,t,function(C){if(C){m=SiebelApp.BrowserCacheMgr.PrepareOfflineRawRecord(C,r,m)}SiebelApp.OfflineUtils.Log("Processing request for data from "+A+" table ....is Done");if(k.State){var E;if(k.State===a.get("NEW")){if(s){SiebelApp.OfflineDataMgr.GetRecordObj().Id=m[0].id}}else{if(m.length>0){if(w){E=SiebelApp.OfflineAppMgr.GetAppContext().RowChildNum?SiebelApp.OfflineAppMgr.GetAppContext().RowChildNum:0}else{E=SiebelApp.OfflineAppMgr.GetAppContext().RowNum?SiebelApp.OfflineAppMgr.GetAppContext().RowNum:0}SiebelApp.OfflineDataMgr.GetRecordObj().Id=m[E].id}else{o(m)}}}if(k.State===a.get("NEW")&&m.length!==0){var F=0;if(w===null){if(SiebelApp.OfflineAppMgr.GetAppContext().nBC===1){F=SiebelApp.OfflineAppMgr.GetAppContext().RowNum?SiebelApp.OfflineAppMgr.GetAppContext().RowNum:0}}else{F=SiebelApp.OfflineAppMgr.GetAppContext().RowChildNum?SiebelApp.OfflineAppMgr.GetAppContext().RowChildNum:0}var l=m[0];for(var D=0;D<F;D++){m[D]=m[D+1]}m[D]=l}o(m)})})};e.prototype.PrepareOfflineRawRecord=function(t,q,h){var u={};var n=t.length;var r=q.length;var p="";var o={};for(var l=0;l<n;l++){for(var j=0;j<r;j++){var i="";var s=0;if(q[j]&&t[l][q[j]]&&t[l][q[j]]!=="undefined"&&t[l][q[j]]!==null&&t[l][q[j]]!=="null"){i=t[l][q[j]];s=t[l][q[j]].length}if(p.length){p=p+s+"*"+i}else{p=s+"*"+i}if(q[j]==="Id"){o.id=t[l][q[j]]}}o.value=p;h.push(o);p="";o={}}return h};e.prototype.CacheSyncNodeId=function(h){if(window.localStorage.getItem(f.get("SYNC_NODE_ID"))===null){window.localStorage.setItem(f.get("SYNC_NODE_ID"),h)}};e.prototype.CacheSRFId=function(h){if(window.localStorage.getItem(a.get("SRF_ID"))===null){window.localStorage.setItem(a.get("SRF_ID"),h)}};e.prototype.CacheViewList=function(h){window.localStorage.setItem(a.get("VIEW_LIST"),JSON.stringify(h))
};e.prototype.GetPickFldDetails=function(h,o,i,l,n){var j=this.GetBrowserStorage();var m=b.get("PRO_DB_PICKFLD_MAP_TBL_COLS");var k={};j.SelectRecord(b.get("PRO_DB_PICKFLD_MAP_TBL"),[m.BCName,m.FldName],[h,o],function(p){k.PickMap=p;j.SelectRecord(SiebelApp.OfflineUtils.RemoveNonAlphaChars(i),["Id"],[l],function(q){k.PickRecord=q;n(k)})})};e.prototype.UpdateParentIdTag=function(j,h,i,l){var k=this.GetBrowserStorage();j=SiebelApp.OfflineUtils.RemoveNonAlphaChars(j);k.UpdateRecordSet(j,a.get("COL_PARENT_TAG"),i,"Id",h,function(){l()})};e.prototype.GetPickListInfo=function(h,l){var j=this.GetBrowserStorage();var k=b.get("PRO_DB_PICKLIST_INFO_TBL_COLS");var i;i=SiebelApp.BrowserLocalStorage.SelectRecord(b.get("PRO_DB_PICKLIST_INFO_TBL"),[k.NAME],[h],function(m){SiebelApp.BrowserCacheMgr.GetPickListData(m.LOVType,function(n){if(!n){alert("Unable to find Pick List Data for field '"+activeField+"' in BC 'PickListGeneric'")}else{l(n)}})})};e.prototype.GetPickListData=function(i,l){var j=this.GetBrowserStorage();var k=b.get("PRO_DB_PICKLIST_GENERIC_TBL_COLS");var h;h=SiebelApp.BrowserLocalStorage.SelectRecordSet(b.get("PRO_DB_PICKLIST_GENERIC_TBL"),[k.Type],[i],"",function(m){if(m){var q=m;var s;var p=[];var r;var n=0;for(var o=0;o<q.length;o++){s=q[o];if(s.Type){p.push(s.Value)}}l(p)}})};e.prototype.GetPickAppletInfo=function(m,i,h,n){var k=this.GetBrowserStorage();var l=b.get("PRO_DB_PICKAPPLET_INFO_TBL_COLS");var j=m+"."+i+"|"+h;k.SelectRecord(b.get("PRO_DB_PICKAPPLET_INFO_TBL"),[l.FldInfo],[j],function(o){if(o){n(o)}})};e.prototype.GetViewList=function(){var h=window.localStorage.getItem(a.get("VIEW_LIST"));if(h!==null){h=JSON.parse(h)}return h};e.prototype.AddPickRowID=function(i,j,k){var h=this.GetBrowserStorage();h.SelectRecord(i,["Id"],[j],function(l){k(l)})};e.prototype.GetSyncNodeId=function(){var h=window.localStorage.getItem(f.get("SYNC_NODE_ID"));if(h===null){h=""}return h};e.prototype.CheckContext=function(k){var l=false;var j=SiebelApp.OfflineAppMgr.GetAppContext();if((j.activeBO!==undefined)&&(j.prevBO!==undefined)&&(j.activeBO!==null)&&(j.prevBO!==null)){if(((j.activeBO!==j.prevBO))&&(j.ReqType!==a.get("EDITRECORD"))){j.RowId="";j.RowNum=0;j.RowChildNum=0}}if(j.activeBO===j.prevBO){if(((j.ReqType===a.get("EDITRECORD"))||(j.ReqType===a.get("NEWRECORD"))||(j.ReqType===a.get("UNDORECORD")))||(j.RowId!=="")){for(var i=0;i<j.prevBC.length;i++){k=SiebelApp.OfflineUtils.RemoveNonAlphaChars(k);var h=SiebelApp.OfflineUtils.RemoveNonAlphaChars(j.prevBC[i].Name);if(h===k&&(j.prevBC[i].ParentBC===undefined)){l=true}}}}return l};return c}())};