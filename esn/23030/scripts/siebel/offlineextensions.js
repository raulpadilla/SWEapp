if(typeof(SiebelApp.OfflineExtensions)==="undefined"){Namespace("SiebelApp.OfflineExtensions");SiebelApp.OfflineExtensions=(function(){var i=SiebelJS.Dependency("SiebelApp.Constants");SiebelApp.S_App.constructor.prototype.OfflineCallMethod=function(){if(IsOfflineModeEnabled()){k.call(this,arguments)}};function k(n){var m=n[0];switch(m){case"SetNewRecord":f.call(this,n);break;case"CanUpdate":j.call(this,n);break;case"HandleRowSelect":b.call(this,n);break;case"SetSRN":g.call(this,n);break;case"GetSRN":h.call(this,n);break;case"PassOldValue":a.call(this,n);break;case"ProcessAppletSelfProps":c.call(this,n);break;case"AddFieldName":e.call(this,n);break;case"ReplaceShortURL":d.call(this,n);break;case"AppletCanInvokeMethod":if(SiebelApp.OfflineAppSettings.GetMode()===true){var l=n[2];l.GetCanInvokeByName()[n[1]].bCanInvoke=true}break;default:break}}function c(n){if(SiebelApp.OfflineAppSettings.GetMode()===true){var m=n[1];var l=m.GetView();var o=l?l.GetActiveApplet():null;if(o){var p=o.GetActiveControl();if(p&&p.GetUIType()==="Pick"){var q={};q.SrcApplet=o.GetName();q.SrcAppletFld=p.GetFieldName();m.GetPickAppletSrcInfo=function(){return q}}}}}function f(t){var o=t[1];var p=t[2];if(SiebelApp.OfflineAppSettings.GetMode()===true){if((SiebelApp.OfflineDataMgr.GetRecordParam()).State===i.get("SWE_PST_APPLET_MODE_NEW")){var r=(SiebelApp.OfflineDataMgr.GetRecordParam()).RowId;p.SetProperty(i.get("SWE_ROW_ID_STR"),r)}}if(SiebelApp.OfflineAppSettings.GetMode()===true||(!navigator.onLine&&SiebelApp.OfflineAppMgr.GetCacheType()==="Reactive")){var u="";var s=o.GetBusComp().GetName();var m=o.GetView().GetBusObj().GetName();if(SiebelApp.OfflineDataMgr.IsNewRecord()){var x=o.GetView().GetAppletMap();var l=Object.keys(x);var w=l.length;for(var q=0;q<w;q++){var v=x[l[q]].GetBusComp().GetName();if(v===s){u=u.concat(l[q],"/")}}}p=SiebelApp.SyncMgr.AddParam(p,s,m,u)}}function e(s){if(SiebelApp.OfflineAppSettings.GetMode()===true||(!navigator.onLine&&SiebelApp.OfflineAppMgr.GetCacheType()==="Reactive")){var p="OF_";var n=s[1];var o=s[2];var l=s[3];var m=s[4];var t=n.GetControls();var q=t[l];var r=q.GetFieldName();if((n.IsInQueryMode())||(q.GetCtrlFldEncode())){o.SetProperty(p+r,m)}else{o.SetProperty(p+r,n.GetFieldValue(q))}}}function j(l){if(SiebelApp.OfflineAppSettings.GetMode()===true){if((SiebelApp.OfflineDataMgr.GetRecordParam()).State){return true}}}function b(l){if(SiebelApp.OfflineAppSettings.GetMode()===true){SiebelApp.OfflineNotificationHandler.SetRowNum(l[1])}}function g(l){if(navigator.onLine){if(!utils.IsEmpty(SiebelApp.S_App.GetSRN())){var m=SiebelApp.S_App.GetSRN();window.localStorage.setItem("SRN",m)}SiebelApp.BrowserCacheMgr.ResetApp("false")}}function h(m){var l=m[1];var n=i.get("SWE_PROP_SESSION_RANDOM_NUMBER");if(SiebelApp.OfflineAppSettings.GetMode()===true){l.SetProperty(n,window.localStorage.getItem(n))}}function a(r){if(SiebelApp.OfflineAppSettings.GetMode()===true||(!navigator.onLine&&SiebelApp.OfflineAppMgr.GetCacheType()==="Reactive")){var n=r[1];var m=r[2];var p=m.GetFieldName();var q=r[4];if(n.GetBusComp().GetField(p)){var t=n.GetBusComp().GetField(p).GetDataType();var l=t;var s=q;var o=m.GetDisplayFormat();q=SiebelApp.S_App.LocaleObject.FormattedToString(l,s,o)}SiebelApp.SyncMgr.PassOldValue(p,q,r[3])}}function d(n){var m=window.applicationCache;if(m.status!==1||(SiebelApp.OfflineAppSettings.GetMode()===true)){var p=n[1];var l=n[2];var o="start.swe";History.pushState(null,null,o)}}}())}if(typeof(SiebelApp.AjaxRequestMgr)){(function(){SiebelApp.AjaxRequestMgr.constructor.prototype.IsToolbarRequest=function(a){if(IsOfflineModeEnabled()&&(a.search("SWECmd=Go+")!==-1)&&(a.search("Offline")!==-1)){SiebelApp.OfflineAppSettings.OnGoOfflineClick();return true}if(a.search("SWECmd=SynchronizeOfflineData")!==-1){return true}if(a.search("SWECmd=GetLastTxn")!==-1){return true}return false};SiebelApp.AjaxRequestMgr.constructor.prototype.ProcessToolbarResponse=function(d){var c;if(this.data){c=this.data}else{if(this.url){c=this.url}}if(!c){return}if((IsOfflineModeEnabled()&&c.search("SWECmd=SynchronizeOfflineData")!==-1)){SiebelApp.SyncMgr.ProcessAck(d)}if(IsOfflineModeEnabled()&&(c.search("SWECmd=Go+")!==-1)&&(c.search("Offline")!==-1)){var f=CCFMiscUtil_CreatePropSet();f.DecodeFromString(d);var b=f.GetChildCount();if(f.GetType()!=="offpkg"){SiebelJS.Log("Failed to get Offline Package from Server. Please verify Offline repository configuration.");alert("Failed to get Offline Package from Server. Please verify Offline repository configuration.");SiebelApp.OfflineAppMgr.ClearTimeout();SiebelApp.S_App.uiStatus.Free();return}var a=f.GetProperty("Status");if(a==="Error"||(!b&&f.GetValue()!=="nochng")){SiebelJS.Log("Failed to Get MetaData from Server");alert("Failed to Get MetaData from Server");SiebelApp.OfflineAppMgr.ClearTimeout();SiebelApp.S_App.uiStatus.Free();return}if(f.GetValue()==="new"){SiebelApp.SyncMgr.LoadOfflinePackage(f,false)}SiebelApp.SyncMgr.GetOFDataPkg()}else{if(IsOfflineModeEnabled()&&(c.search("SWECmd=GetLastTxn")!==-1)){var e=c;SiebelApp.SyncMgr.ProcessLastTxn(e,d)}}if(IsOfflineModeEnabled()&&c.search("SWECmd=GetOfflineData")!==-1){SiebelJS.Log("Received Offline Data Package. "+SiebelApp.OfflineUtils.GetTS());SiebelApp.SyncMgr.LoadOfflinePackage(d,true);SiebelApp.OfflineAppSettings.SetMode((!SiebelApp.OfflineAppSettings.GetMode()));SiebelApp.OfflineAppSettings.SetData(true)}};SiebelApp.AjaxRequestMgr.constructor.prototype.SetSrvrReqInputProp=function(e,j,f,h){var d=e;if(!utils.IsEmpty(e)&&!utils.IsEmpty(j)&&f){var b=f.length;var g=j.length;if(b===g){var a=utils.DecodeFromQueryString(e);for(var c=0;c<g;c++){var i=a.GetProperty(j[c]);if(utils.IsEmpty(i)||i!==f[c]){a.SetProperty(j[c],f[c])}}d=utils.EncodeToQueryString(a,false);d=SiebelApp.S_App.GetPageURL()+consts.get("SWE_ARG_START")+d}}return d};SiebelApp.AjaxRequestMgr.constructor.prototype.Get=function(a,c){var b={};b.url=a;b.type="GET";b.async=true;if(SiebelApp.AjaxRequestMgr.IsToolbarRequest(a)){if(!IsOfflineModeEnabled()){SiebelApp.S_App.uiStatus.Free();return}b.url=SiebelApp.AjaxRequestMgr.SetSrvrReqInputProp(a,[consts.get("SYNC_NODE_ID")],[SiebelApp.BrowserCacheMgr.GetSyncNodeId()]);b.successfncallback=SiebelApp.AjaxRequestMgr.ProcessToolbarResponse}else{b.successfncallback=c}if(IsOfflineModeEnabled()&&(SiebelApp.OfflineAppSettings.GetData()===true)&&((a.search("SWECmd=Go+")!==-1)&&(a.search("Offline")!==-1))){SiebelApp.OfflineAppSettings.SetData(false);SiebelApp.S_App.uiStatus.Free();return}else{SiebelApp.AjaxRequestMgr.Ajax(b)}};SiebelApp.AjaxRequestMgr.constructor.prototype.Post=function(c,f){var e={};if(SiebelApp.AjaxRequestMgr.IsToolbarRequest(c)){if(!IsOfflineModeEnabled()){SiebelApp.S_App.uiStatus.Free();return}e.url=SiebelApp.AjaxRequestMgr.SetSrvrReqInputProp(c,[consts.get("SYNC_NODE_ID")],[SiebelApp.BrowserCacheMgr.GetSyncNodeId()]);var b=c.indexOf("?");var d=c.substring(0,b);var a=c.substring(b+1,c.length);e.url=d;e.data=a;e.type="POST";e.async=false;e.contentType="application/x-www-form-urlencoded";
e.successfncallback=SiebelApp.AjaxRequestMgr.ProcessToolbarResponse}else{e.successfncallback=f}if(IsOfflineModeEnabled()&&(SiebelApp.OfflineAppSettings.GetData()===true)&&((c.search("SWECmd=Go+")!==-1)&&(c.search("Offline")!==-1))){SiebelApp.OfflineAppSettings.SetData(false);SiebelApp.S_App.uiStatus.Free();return}else{SiebelApp.AjaxRequestMgr.Ajax(e)}};SiebelApp.AjaxRequestMgr.constructor.prototype.Ajax=function(c,b){var a=c.url;if(c.data){a+="?"+c.data}if(IsOfflineModeEnabled()&&SiebelApp.OfflineAppSettings.CheckOfflineMode()&&(b!==false)&&(SiebelApp.OfflineAppMgr.IsCachableRequest(a))&&((SiebelApp.OfflineAppSettings.GetMode()===false)||((SiebelApp.OfflineAppSettings.GetMode()===true)&&((a.search("SWECmd=SynchronizeOfflineData")!==-1)||utils.IsTrue(SiebelApp.BrowserCacheMgr.IsResetApp())||a.search("SWECmd=GetLastTxn")!==-1)))){$.ajaxSetup({cache:"true"});$.ajax({url:c.url,data:c.data,type:c.type,async:c.async,contentType:c.contentType,success:function(f,g,e){var d=[];d.push(f);d.push(g);d.push(e);if(SiebelApp.OfflineUtils.IsValidServerResponse(f)){SiebelApp.OfflineAppMgr.CacheResponse(a,d);c.successfncallback.apply(c.context||this,d)}else{SiebelJS.Log("Received Invalid Server Response for request: "+a);SiebelJS.Log("Invalid Server Response: "+f);SiebelJS.Log("Connection to server is possibly lost. Requesting Offline App Mgr to handle request...");SiebelApp.OfflineAppMgr.OfflineRequestHandler(a,c,true)}},error:c.errfncb,complete:function(d,f,e){if(f==="error"){SiebelApp.OfflineAppMgr.OfflineRequestHandler(a,c)}}})}else{if(IsOfflineModeEnabled()&&(SiebelApp.OfflineAppSettings.GetMode()===true||(!navigator.onLine&&SiebelApp.OfflineAppMgr.GetCacheType()==="Reactive"))){if(IsOfflineModeEnabled()&&SiebelApp.OfflineAppMgr.IsCachableRequest(a)){SiebelApp.OfflineAppMgr.OfflineRequestHandler(a,c,c.async)}}else{$.ajax({url:c.url,data:c.data,type:c.type,async:c.async,contentType:c.contentType,success:c.successfncallback,error:c.errfncb,context:c.context})}}}}())};