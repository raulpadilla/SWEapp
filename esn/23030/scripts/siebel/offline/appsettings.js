/*<ORACLECOPYRIGHT>
* Copyright (C) 1994-2013 Oracle and/or its affiliates. All rights reserved.
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
if(typeof(SiebelApp.OfflineAppSettings)==="undefined"){Namespace("SiebelApp.OfflineAppSettings");SiebelApp.OfflineAppSettings=(function(){var g;var a=false;var e=window.localStorage;function f(){var i;if(!(JSON.parse(e.getItem("CacheType")))){e.setItem("CacheType",JSON.stringify("Reactive"))}this.SetCacheType=function(n){e.setItem("CacheType",JSON.stringify(n))};this.GetCacheType=function(){return(JSON.parse(e.getItem("CacheType")))};if(!(JSON.parse(e.getItem("SyncPending")))){e.setItem("SyncPending",JSON.stringify(false))}this.SetSyncStatus=function(n){e.setItem("SyncPending",JSON.stringify(n))};this.GetSyncStatus=function(){return(JSON.parse(e.getItem("SyncPending")))};if(!(JSON.parse(e.getItem("WorkOffline")))){var k=false;e.setItem("WorkOffline",JSON.stringify(k))}this.SetMode=function(n,o){if(!o){e.setItem("WorkOffline",JSON.stringify(n))}g=n};this.GetMode=function(){if(!a){g=JSON.parse(e.getItem("WorkOffline"));if(!g){g=(JSON.parse(e.getItem("PackageDownloaded"))&&!navigator.onLine)}else{var o=e.getItem("appURL");if(o){o=JSON.parse(o)}var n=window.location;var p=n.origin.concat(n.pathname);if(o!==p){g=false}}a=true}return g};if(!(JSON.parse(e.getItem("PackageDownloaded")))){var m=false;e.setItem("PackageDownloaded",JSON.stringify(m))}this.SetData=function(n){e.setItem("PackageDownloaded",JSON.stringify(n))};this.GetPkgStatus=function(){return(JSON.parse(e.getItem("PackageDownloaded")))};if(!(JSON.parse(e.getItem("CheckMetaDataDownload")))){var h=false;e.setItem("CheckMetaDataDownload",JSON.stringify(h))}this.SetMetadata=function(n){e.setItem("CheckMetaDataDownload",JSON.stringify(n))};this.GetMetadata=function(){return(JSON.parse(e.getItem("CheckMetaDataDownload")))};if(!(JSON.parse(e.getItem("Schema")))){var j=0;e.setItem("Schema",JSON.stringify(j))}this.SetSchemaStatus=function(n){e.setItem("Schema",JSON.stringify(n))};this.GetSchemaStatus=function(){return(JSON.parse(e.getItem("Schema")))};l=function l(){return i};l.prototype=this;i=new l();i.constructor=l;return i}var d=new f();f.prototype.OnSuccessfulDataDownload=function(){this.SetCacheType("Proactive");this.SetSyncStatus(false);this.SetMode((!SiebelApp.OfflineAppSettings.GetMode()));this.SetData(true);this.SetSchemaStatus(2);var h=window.location;var i=h.origin.concat(h.pathname);e.setItem("appURL",JSON.stringify(i));if(!SiebelApp.S_App.Model.GetLoginName()){window.localStorage.setItem("UID",SiebelApp.S_App.GetUserName())}};f.prototype.CheckSameDownloadCond=function(j){if(this.GetPkgStatus()){var i=e.getItem("appURL");if(i){i=JSON.parse(i)}var h=window.location;var l=h.origin.concat(h.pathname);if(i!==l){return false}if(j){var k=SiebelJS.Dependency("SiebelApp.Constants");if(j.GetProperty(k.get("SWE_PROP_USER_ID"))!==SiebelApp.S_App.Model.GetLoginName()){return false}}else{if(SiebelApp.S_App.GetUserName&&SiebelApp.S_App.GetUserName()!==SiebelApp.S_App.Model.GetLoginName()){return false}}}return true};f.prototype.OnSuccessfulMetaDataDownload=function(){SiebelJS.Log("Getting Offline Metadata....is Done. "+SiebelApp.OfflineUtils.GetTS());$(".progressbar").find("img").removeClass().addClass("metadataDone");this.SetData(false);this.SetMetadata(true)};f.prototype.CheckOfflineMode=function(){if(navigator.onLine&&IsOfflineModeEnabled()){return true}else{return false}};f.prototype.ReloadApp=function(){var k=JSON.parse(window.localStorage.getItem("appURL"));var i=SiebelApp.S_App.GetActiveView().GetName();k=k+"?SWECmd=GotoView&SWEView="+URLEncode(i);var j=SiebelApp.S_App.GetSRN();k=k+"&SRN="+j;var h=Math.random();k=k+"&SWETS="+h;window.location.replace(k)};f.prototype.ReloadToOffline=function(){var i=this;$(window).bind("unload",{ctx:this},function(j){c.call(j.data.ctx)});window.onbeforeunload=function(){window.unload=null;c.call(i)};var h=window.location;h.replace(h.origin.concat(h.pathname))};f.prototype.SetSRNCookie=function(){var i=new Date();var h="_srn";if(SiebelApp.S_App.GetSRN){var j=SiebelApp.S_App.GetSRN();i.setTime(i.getTime()+100000);$.cookie(h,j,{expires:i})}};function c(){var h="_srn";SiebelApp.OfflineAppSettings.SetSRNCookie();setTimeout(function(){$.cookie(h,null)},100)}var b=window.applicationCache;b.ondownloading=function(h){e.setItem("appCacheDone",JSON.stringify(false));if(b.status!==1){SiebelApp.S_App.uiStatus.Busy({mask:true,timeOut:false});if($(".progressbar").length===0){$("#_swecontent").prepend("<div id='progressbar' class ='progressbar'><img class = 'appCacheProgress1'src='images/white.gif'></img></div>")}SiebelJS.Log("Application Cache Downloading...."+SiebelApp.OfflineUtils.GetTS())}};b.oncached=function(h){e.setItem("appCacheDone",JSON.stringify(true));$(".progressbar").remove();if(b.status===1){SiebelApp.S_App.uiStatus.Free();SiebelJS.Log("Application Cache Downloaded...."+SiebelApp.OfflineUtils.GetTS())}if(SiebelApp.S_App.GetActiveView()){History.back()}if(SiebelApp.OfflineAppSettings.GetMode()){SiebelApp.OfflineAppSettings.ReloadToOffline()}};b.onprogress=function(k){var j=k.total;var h=k.loaded;var l=(h/j)*100;var i=document.cookie;if(i===null||i.length===0||i.indexOf("_srn=")===-1){SiebelApp.OfflineAppSettings.SetSRNCookie()}if($(".progressbar").length===0){$("#_swecontent").prepend("<div id='progressbar' class ='progressbar'><img class = 'appCacheProgress1'src='images/white.gif'></img></div>")}if(l>=10&&l<20){$(".progressbar").find("img").removeClass().addClass("appCacheProgress2")}if(l>=20&&l<40){$(".progressbar").find("img").removeClass().addClass("appCacheProgress3")}if(l>=40&&l<60){$(".progressbar").find("img").removeClass().addClass("appCacheProgress4")}if(l>=60&&l<80){$(".progressbar").find("img").removeClass().addClass("appCacheProgress5")}if(l===100){$(".progressbar").find("img").removeClass().addClass("appCacheProgress6")}if(SiebelApp.S_App.uiStatus.m_gbusy===0){if(b.status!==1){if(!SiebelApp.S_App.uiStatus.IsBusy()){SiebelApp.S_App.uiStatus.Busy({mask:true,timeOut:false})}}}};b.onupdateready=function(h){$(".progressbar").remove();SiebelApp.S_App.uiStatus.Free();e.setItem("appCacheDone",JSON.stringify(true))};b.onerror=function(h){$(".progressbar").remove();SiebelApp.S_App.uiStatus.Free();SiebelJS.Log("Error in downlaoding Application Cache")};return d}())};